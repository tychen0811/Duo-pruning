cscope 15 $HOME/Desktop/ranger_cpp_0.5.0/source/src -q 0000000773 0000195138
	@Forest/Forest.cpp

29 
	~<m©h.h
>

30 
	~<®gÜ™hm
>

31 
	~<¡dexû±
>

32 
	~<¡ršg
>

33 
	~<ùime
>

34 
	~<m©h.h
>

35 #iâdeà
OLD_WIN_R_BUILD


36 
	~<th»ad
>

37 
	~<chrÚo
>

40 
	~"ut™y.h
"

41 
	~"FÜe¡.h
"

42 
	~"D©aCh¬.h
"

43 
	~"D©aDoubË.h
"

44 
	~"D©aFlßt.h
"

46 
	gFÜe¡
::
	$FÜe¡
() :

47 
	`v”bo£_out
(0), 
	`num_Œ“s
(
DEFAULT_NUM_TREE
), 
	`mŒy
(0), 
	`mš_node_size
(0), 
	`num_v¬ŸbËs
(0), 
	`num_šd•’d’t_v¬ŸbËs
(

48 0), 
	`£ed
(0), 
	`d•’d’t_v¬ID
(0), 
	`num_§m¶es
(0), 
	`´ediùiÚ_mode
(
çl£
), 
	`memÜy_mode
(
MEM_DOUBLE
), 
	`§m¶e_w™h_»¶aûm’t
(

49 
Œue
), 
	`memÜy_§všg_¥l™tšg
(
çl£
), 
	`¥l™ruË
(
DEFAULT_SPLITRULE
), 
	`´ediù_®l
(çl£), 
	`k“p_šbag
(çl£), 
	`§m¶e_äaùiÚ
(

50 1), 
	`hŞdout
(
çl£
), 
	`®pha
(
DEFAULT_ALPHA
), 
	`mš´İ
(
DEFAULT_MINPROP
), 
	`num_th»ads
(
DEFAULT_NUM_THREADS
), 
	`d©a
(0), 
	`ov”®l_´ediùiÚ_”rÜ
(

51 0), 
	`impÜnû_mode
(
DEFAULT_IMPORTANCE_MODE
), 
	$´og»ss
(0) {

52 
	}
}

54 
	gFÜe¡
::~
	$FÜe¡
() {

55 auto& 
Œ“
 : 
Œ“s
) {

56 
d–‘e
 
Œ“
;

58 
	}
}

60 
	gFÜe¡
::
š™Cµ
(
¡d
::
¡ršg
 
d•’d’t_v¬ŸbË_Çme
, 
MemÜyMode
 
memÜy_mode
, std::¡ršg 
šput_fe
, 
ušt
 
mŒy
,

61 
¡d
::
¡ršg
 
ouut_´efix
, 
ušt
 
num_Œ“s
, std::
o¡»am
* 
v”bo£_out
, ušˆ
£ed
, ušˆ
num_th»ads
,

62 
¡d
::
¡ršg
 
lßd_fÜe¡_f’ame
, 
ImpÜnûMode
 
impÜnû_mode
, 
ušt
 
mš_node_size
,

63 
¡d
::
¡ršg
 
¥l™_£Ëù_weights_fe
, std::
veùÜ
<¡d::¡ršg>& 
®ways_¥l™_v¬ŸbË_Çmes
,

64 
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
, 
boŞ
 
§m¶e_w™h_»¶aûm’t
, std::
veùÜ
<¡d::¡ršg>& 
unÜd”ed_v¬ŸbË_Çmes
,

65 
boŞ
 
memÜy_§všg_¥l™tšg
, 
S¶™RuË
 
¥l™ruË
, 
¡d
::
¡ršg
 
ÿ£_weights_fe
, boŞ 
´ediù_®l
,

66 
§m¶e_äaùiÚ
, 
®pha
, 
mš´İ
, 
boŞ
 
hŞdout
) {

68 
	gthis
->
	gv”bo£_out
 = 
v”bo£_out
;

71 
	gmemÜy_mode
) {

72 
	gMEM_DOUBLE
:

73 
d©a
 = 
Ãw
 
D©aDoubË
();

75 
	gMEM_FLOAT
:

76 
d©a
 = 
Ãw
 
D©aFlßt
();

78 
	gMEM_CHAR
:

79 
d©a
 = 
Ãw
 
D©aCh¬
();

84 *
	gv”bo£_out
 << "Lßdšg iÅuˆfe: " << 
	gšput_fe
 << "." << 
	g¡d
::
’dl
;

85 
boŞ
 
	groundšg_”rÜ
 = 
d©a
->
lßdFromFe
(
šput_fe
);

86 ià(
	groundšg_”rÜ
) {

87 *
	gv”bo£_out
 << "Warning: Rounding or Integer overflow occurred. Use FLOAT or DOUBLE…recisiono‡voidhis."

88 << 
	g¡d
::
’dl
;

92 
boŞ
 
	g´ediùiÚ_mode
 = 
çl£
;

93 ià(!
	glßd_fÜe¡_f’ame
.
em±y
()) {

94 
	g´ediùiÚ_mode
 = 
Œue
;

98 
š™
(
d•’d’t_v¬ŸbË_Çme
, 
memÜy_mode
, 
d©a
, 
mŒy
, 
ouut_´efix
, 
num_Œ“s
, 
£ed
, 
num_th»ads
, 
impÜnû_mode
,

99 
mš_node_size
, 
¡©us_v¬ŸbË_Çme
, 
´ediùiÚ_mode
, 
§m¶e_w™h_»¶aûm’t
, 
unÜd”ed_v¬ŸbË_Çmes
,

100 
memÜy_§všg_¥l™tšg
, 
¥l™ruË
, 
´ediù_®l
, 
§m¶e_äaùiÚ
, 
®pha
, 
mš´İ
, 
hŞdout
);

102 ià(
	g´ediùiÚ_mode
) {

103 
lßdFromFe
(
lßd_fÜe¡_f’ame
);

106 ià(!
	g®ways_¥l™_v¬ŸbË_Çmes
.
em±y
()) {

107 
£tAlwaysS¶™V¬ŸbËs
(
®ways_¥l™_v¬ŸbË_Çmes
);

112 ià(!
	g¥l™_£Ëù_weights_fe
.
em±y
()) {

113 
	g¡d
::
veùÜ
<
¡d
::veùÜ<>> 
¥l™_£Ëù_weights
;

114 
	g¥l™_£Ëù_weights
.
»size
(1);

115 
lßdDoubËVeùÜFromFe
(
¥l™_£Ëù_weights
[0], 
¥l™_£Ëù_weights_fe
);

116 ià(
	g¥l™_£Ëù_weights
[0].
size
(è!ğ
num_v¬ŸbËs
 - 1) {

117 
throw
 
¡d
::
ruÁime_”rÜ
("Number of split select weights is‚otƒqualo‚umber of independent variables.");

119 
£tS¶™WeightVeùÜ
(
¥l™_£Ëù_weights
);

123 ià(!
	gÿ£_weights_fe
.
em±y
()) {

124 
lßdDoubËVeùÜFromFe
(
ÿ£_weights
, 
ÿ£_weights_fe
);

125 ià(
	gÿ£_weights
.
size
(è!ğ
num_§m¶es
 - 1) {

126 
throw
 
¡d
::
ruÁime_”rÜ
("Number of case weights is‚otƒqualo‚umber of samples.");

131 ià(
	ghŞdout
 && !
	gÿ£_weights
.
em±y
()) {

132 
size_t
 
	gnÚz”o_weights
 = 0;

133 auto& 
	gweight
 : 
ÿ£_weights
) {

134 ià(
weight
 > 0) {

135 ++
nÚz”o_weights
;

138 
	gthis
->
	g§m¶e_äaùiÚ
 = 
this
->
§m¶e_äaùiÚ
 * ((è
nÚz”o_weights
 / (è
num_§m¶es
);

142 ià(!
	gunÜd”ed_v¬ŸbË_Çmes
.
em±y
()) {

143 
	g¡d
::
¡ršg
 
”rÜ_mes§ge
 = 
checkUnÜd”edV¬ŸbËs
(
d©a
, 
unÜd”ed_v¬ŸbË_Çmes
);

144 ià(!
	g”rÜ_mes§ge
.
em±y
()) {

145 
throw
 
	g¡d
::
ruÁime_”rÜ
(
”rÜ_mes§ge
);

150 
	gFÜe¡
::
š™R
(
¡d
::
¡ršg
 
d•’d’t_v¬ŸbË_Çme
, 
D©a
* 
šput_d©a
, 
ušt
 
mŒy
, ušˆ
num_Œ“s
,

151 
¡d
::
o¡»am
* 
v”bo£_out
, 
ušt
 
£ed
, ušˆ
num_th»ads
, 
ImpÜnûMode
 
impÜnû_mode
, ušˆ
mš_node_size
,

152 
¡d
::
veùÜ
<¡d::veùÜ<>>& 
¥l™_£Ëù_weights
, std::veùÜ<¡d::
¡ršg
>& 
®ways_¥l™_v¬ŸbË_Çmes
,

153 
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
, 
boŞ
 
´ediùiÚ_mode
, boŞ 
§m¶e_w™h_»¶aûm’t
,

154 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
unÜd”ed_v¬ŸbË_Çmes
, 
boŞ
 
memÜy_§všg_¥l™tšg
, 
S¶™RuË
 
¥l™ruË
,

155 
¡d
::
veùÜ
<>& 
ÿ£_weights
, 
boŞ
 
´ediù_®l
, boŞ 
k“p_šbag
, 
§m¶e_äaùiÚ
, 
®pha
,

156 
mš´İ
, 
boŞ
 
hŞdout
) {

158 
	gthis
->
	gv”bo£_out
 = 
v”bo£_out
;

161 
š™
(
d•’d’t_v¬ŸbË_Çme
, 
MEM_DOUBLE
, 
šput_d©a
, 
mŒy
, "", 
num_Œ“s
, 
£ed
, 
num_th»ads
, 
impÜnû_mode
,

162 
mš_node_size
, 
¡©us_v¬ŸbË_Çme
, 
´ediùiÚ_mode
, 
§m¶e_w™h_»¶aûm’t
, 
unÜd”ed_v¬ŸbË_Çmes
,

163 
memÜy_§všg_¥l™tšg
, 
¥l™ruË
, 
´ediù_®l
, 
§m¶e_äaùiÚ
, 
®pha
, 
mš´İ
, 
hŞdout
);

166 ià(!
	g®ways_¥l™_v¬ŸbË_Çmes
.
em±y
()) {

167 
£tAlwaysS¶™V¬ŸbËs
(
®ways_¥l™_v¬ŸbË_Çmes
);

171 ià(!
	g¥l™_£Ëù_weights
.
em±y
()) {

172 
£tS¶™WeightVeùÜ
(
¥l™_£Ëù_weights
);

176 ià(!
	gÿ£_weights
.
em±y
()) {

177 ià(
	gÿ£_weights
.
size
(è!ğ
num_§m¶es
) {

178 
throw
 
¡d
::
ruÁime_”rÜ
("Number of case weights‚otƒqualo‚umber of samples.");

180 
	gthis
->
	gÿ£_weights
 = 
ÿ£_weights
;

184 
	gthis
->
	gk“p_šbag
 = 
k“p_šbag
;

187 
	gFÜe¡
::
š™
(
¡d
::
¡ršg
 
d•’d’t_v¬ŸbË_Çme
, 
MemÜyMode
 
memÜy_mode
, 
D©a
* 
šput_d©a
, 
ušt
 
mŒy
,

188 
¡d
::
¡ršg
 
ouut_´efix
, 
ušt
 
num_Œ“s
, ušˆ
£ed
, ušˆ
num_th»ads
, 
ImpÜnûMode
 
impÜnû_mode
,

189 
ušt
 
mš_node_size
, 
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
, 
boŞ
 
´ediùiÚ_mode
, boŞ 
§m¶e_w™h_»¶aûm’t
,

190 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
unÜd”ed_v¬ŸbË_Çmes
, 
boŞ
 
memÜy_§všg_¥l™tšg
, 
S¶™RuË
 
¥l™ruË
,

191 
boŞ
 
´ediù_®l
, 
§m¶e_äaùiÚ
, 
®pha
, 
mš´İ
, boŞ 
hŞdout
) {

194 
	gthis
->
	gd©a
 = 
šput_d©a
;

197 ià(
	g£ed
 == 0) {

198 
¡d
::
¿ndom_deviû
„andom_device;

199 
	g¿ndom_numb”_g’”©Ü
.
£ed
(
¿ndom_deviû
());

201 
	g¿ndom_numb”_g’”©Ü
.
£ed
(seed);

205 ià(
	gnum_th»ads
 =ğ
DEFAULT_NUM_THREADS
) {

206 #ifdeà
OLD_WIN_R_BUILD


207 
this
->
num_th»ads
 = 1;

209 
	gthis
->
	gnum_th»ads
 = 
¡d
::
th»ad
::
h¬dw¬e_cÚcu¼’cy
();

212 
	gthis
->
	gnum_th»ads
 = 
num_th»ads
;

216 
	gthis
->
	gnum_Œ“s
 = 
num_Œ“s
;

217 
	gthis
->
	gmŒy
 = 
mŒy
;

218 
	gthis
->
	g£ed
 = 
£ed
;

219 
	gthis
->
	gouut_´efix
 = 
ouut_´efix
;

220 
	gthis
->
	gimpÜnû_mode
 = 
impÜnû_mode
;

221 
	gthis
->
	gmš_node_size
 = 
mš_node_size
;

222 
	gthis
->
	gmemÜy_mode
 = 
memÜy_mode
;

223 
	gthis
->
	g´ediùiÚ_mode
 = 
´ediùiÚ_mode
;

224 
	gthis
->
	g§m¶e_w™h_»¶aûm’t
 = 
§m¶e_w™h_»¶aûm’t
;

225 
	gthis
->
	gmemÜy_§všg_¥l™tšg
 = 
memÜy_§všg_¥l™tšg
;

226 
	gthis
->
	g¥l™ruË
 = 
¥l™ruË
;

227 
	gthis
->
	g´ediù_®l
 = 
´ediù_®l
;

228 
	gthis
->
	g§m¶e_äaùiÚ
 = 
§m¶e_äaùiÚ
;

229 
	gthis
->
	ghŞdout
 = 
hŞdout
;

230 
	gthis
->
	g®pha
 = 
®pha
;

231 
	gthis
->
	gmš´İ
 = 
mš´İ
;

234 
	gnum_§m¶es
 = 
d©a
->
g‘NumRows
();

235 
	gnum_v¬ŸbËs
 = 
d©a
->
g‘NumCŞs
();

238 ià(!
	g´ediùiÚ_mode
 && !
	gd•’d’t_v¬ŸbË_Çme
.
em±y
()) {

239 
	gd•’d’t_v¬ID
 = 
d©a
->
g‘V¬ŸbËID
(
d•’d’t_v¬ŸbË_Çme
);

243 ià(!
	g´ediùiÚ_mode
) {

244 
	gis_Üd”ed_v¬ŸbË
.
»size
(
num_v¬ŸbËs
, 
Œue
);

245 auto& 
	gv¬ŸbË_Çme
 : 
unÜd”ed_v¬ŸbË_Çmes
) {

246 
size_t
 
v¬ID
 = 
d©a
->
g‘V¬ŸbËID
(
v¬ŸbË_Çme
);

247 
	gis_Üd”ed_v¬ŸbË
[
v¬ID
] = 
çl£
;

251 
	gno_¥l™_v¬ŸbËs
.
push_back
(
d•’d’t_v¬ID
);

253 
š™IÁ”Çl
(
¡©us_v¬ŸbË_Çme
);

255 
	gnum_šd•’d’t_v¬ŸbËs
 = 
num_v¬ŸbËs
 - 
no_¥l™_v¬ŸbËs
.
size
();

258 
	g¡d
::
sÜt
(
no_¥l™_v¬ŸbËs
.
begš
(),‚o_¥l™_v¬ŸbËs.
’d
());

261 
	g¥l™_£Ëù_weights
.
push_back
(
¡d
::
veùÜ
<>());

264 ià(
	gthis
->
	gmŒy
 > 
	gnum_v¬ŸbËs
 - 1) {

265 
throw
 
	g¡d
::
ruÁime_”rÜ
("mtry can‚ot be†argerhan‚umber of variables in data.");

269 ià((
	gsize_t
è
num_§m¶es
 * 
	g§m¶e_äaùiÚ
 < 1) {

270 
throw
 
	g¡d
::
ruÁime_”rÜ
("sample_fractionoo small,‚o observations sampled.");

274 
	gFÜe¡
::
	$run
(
boŞ
 
v”bo£
) {

276 ià(
´ediùiÚ_mode
) {

277 ià(
v”bo£
) {

278 *
v”bo£_out
 << "P»diùšg .." << 
¡d
::
’dl
;

280 
	`´ediù
();

282 ià(
v”bo£
) {

283 *
v”bo£_out
 << "Growšg»e .." << 
¡d
::
’dl
;

286 
	`grow
();

288 ià(
v”bo£
) {

289 *
v”bo£_out
 << "Computšg…»diùiÚƒ¼Ü .." << 
¡d
::
’dl
;

291 
	`compu‹P»diùiÚE¼Ü
();

293 ià(
impÜnû_mode
 > 
IMP_GINI
) {

294 ià(
v”bo£
) {

295 *
v”bo£_out
 << "Computšg…”mutiÚ v¬ŸbË impÜnû .." << 
¡d
::
’dl
;

297 
	`compu‹P”mutiÚImpÜnû
();

300 
	}
}

302 
	gFÜe¡
::
	$wr™eOuut
() {

304 *
v”bo£_out
 << 
¡d
::
’dl
;

305 
	`wr™eOuutIÁ”Çl
();

306 *
v”bo£_out
 << "D•’d’ˆv¬ŸbË‚ame: " << 
d©a
->
	`g‘V¬ŸbËNames
()[
d•’d’t_v¬ID
] << 
¡d
::
’dl
;

307 *
v”bo£_out
 << "D•’d’ˆv¬ŸbË ID: " << 
d•’d’t_v¬ID
 << 
¡d
::
’dl
;

308 *
v”bo£_out
 << "Numb” oàŒ“s: " << 
num_Œ“s
 << 
¡d
::
’dl
;

309 *
v”bo£_out
 << "Sam¶size: " << 
num_§m¶es
 << 
¡d
::
’dl
;

310 *
v”bo£_out
 << "Numb” oàšd•’d’ˆv¬ŸbËs: " << 
num_šd•’d’t_v¬ŸbËs
 << 
¡d
::
’dl
;

311 *
v”bo£_out
 << "MŒy: " << 
mŒy
 << 
¡d
::
’dl
;

312 *
v”bo£_out
 << "T¬g‘‚odsize: " << 
mš_node_size
 << 
¡d
::
’dl
;

313 *
v”bo£_out
 << "V¬ŸbË impÜnû mode: " << 
impÜnû_mode
 << 
¡d
::
’dl
;

314 *
v”bo£_out
 << "MemÜy mode: " << 
memÜy_mode
 << 
¡d
::
’dl
;

315 *
v”bo£_out
 << "S“d: " << 
£ed
 << 
¡d
::
’dl
;

316 *
v”bo£_out
 << "Numb” oàth»ads: " << 
num_th»ads
 << 
¡d
::
’dl
;

317 *
v”bo£_out
 << 
¡d
::
’dl
;

319 ià(
´ediùiÚ_mode
) {

320 
	`wr™eP»diùiÚFe
();

322 *
v”bo£_out
 << "Ov”®ÈOOB…»diùiÚƒ¼Ü: " << 
ov”®l_´ediùiÚ_”rÜ
 << 
¡d
::
’dl
;

323 *
v”bo£_out
 << 
¡d
::
’dl
;

325 ià(!
¥l™_£Ëù_weights
.
	`em±y
() & !split_select_weights[0].empty()) {

326 *
v”bo£_out


328 << 
¡d
::
’dl
;

331 ià(
impÜnû_mode
 !ğ
IMP_NONE
) {

332 
	`wr™eImpÜnûFe
();

335 
	`wr™eCÚfusiÚFe
();

337 
	}
}

339 
	gFÜe¡
::
	$wr™eImpÜnûFe
() {

342 
¡d
::
¡ršg
 
f’ame
 = 
ouut_´efix
 + ".importance";

343 
¡d
::
of¡»am
 
impÜnû_fe
;

344 
impÜnû_fe
.
	`İ’
(
f’ame
, 
¡d
::
ios
::
out
);

345 ià(!
impÜnû_fe
.
	`good
()) {

346 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù wr™tØimpÜnû fe: " + 
f’ame
 + ".");

350 
size_t
 
i
 = 0; i < 
v¬ŸbË_impÜnû
.
	`size
(); ++i) {

351 
size_t
 
v¬ID
 = 
i
;

352 auto& 
sk
 : 
no_¥l™_v¬ŸbËs
) {

353 ià(
v¬ID
 >ğ
sk
) {

354 ++
v¬ID
;

357 
¡d
::
¡ršg
 
v¬ŸbË_Çme
 = 
d©a
->
	`g‘V¬ŸbËNames
()[
v¬ID
];

358 
impÜnû_fe
 << 
v¬ŸbË_Çme
 << ": " << 
v¬ŸbË_impÜnû
[
i
] << 
¡d
::
’dl
;

361 
impÜnû_fe
.
	`şo£
();

362 *
v”bo£_out
 << "Saved v¬ŸbË impÜnûØf" << 
f’ame
 << "." << 
¡d
::
’dl
;

363 
	}
}

365 
	gFÜe¡
::
	$§veToFe
() {

368 
¡d
::
¡ršg
 
f’ame
 = 
ouut_´efix
 + ".forest";

369 
¡d
::
of¡»am
 
outfe
;

370 
outfe
.
	`İ’
(
f’ame
, 
¡d
::
ios
::
bš¬y
);

371 ià(!
outfe
.
	`good
()) {

372 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù wr™tØouuˆfe: " + 
f’ame
 + ".");

376 
outfe
.
	`wr™e
((*è&
d•’d’t_v¬ID
, (dependent_varID));

379 
outfe
.
	`wr™e
((*è&
num_Œ“s
, (num_trees));

382 
	`§veVeùÜ1D
(
is_Üd”ed_v¬ŸbË
, 
outfe
);

384 
	`§veToFeIÁ”Çl
(
outfe
);

387 auto& 
Œ“
 : 
Œ“s
) {

388 
Œ“
->
	`­³ndToFe
(
outfe
);

392 
outfe
.
	`şo£
();

393 *
v”bo£_out
 << "Saved fÜe¡Øf" << 
f’ame
 << "." << 
¡d
::
’dl
;

394 
	}
}

396 
	gFÜe¡
::
	$grow
() {

399 
	`equ®S¶™
(
th»ad_¿nges
, 0, 
num_Œ“s
 - 1, 
num_th»ads
);

402 
	`growIÁ”Çl
();

405 
¡d
::
unifÜm_št_di¡ributiÚ
<
ušt
> 
udi¡
;

406 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

407 
ušt
 
Œ“_£ed
;

408 ià(
£ed
 == 0) {

409 
Œ“_£ed
 = 
	`udi¡
(
¿ndom_numb”_g’”©Ü
);

411 
Œ“_£ed
 = (
i
 + 1è* 
£ed
;

415 
¡d
::
veùÜ
<>* 
Œ“_¥l™_£Ëù_weights
;

416 ià(
¥l™_£Ëù_weights
.
	`size
() > 1) {

417 
Œ“_¥l™_£Ëù_weights
 = &
¥l™_£Ëù_weights
[
i
];

419 
Œ“_¥l™_£Ëù_weights
 = &
¥l™_£Ëù_weights
[0];

422 
Œ“s
[
i
]->
	`š™
(
d©a
, 
mŒy
, 
d•’d’t_v¬ID
, 
num_§m¶es
, 
Œ“_£ed
, &
d‘”mši¡ic_v¬IDs
, &
¥l™_£Ëù_v¬IDs
,

423 
Œ“_¥l™_£Ëù_weights
, 
impÜnû_mode
, 
mš_node_size
, &
no_¥l™_v¬ŸbËs
, 
§m¶e_w™h_»¶aûm’t
,

424 &
is_Üd”ed_v¬ŸbË
, 
memÜy_§všg_¥l™tšg
, 
¥l™ruË
, &
ÿ£_weights
, 
k“p_šbag
, 
§m¶e_äaùiÚ
, 
®pha
,

425 
mš´İ
, 
hŞdout
);

429 
v¬ŸbË_impÜnû
.
	`»size
(
num_šd•’d’t_v¬ŸbËs
, 0);

432 #ifdeà
OLD_WIN_R_BUILD


433 
´og»ss
 = 0;

434 
şock_t
 
¡¬t_time
 = 
	`şock
();

435 
şock_t
 
Ïp_time
 = 
	`şock
();

436 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

437 
Œ“s
[
i
]->
	`grow
(&
v¬ŸbË_impÜnû
);

438 
´og»ss
++;

439 
	`showProg»ss
("Growšg»es..", 
¡¬t_time
, 
Ïp_time
);

442 
´og»ss
 = 0;

443 #ifdeà
R_BUILD


444 
abÜ‹d
 = 
çl£
;

445 
abÜ‹d_th»ads
 = 0;

448 
¡d
::
veùÜ
<¡d::
th»ad
> 
th»ads
;

449 
th»ads
.
	`»£rve
(
num_th»ads
);

452 
¡d
::
veùÜ
<¡d::veùÜ<>> 
	`v¬ŸbË_impÜnû_th»ads
(
num_th»ads
);

454 
ušt
 
i
 = 0; i < 
num_th»ads
; ++i) {

455 ià(
impÜnû_mode
 =ğ
IMP_GINI
) {

456 
v¬ŸbË_impÜnû_th»ads
[
i
].
	`»size
(
num_šd•’d’t_v¬ŸbËs
, 0);

458 
th»ads
.
	`push_back
(
¡d
::
	`th»ad
(&
FÜe¡
::
growT»esInTh»ad
, 
this
, 
i
, &(
v¬ŸbË_impÜnû_th»ads
[i])));

460 
	`showProg»ss
("Growingrees..");

461 autØ&
th»ad
 : 
th»ads
) {

462 
th»ad
.
	`još
();

465 #ifdeà
R_BUILD


466 ià(
abÜ‹d_th»ads
 > 0) {

467 
throw
 
¡d
::
	`ruÁime_”rÜ
("User interrupt.");

472 ià(
impÜnû_mode
 =ğ
IMP_GINI
) {

473 
v¬ŸbË_impÜnû
.
	`»size
(
num_šd•’d’t_v¬ŸbËs
, 0);

474 
size_t
 
i
 = 0; i < 
num_šd•’d’t_v¬ŸbËs
; ++i) {

475 
ušt
 
j
 = 0; j < 
num_th»ads
; ++j) {

476 
v¬ŸbË_impÜnû
[
i
] +ğ
v¬ŸbË_impÜnû_th»ads
[
j
][i];

479 
v¬ŸbË_impÜnû_th»ads
.
	`ş—r
();

485 ià(
impÜnû_mode
 =ğ
IMP_GINI
) {

486 auto& 
v
 : 
v¬ŸbË_impÜnû
) {

487 
v
 /ğ
num_Œ“s
;

490 
	}
}

492 
	gFÜe¡
::
	$´ediù
() {

495 #ifdeà
OLD_WIN_R_BUILD


496 
´og»ss
 = 0;

497 
şock_t
 
¡¬t_time
 = 
	`şock
();

498 
şock_t
 
Ïp_time
 = 
	`şock
();

499 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

500 
Œ“s
[
i
]->
	`´ediù
(
d©a
, 
çl£
);

501 
´og»ss
++;

502 
	`showProg»ss
("P»diùšg..", 
¡¬t_time
, 
Ïp_time
);

505 
´og»ss
 = 0;

506 #ifdeà
R_BUILD


507 
abÜ‹d
 = 
çl£
;

508 
abÜ‹d_th»ads
 = 0;

511 
¡d
::
veùÜ
<¡d::
th»ad
> 
th»ads
;

512 
th»ads
.
	`»£rve
(
num_th»ads
);

513 
ušt
 
i
 = 0; i < 
num_th»ads
; ++i) {

514 
th»ads
.
	`push_back
(
¡d
::
	`th»ad
(&
FÜe¡
::
´ediùT»esInTh»ad
, 
this
, 
i
, 
d©a
, 
çl£
));

516 
	`showProg»ss
("Predicting..");

517 autØ&
th»ad
 : 
th»ads
) {

518 
th»ad
.
	`još
();

521 #ifdeà
R_BUILD


522 ià(
abÜ‹d_th»ads
 > 0) {

523 
throw
 
¡d
::
	`ruÁime_”rÜ
("User interrupt.");

529 
	`´ediùIÁ”Çl
();

530 
	}
}

532 
	gFÜe¡
::
	$compu‹P»diùiÚE¼Ü
() {

535 #ifdeà
OLD_WIN_R_BUILD


536 
´og»ss
 = 0;

537 
şock_t
 
¡¬t_time
 = 
	`şock
();

538 
şock_t
 
Ïp_time
 = 
	`şock
();

539 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

540 
Œ“s
[
i
]->
	`´ediù
(
d©a
, 
Œue
);

541 
´og»ss
++;

542 
	`showProg»ss
("P»diùšg..", 
¡¬t_time
, 
Ïp_time
);

545 
¡d
::
veùÜ
<¡d::
th»ad
> 
th»ads
;

546 
th»ads
.
	`»£rve
(
num_th»ads
);

547 
ušt
 
i
 = 0; i < 
num_th»ads
; ++i) {

548 
th»ads
.
	`push_back
(
¡d
::
	`th»ad
(&
FÜe¡
::
´ediùT»esInTh»ad
, 
this
, 
i
, 
d©a
, 
Œue
));

550 
	`showProg»ss
("Computing…redictionƒrror..");

551 autØ&
th»ad
 : 
th»ads
) {

552 
th»ad
.
	`još
();

555 #ifdeà
R_BUILD


556 ià(
abÜ‹d_th»ads
 > 0) {

557 
throw
 
¡d
::
	`ruÁime_”rÜ
("User interrupt.");

563 
	`compu‹P»diùiÚE¼ÜIÁ”Çl
();

564 
	}
}

566 
	gFÜe¡
::
	$compu‹P”mutiÚImpÜnû
() {

569 #ifdeà
OLD_WIN_R_BUILD


570 
´og»ss
 = 0;

571 
şock_t
 
¡¬t_time
 = 
	`şock
();

572 
şock_t
 
Ïp_time
 = 
	`şock
();

575 
v¬ŸbË_impÜnû
.
	`»size
(
num_šd•’d’t_v¬ŸbËs
, 0);

576 
¡d
::
veùÜ
<> 
v¬Ÿnû
;

577 ià(
impÜnû_mode
 =ğ
IMP_PERM_BREIMAN
 || impÜnû_mod=ğ
IMP_PERM_LIAW
) {

578 
v¬Ÿnû
.
	`»size
(
num_šd•’d’t_v¬ŸbËs
, 0);

582 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

583 
Œ“s
[
i
]->
	`compu‹P”mutiÚImpÜnû
(&
v¬ŸbË_impÜnû
, &
v¬Ÿnû
);

584 
´og»ss
++;

585 
	`showProg»ss
("Computšg…”mutiÚ impÜnû..", 
¡¬t_time
, 
Ïp_time
);

588 
´og»ss
 = 0;

589 #ifdeà
R_BUILD


590 
abÜ‹d
 = 
çl£
;

591 
abÜ‹d_th»ads
 = 0;

594 
¡d
::
veùÜ
<¡d::
th»ad
> 
th»ads
;

595 
th»ads
.
	`»£rve
(
num_th»ads
);

598 
¡d
::
veùÜ
<¡d::veùÜ<>> 
	`v¬ŸbË_impÜnû_th»ads
(
num_th»ads
);

599 
¡d
::
veùÜ
<¡d::veùÜ<>> 
	`v¬Ÿnû_th»ads
(
num_th»ads
);

602 
ušt
 
i
 = 0; i < 
num_th»ads
; ++i) {

603 
v¬ŸbË_impÜnû_th»ads
[
i
].
	`»size
(
num_šd•’d’t_v¬ŸbËs
, 0);

604 ià(
impÜnû_mode
 =ğ
IMP_PERM_BREIMAN
 || impÜnû_mod=ğ
IMP_PERM_LIAW
) {

605 
v¬Ÿnû_th»ads
[
i
].
	`»size
(
num_šd•’d’t_v¬ŸbËs
, 0);

607 
th»ads
.
	`push_back
(

608 
¡d
::
	`th»ad
(&
FÜe¡
::
compu‹T»eP”mutiÚImpÜnûInTh»ad
, 
this
, 
i
, &(
v¬ŸbË_impÜnû_th»ads
[i]),

609 &(
v¬Ÿnû_th»ads
[
i
])));

611 
	`showProg»ss
("Computing…ermutation importance..");

612 autØ&
th»ad
 : 
th»ads
) {

613 
th»ad
.
	`još
();

616 #ifdeà
R_BUILD


617 ià(
abÜ‹d_th»ads
 > 0) {

618 
throw
 
¡d
::
	`ruÁime_”rÜ
("User interrupt.");

623 
v¬ŸbË_impÜnû
.
	`»size
(
num_šd•’d’t_v¬ŸbËs
, 0);

624 
size_t
 
i
 = 0; i < 
num_šd•’d’t_v¬ŸbËs
; ++i) {

625 
ušt
 
j
 = 0; j < 
num_th»ads
; ++j) {

626 
v¬ŸbË_impÜnû
[
i
] +ğ
v¬ŸbË_impÜnû_th»ads
[
j
][i];

629 
v¬ŸbË_impÜnû_th»ads
.
	`ş—r
();

632 
¡d
::
veùÜ
<> 
	`v¬Ÿnû
(
num_šd•’d’t_v¬ŸbËs
, 0);

633 ià(
impÜnû_mode
 =ğ
IMP_PERM_BREIMAN
 || impÜnû_mod=ğ
IMP_PERM_LIAW
) {

634 
size_t
 
i
 = 0; i < 
num_šd•’d’t_v¬ŸbËs
; ++i) {

635 
ušt
 
j
 = 0; j < 
num_th»ads
; ++j) {

636 
v¬Ÿnû
[
i
] +ğ
v¬Ÿnû_th»ads
[
j
][i];

639 
v¬Ÿnû_th»ads
.
	`ş—r
();

643 
size_t
 
i
 = 0; i < 
v¬ŸbË_impÜnû
.
	`size
(); ++i) {

644 
v¬ŸbË_impÜnû
[
i
] /ğ
num_Œ“s
;

647 ià(
impÜnû_mode
 =ğ
IMP_PERM_BREIMAN
 || impÜnû_mod=ğ
IMP_PERM_LIAW
) {

648 ià(
v¬Ÿnû
[
i
] != 0) {

649 
v¬Ÿnû
[
i
] = v¬Ÿnû[i] / 
num_Œ“s
 - 
v¬ŸbË_impÜnû
[i] * variable_importance[i];

650 
v¬ŸbË_impÜnû
[
i
] /ğ
	`sq¹
(
v¬Ÿnû
[i] / 
num_Œ“s
);

654 
	}
}

656 #iâdeà
OLD_WIN_R_BUILD


657 
	gFÜe¡
::
growT»esInTh»ad
(
ušt
 
th»ad_idx
, 
¡d
::
veùÜ
<>* 
v¬ŸbË_impÜnû
) {

658 ià(
th»ad_¿nges
.
size
(è> 
th»ad_idx
 + 1) {

659 
size_t
 
i
 = 
th»ad_¿nges
[
th»ad_idx
]; 
	gi
 < 
	gth»ad_¿nges
[thread_idx + 1]; ++i) {

660 
	gŒ“s
[
i
]->
grow
(
v¬ŸbË_impÜnû
);

663 #ifdeà
R_BUILD


664 ià(
	gabÜ‹d
) {

665 
	g¡d
::
unique_lock
<
¡d
::
mu‹x
> 
lock
(mutex);

666 ++
	gabÜ‹d_th»ads
;

667 
	gcÚd™iÚ_v¬ŸbË
.
nÙify_Úe
();

673 
	g¡d
::
unique_lock
<
¡d
::
mu‹x
> 
lock
(mutex);

674 ++
	g´og»ss
;

675 
	gcÚd™iÚ_v¬ŸbË
.
nÙify_Úe
();

680 
	gFÜe¡
::
	$´ediùT»esInTh»ad
(
ušt
 
th»ad_idx
, cÚ¡ 
D©a
* 
´ediùiÚ_d©a
, 
boŞ
 
oob_´ediùiÚ
) {

681 ià(
th»ad_¿nges
.
	`size
(è> 
th»ad_idx
 + 1) {

682 
size_t
 
i
 = 
th»ad_¿nges
[
th»ad_idx
]; i <hread_ranges[thread_idx + 1]; ++i) {

683 
Œ“s
[
i
]->
	`´ediù
(
´ediùiÚ_d©a
, 
oob_´ediùiÚ
);

686 #ifdeà
R_BUILD


687 ià(
abÜ‹d
) {

688 
¡d
::
unique_lock
<¡d::
mu‹x
> 
	`lock
(mutex);

689 ++
abÜ‹d_th»ads
;

690 
cÚd™iÚ_v¬ŸbË
.
	`nÙify_Úe
();

696 
¡d
::
unique_lock
<¡d::
mu‹x
> 
	`lock
(mutex);

697 ++
´og»ss
;

698 
cÚd™iÚ_v¬ŸbË
.
	`nÙify_Úe
();

701 
	}
}

703 
	gFÜe¡
::
compu‹T»eP”mutiÚImpÜnûInTh»ad
(
ušt
 
th»ad_idx
, 
¡d
::
veùÜ
<>* 
impÜnû
,

704 
¡d
::
veùÜ
<>* 
v¬Ÿnû
) {

705 ià(
th»ad_¿nges
.
size
(è> 
th»ad_idx
 + 1) {

706 
size_t
 
i
 = 
th»ad_¿nges
[
th»ad_idx
]; 
	gi
 < 
	gth»ad_¿nges
[thread_idx + 1]; ++i) {

707 
	gŒ“s
[
i
]->
compu‹P”mutiÚImpÜnû
(
impÜnû
, 
v¬Ÿnû
);

710 #ifdeà
R_BUILD


711 ià(
	gabÜ‹d
) {

712 
	g¡d
::
unique_lock
<
¡d
::
mu‹x
> 
lock
(mutex);

713 ++
	gabÜ‹d_th»ads
;

714 
	gcÚd™iÚ_v¬ŸbË
.
nÙify_Úe
();

720 
	g¡d
::
unique_lock
<
¡d
::
mu‹x
> 
lock
(mutex);

721 ++
	g´og»ss
;

722 
	gcÚd™iÚ_v¬ŸbË
.
nÙify_Úe
();

728 
	gFÜe¡
::
	$lßdFromFe
(
¡d
::
¡ršg
 
f’ame
) {

729 *
v”bo£_out
 << "Lßdšg fÜe¡ from f" << 
f’ame
 << "." << 
¡d
::
’dl
;

732 
¡d
::
if¡»am
 
šfe
;

733 
šfe
.
	`İ’
(
f’ame
, 
¡d
::
ios
::
bš¬y
);

734 ià(!
šfe
.
	`good
()) {

735 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù„—d from iÅuˆfe: " + 
f’ame
 + ".");

739 
šfe
.
	`»ad
((*è&
d•’d’t_v¬ID
, (dependent_varID));

740 
šfe
.
	`»ad
((*è&
num_Œ“s
, (num_trees));

743 
	`»adVeùÜ1D
(
is_Üd”ed_v¬ŸbË
, 
šfe
);

746 
	`lßdFromFeIÁ”Çl
(
šfe
);

748 
šfe
.
	`şo£
();

751 
	`equ®S¶™
(
th»ad_¿nges
, 0, 
num_Œ“s
 - 1, 
num_th»ads
);

752 
	}
}

754 
	gFÜe¡
::
£tS¶™WeightVeùÜ
(
¡d
::
veùÜ
<¡d::veùÜ<>>& 
¥l™_£Ëù_weights
) {

757 ià(
¥l™_£Ëù_weights
.
size
(è!ğ1 && s¶™_£Ëù_weights.size(è!ğ
num_Œ“s
) {

758 
throw
 
¡d
::
ruÁime_”rÜ
("Size of split select weights‚otƒqualo 1 or‚umber ofrees.");

762 ià(
	g¥l™_£Ëù_weights
.
size
() == 1) {

763 
this
->
¥l™_£Ëù_weights
[0].
»size
(
num_šd•’d’t_v¬ŸbËs
);

765 
	gthis
->
	g¥l™_£Ëù_weights
.
ş—r
();

766 
	gthis
->
	g¥l™_£Ëù_weights
.
»size
(
num_Œ“s
, 
¡d
::
veùÜ
<>(
num_šd•’d’t_v¬ŸbËs
));

768 
	gthis
->
	g¥l™_£Ëù_v¬IDs
.
»size
(
num_šd•’d’t_v¬ŸbËs
);

769 
	gd‘”mši¡ic_v¬IDs
.
»£rve
(
num_šd•’d’t_v¬ŸbËs
);

772 
size_t
 
	gi
 = 0; i < 
	g¥l™_£Ëù_weights
.
size
(); ++i) {

775 ià(
	g¥l™_£Ëù_weights
[
i
].
size
(è!ğ
num_šd•’d’t_v¬ŸbËs
) {

776 
throw
 
¡d
::
ruÁime_”rÜ
("Number of split select weights‚otƒqualo‚umber of independent variables.");

779 
size_t
 
	gj
 = 0; j < 
	g¥l™_£Ëù_weights
[
i
].
size
(); ++j) {

780 
	gweight
 = 
¥l™_£Ëù_weights
[
i
][
j
];

782 ià(
	gi
 == 0) {

783 
size_t
 
v¬ID
 = 
j
;

784 auto& 
	gsk
 : 
no_¥l™_v¬ŸbËs
) {

785 ià(
v¬ID
 >ğ
sk
) {

786 ++
v¬ID
;

790 ià(
	gweight
 == 1) {

791 
d‘”mši¡ic_v¬IDs
.
push_back
(
v¬ID
);

792 } ià(
	gweight
 < 1 && weight > 0) {

793 
	gthis
->
	g¥l™_£Ëù_v¬IDs
[
j
] = 
v¬ID
;

794 
	gthis
->
	g¥l™_£Ëù_weights
[
i
][
j
] = 
weight
;

795 } ià(
	gweight
 < 0 || weight > 1) {

796 
throw
 
	g¡d
::
ruÁime_”rÜ
("One or more split select weights‚ot in„ange [0,1].");

800 ià(
	gweight
 < 1 && weight > 0) {

801 
	gthis
->
	g¥l™_£Ëù_weights
[
i
][
j
] = 
weight
;

802 } ià(
	gweight
 < 0 || weight > 1) {

803 
throw
 
	g¡d
::
ruÁime_”rÜ
("One or more split select weights‚ot in„ange [0,1].");

809 ià(
	gd‘”mši¡ic_v¬IDs
.
size
(è> 
	gthis
->
	gmŒy
) {

810 
throw
 
	g¡d
::
ruÁime_”rÜ
("Number of ones in split select weights cannot be†argerhan mtry.");

812 ià(
	gd‘”mši¡ic_v¬IDs
.
size
(è+ 
	g¥l™_£Ëù_v¬IDs
.size(è< 
	gmŒy
) {

813 
throw
 
	g¡d
::
ruÁime_”rÜ
("Too many zeros in split select weights. Need‡t†east mtry variableso split‡t.");

817 
	gFÜe¡
::
£tAlwaysS¶™V¬ŸbËs
(
¡d
::
veùÜ
<¡d::
¡ršg
>& 
®ways_¥l™_v¬ŸbË_Çmes
) {

819 
d‘”mši¡ic_v¬IDs
.
»£rve
(
num_šd•’d’t_v¬ŸbËs
);

821 auto& 
	gv¬ŸbË_Çme
 : 
®ways_¥l™_v¬ŸbË_Çmes
) {

822 
size_t
 
v¬ID
 = 
d©a
->
g‘V¬ŸbËID
(
v¬ŸbË_Çme
);

823 
	gd‘”mši¡ic_v¬IDs
.
push_back
(
v¬ID
);

826 ià(
	gd‘”mši¡ic_v¬IDs
.
size
(è+ 
	gthis
->
	gmŒy
 > 
	gnum_šd•’d’t_v¬ŸbËs
) {

827 
throw
 
	g¡d
::
ruÁime_”rÜ
(

832 #ifdeà
OLD_WIN_R_BUILD


833 
	gFÜe¡
::
	$showProg»ss
(
¡d
::
¡ršg
 
İ”©iÚ
, 
şock_t
 
¡¬t_time
, clock_t& 
Ïp_time
) {

836 ià(
	`checkIÁ”ru±
()) {

837 
throw
 
¡d
::
	`ruÁime_”rÜ
("User interrupt.");

840 
–­£d_time
 = (
	`şock
(è- 
Ïp_time
è/ 
CLOCKS_PER_SEC
;

841 ià(
–­£d_time
 > 
STATUS_INTERVAL
) {

842 
»Ïtive_´og»ss
 = (è
´og»ss
 / (è
num_Œ“s
;

843 
time_äom_¡¬t
 = (
	`şock
(è- 
¡¬t_time
è/ 
CLOCKS_PER_SEC
;

844 
ušt
 
»maššg_time
 = (1 / 
»Ïtive_´og»ss
 - 1è* 
time_äom_¡¬t
;

845 *
v”bo£_out
 << 
İ”©iÚ
 << " Prog»ss: " << 
	`round
(100 * 
»Ïtive_´og»ss
) << "%. Estimated„emainingime: "

846 << 
	`b—utifyTime
(
»maššg_time
è<< "." << 
¡d
::
’dl
;

847 
Ïp_time
 = 
	`şock
();

849 
	}
}

851 
	gFÜe¡
::
	$showProg»ss
(
¡d
::
¡ršg
 
İ”©iÚ
) {

852 
usšg
 
¡d
::
chrÚo
::
¡—dy_şock
;

853 
usšg
 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
;

854 
usšg
 
¡d
::
chrÚo
::
£cÚds
;

856 
¡—dy_şock
::
time_pošt
 
¡¬t_time
 = s‹ady_şock::
	`now
();

857 
¡—dy_şock
::
time_pošt
 
Ï¡_time
 = s‹ady_şock::
	`now
();

858 
¡d
::
unique_lock
<¡d::
mu‹x
> 
	`lock
(mutex);

861 
´og»ss
 < 
num_Œ“s
) {

862 
cÚd™iÚ_v¬ŸbË
.
	`wa™
(
lock
);

863 
£cÚds
 
–­£d_time
 = 
du¿tiÚ_ÿ¡
<£cÚds>(
¡—dy_şock
::
	`now
(è- 
Ï¡_time
);

866 #ifdeà
R_BUILD


867 ià(!
abÜ‹d
 && 
	`checkIÁ”ru±
()) {

868 
abÜ‹d
 = 
Œue
;

870 ià(
abÜ‹d
 && 
abÜ‹d_th»ads
 >ğ
num_th»ads
) {

875 ià(
´og»ss
 > 0 && 
–­£d_time
.
	`couÁ
(è> 
STATUS_INTERVAL
) {

876 
»Ïtive_´og»ss
 = (è
´og»ss
 / (è
num_Œ“s
;

877 
£cÚds
 
time_äom_¡¬t
 = 
du¿tiÚ_ÿ¡
<£cÚds>(
¡—dy_şock
::
	`now
(è- 
¡¬t_time
);

878 
ušt
 
»maššg_time
 = (1 / 
»Ïtive_´og»ss
 - 1è* 
time_äom_¡¬t
.
	`couÁ
();

879 *
v”bo£_out
 << 
İ”©iÚ
 << " Prog»ss: " << 
	`round
(100 * 
»Ïtive_´og»ss
) << "%. Estimated„emainingime: "

880 << 
	`b—utifyTime
(
»maššg_time
è<< "." << 
¡d
::
’dl
;

881 
Ï¡_time
 = 
¡—dy_şock
::
	`now
();

884 
	}
}

	@Forest/Forest.h

29 #iâdeà
FOREST_H_


30 
	#FOREST_H_


	)

32 
	~<veùÜ
>

33 
	~<io¡»am
>

34 
	~<¿ndom
>

35 
	~<ùime
>

36 #iâdeà
OLD_WIN_R_BUILD


37 
	~<th»ad
>

38 
	~<chrÚo
>

39 
	~<mu‹x
>

40 
	~<cÚd™iÚ_v¬ŸbË
>

43 
	~"glob®s.h
"

44 
	~"T»e.h
"

45 
	~"D©a.h
"

47 şas 
	cFÜe¡
 {

48 
	mpublic
:

49 
FÜe¡
();

50 
	mvœtu®
 ~
FÜe¡
();

53 
š™Cµ
(
¡d
::
¡ršg
 
d•’d’t_v¬ŸbË_Çme
, 
MemÜyMode
 
memÜy_mode
, std::¡ršg 
šput_fe
, 
ušt
 
mŒy
,

54 
¡d
::
¡ršg
 
ouut_´efix
, 
ušt
 
num_Œ“s
, std::
o¡»am
* 
v”bo£_out
, ušˆ
£ed
, ušˆ
num_th»ads
,

55 
¡d
::
¡ršg
 
lßd_fÜe¡_f’ame
, 
ImpÜnûMode
 
impÜnû_mode
, 
ušt
 
mš_node_size
,

56 
¡d
::
¡ršg
 
¥l™_£Ëù_weights_fe
, std::
veùÜ
<¡d::¡ršg>& 
®ways_¥l™_v¬ŸbË_Çmes
,

57 
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
, 
boŞ
 
§m¶e_w™h_»¶aûm’t
,

58 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
unÜd”ed_v¬ŸbË_Çmes
, 
boŞ
 
memÜy_§všg_¥l™tšg
, 
S¶™RuË
 
¥l™ruË
,

59 
¡d
::
¡ršg
 
ÿ£_weights_fe
, 
boŞ
 
´ediù_®l
, 
§m¶e_äaùiÚ
, 
®pha
, 
mš´İ
, boŞ 
hŞdout
);

60 
š™R
(
¡d
::
¡ršg
 
d•’d’t_v¬ŸbË_Çme
, 
D©a
* 
šput_d©a
, 
ušt
 
mŒy
, ušˆ
num_Œ“s
,

61 
¡d
::
o¡»am
* 
v”bo£_out
, 
ušt
 
£ed
, ušˆ
num_th»ads
, 
ImpÜnûMode
 
impÜnû_mode
, ušˆ
mš_node_size
,

62 
¡d
::
veùÜ
<¡d::veùÜ<>>& 
¥l™_£Ëù_weights
, std::veùÜ<¡d::
¡ršg
>& 
®ways_¥l™_v¬ŸbË_Çmes
,

63 
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
, 
boŞ
 
´ediùiÚ_mode
, boŞ 
§m¶e_w™h_»¶aûm’t
,

64 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
unÜd”ed_v¬ŸbË_Çmes
, 
boŞ
 
memÜy_§všg_¥l™tšg
, 
S¶™RuË
 
¥l™ruË
,

65 
¡d
::
veùÜ
<>& 
ÿ£_weights
, 
boŞ
 
´ediù_®l
, boŞ 
k“p_šbag
, 
§m¶e_äaùiÚ
, 
®pha
,

66 
mš´İ
, 
boŞ
 
hŞdout
);

67 
š™
(
¡d
::
¡ršg
 
d•’d’t_v¬ŸbË_Çme
, 
MemÜyMode
 
memÜy_mode
, 
D©a
* 
šput_d©a
, 
ušt
 
mŒy
,

68 
¡d
::
¡ršg
 
ouut_´efix
, 
ušt
 
num_Œ“s
, ušˆ
£ed
, ušˆ
num_th»ads
, 
ImpÜnûMode
 
impÜnû_mode
,

69 
ušt
 
mš_node_size
, 
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
, 
boŞ
 
´ediùiÚ_mode
, boŞ 
§m¶e_w™h_»¶aûm’t
,

70 
¡d
::
veùÜ
<¡d::
¡ršg
>& 
unÜd”ed_v¬ŸbË_Çmes
, 
boŞ
 
memÜy_§všg_¥l™tšg
, 
S¶™RuË
 
¥l™ruË
,

71 
boŞ
 
´ediù_®l
, 
§m¶e_äaùiÚ
, 
®pha
, 
mš´İ
, boŞ 
hŞdout
);

72 
vœtu®
 
š™IÁ”Çl
(
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
) = 0;

75 
run
(
boŞ
 
v”bo£
);

78 
wr™eOuut
();

79 
vœtu®
 
wr™eOuutIÁ”Çl
() = 0;

80 
vœtu®
 
wr™eCÚfusiÚFe
() = 0;

81 
vœtu®
 
wr™eP»diùiÚFe
() = 0;

82 
wr™eImpÜnûFe
();

85 
§veToFe
();

86 
vœtu®
 
§veToFeIÁ”Çl
(
¡d
::
of¡»am
& 
outfe
) = 0;

88 
	m¡d
::
veùÜ
<
¡d
::veùÜ<¡d::veùÜ<
size_t
>>>
	$g‘ChdNodeIDs
() {

89 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<
size_t
>>> 
»suÉ
;

90 auto& 
Œ“
 : 
Œ“s
) {

91 
»suÉ
.
	`push_back
(
Œ“
->
	`g‘ChdNodeIDs
());

93  
»suÉ
;

95 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>> 
	$g‘S¶™V¬IDs
() {

96 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>> 
»suÉ
;

97 auto& 
Œ“
 : 
Œ“s
) {

98 
»suÉ
.
	`push_back
(
Œ“
->
	`g‘S¶™V¬IDs
());

100  
»suÉ
;

101 
	}
}

102 
	g¡d
::
veùÜ
<
¡d
::veùÜ<>> 
	$g‘S¶™V®ues
() {

103 
¡d
::
veùÜ
<¡d::veùÜ<>> 
»suÉ
;

104 auto& 
Œ“
 : 
Œ“s
) {

105 
»suÉ
.
	`push_back
(
Œ“
->
	`g‘S¶™V®ues
());

107  
»suÉ
;

108 
	}
}

109 cÚ¡ 
	g¡d
::
veùÜ
<>& 
	$g‘V¬ŸbËImpÜnû
() const {

110  
v¬ŸbË_impÜnû
;

111 
	}
}

112 
	$g‘Ov”®lP»diùiÚE¼Ü
() const {

113  
ov”®l_´ediùiÚ_”rÜ
;

114 
	}
}

115 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::veùÜ<> >& 
	$g‘P»diùiÚs
() const {

116  
´ediùiÚs
;

117 
	}
}

118 
size_t
 
	$g‘D•’d’tV¬Id
() const {

119  
d•’d’t_v¬ID
;

120 
	}
}

121 
size_t
 
	$g‘NumT»es
() const {

122  
num_Œ“s
;

123 
	}
}

124 
ušt
 
	$g‘MŒy
() const

126  
mŒy
;

127 
	}
}

128 
ušt
 
	$g‘MšNodeSize
() const

130  
mš_node_size
;

131 
	}
}

132 
size_t
 
	$g‘NumInd•’d’tV¬ŸbËs
() const

134  
num_šd•’d’t_v¬ŸbËs
;

135 
	}
}

136 cÚ¡ 
	g¡d
::
veùÜ
<
boŞ
>& 
	$g‘IsOrd”edV¬ŸbË
() const

138  
is_Üd”ed_v¬ŸbË
;

139 
	}
}

141 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
size_t
>> 
	$g‘InbagCouÁs
() const {

142 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>> 
»suÉ
;

143 auto& 
Œ“
 : 
Œ“s
) {

144 
»suÉ
.
	`push_back
(
Œ“
->
	`g‘InbagCouÁs
());

146  
»suÉ
;

147 
	}
}

149 
	g´Ùeùed
:

150 
grow
();

151 
vœtu®
 
growIÁ”Çl
() = 0;

154 
´ediù
();

155 
vœtu®
 
´ediùIÁ”Çl
() = 0;

157 
compu‹P»diùiÚE¼Ü
();

158 
vœtu®
 
compu‹P»diùiÚE¼ÜIÁ”Çl
() = 0;

160 
compu‹P”mutiÚImpÜnû
();

163 
growT»esInTh»ad
(
ušt
 
th»ad_idx
, 
¡d
::
veùÜ
<>* 
v¬ŸbË_impÜnû
);

164 
´ediùT»esInTh»ad
(
ušt
 
th»ad_idx
, cÚ¡ 
D©a
* 
´ediùiÚ_d©a
, 
boŞ
 
oob_´ediùiÚ
);

165 
compu‹T»eP”mutiÚImpÜnûInTh»ad
(
ušt
 
th»ad_idx
, 
¡d
::
veùÜ
<>* 
impÜnû
, std::veùÜ<>* 
v¬Ÿnû
);

168 
lßdFromFe
(
¡d
::
¡ršg
 
f’ame
);

169 
vœtu®
 
lßdFromFeIÁ”Çl
(
¡d
::
if¡»am
& 
šfe
) = 0;

172 
£tS¶™WeightVeùÜ
(
¡d
::
veùÜ
<¡d::veùÜ<>>& 
¥l™_£Ëù_weights
);

173 
£tAlwaysS¶™V¬ŸbËs
(
¡d
::
veùÜ
<¡d::
¡ršg
>& 
®ways_¥l™_v¬ŸbË_Çmes
);

176 #ifdeà
OLD_WIN_R_BUILD


177 
showProg»ss
(
¡d
::
¡ršg
 
İ”©iÚ
, 
şock_t
 
¡¬t_time
, clock_t& 
Ïp_time
);

179 
showProg»ss
(
¡d
::
¡ršg
 
İ”©iÚ
);

183 
	g¡d
::
o¡»am
* 
v”bo£_out
;

185 
size_t
 
	gnum_Œ“s
;

186 
ušt
 
	gmŒy
;

187 
ušt
 
	gmš_node_size
;

188 
size_t
 
	gnum_v¬ŸbËs
;

189 
size_t
 
	gnum_šd•’d’t_v¬ŸbËs
;

190 
ušt
 
	g£ed
;

191 
size_t
 
	gd•’d’t_v¬ID
;

192 
size_t
 
	gnum_§m¶es
;

193 
boŞ
 
	g´ediùiÚ_mode
;

194 
MemÜyMode
 
	gmemÜy_mode
;

195 
boŞ
 
	g§m¶e_w™h_»¶aûm’t
;

196 
boŞ
 
	gmemÜy_§všg_¥l™tšg
;

197 
S¶™RuË
 
	g¥l™ruË
;

198 
boŞ
 
	g´ediù_®l
;

199 
boŞ
 
	gk“p_šbag
;

200 
	g§m¶e_äaùiÚ
;

201 
boŞ
 
	ghŞdout
;

204 
	g®pha
;

205 
	gmš´İ
;

208 
	g¡d
::
veùÜ
<
boŞ
> 
is_Üd”ed_v¬ŸbË
;

211 
	g¡d
::
veùÜ
<
size_t
> 
no_¥l™_v¬ŸbËs
;

214 
ušt
 
	gnum_th»ads
;

215 
	g¡d
::
veùÜ
<
ušt
> 
th»ad_¿nges
;

216 #iâdeà
OLD_WIN_R_BUILD


217 
	g¡d
::
mu‹x
 mutex;

218 
	g¡d
::
cÚd™iÚ_v¬ŸbË
 condition_variable;

221 
	g¡d
::
veùÜ
<
T»e
*> 
Œ“s
;

222 
D©a
* 
	gd©a
;

224 
	g¡d
::
veùÜ
<
¡d
::veùÜ<>> 
´ediùiÚs
;

225 
	gov”®l_´ediùiÚ_”rÜ
;

229 
	g¡d
::
veùÜ
<
size_t
> 
d‘”mši¡ic_v¬IDs
;

230 
	g¡d
::
veùÜ
<
size_t
> 
¥l™_£Ëù_v¬IDs
;

231 
	g¡d
::
veùÜ
<
¡d
::veùÜ<>> 
¥l™_£Ëù_weights
;

234 
	g¡d
::
veùÜ
<> 
ÿ£_weights
;

237 
	g¡d
::
mt19937_64
 
¿ndom_numb”_g’”©Ü
;

239 
	g¡d
::
¡ršg
 
ouut_´efix
;

240 
ImpÜnûMode
 
	gimpÜnû_mode
;

243 
	g¡d
::
veùÜ
<> 
v¬ŸbË_impÜnû
;

246 
size_t
 
	g´og»ss
;

247 #ifdeà
R_BUILD


248 
size_t
 
	gabÜ‹d_th»ads
;

249 
boŞ
 
	gabÜ‹d
;

252 
	g´iv©e
:

253 
DISALLOW_COPY_AND_ASSIGN
(
FÜe¡
);

	@Forest/ForestClassification.cpp

29 
	~<unÜd”ed_m­
>

30 
	~<®gÜ™hm
>

31 
	~<™”©Ü
>

32 
	~<¿ndom
>

33 
	~<¡dexû±
>

34 
	~<cm©h
>

35 
	~<¡ršg
>

37 
	~"ut™y.h
"

38 
	~"FÜe¡CÏssifiÿtiÚ.h
"

39 
	~"T»eCÏssifiÿtiÚ.h
"

40 
	~"D©a.h
"

42 
	gFÜe¡CÏssifiÿtiÚ
::
	$FÜe¡CÏssifiÿtiÚ
() {

43 
	}
}

45 
FÜe¡CÏssifiÿtiÚ
::~
	$FÜe¡CÏssifiÿtiÚ
() {

46 
	}
}

48 
FÜe¡CÏssifiÿtiÚ
::
lßdFÜe¡
(
size_t
 
d•’d’t_v¬ID
, size_ˆ
num_Œ“s
,

49 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<
size_t
>> >& 
fÜe¡_chd_nodeIDs
,

50 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
fÜe¡_¥l™_v¬IDs
, std::veùÜ<¡d::veùÜ<>>& 
fÜe¡_¥l™_v®ues
,

51 
¡d
::
veùÜ
<>& 
şass_v®ues
, std::veùÜ<
boŞ
>& 
is_Üd”ed_v¬ŸbË
) {

53 
this
->
d•’d’t_v¬ID
 = dependent_varID;

54 
	gthis
->
	gnum_Œ“s
 = 
num_Œ“s
;

55 
	gthis
->
	gşass_v®ues
 = 
şass_v®ues
;

56 
	gthis
->
	gis_Üd”ed_v¬ŸbË
 = 
is_Üd”ed_v¬ŸbË
;

59 
	gŒ“s
.
»£rve
(
num_Œ“s
);

60 
size_t
 
	gi
 = 0; i < 
	gnum_Œ“s
; ++i) {

61 
T»e
* 
	gŒ“
 = 
Ãw
 
T»eCÏssifiÿtiÚ
(
fÜe¡_chd_nodeIDs
[
i
], 
fÜe¡_¥l™_v¬IDs
[i], 
fÜe¡_¥l™_v®ues
[i],

62 &
this
->
şass_v®ues
, &
»¥Ú£_şassIDs
, &this->
is_Üd”ed_v¬ŸbË
);

63 
	gŒ“s
.
push_back
(
Œ“
);

67 
equ®S¶™
(
th»ad_¿nges
, 0, 
num_Œ“s
 - 1, 
num_th»ads
);

70 
	gFÜe¡CÏssifiÿtiÚ
::
	$š™IÁ”Çl
(
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
) {

73 ià(
mŒy
 == 0) {

74 
‹mp
 = 
	`sq¹
((è(
num_v¬ŸbËs
 - 1));

75 
mŒy
 = 
¡d
::
	`max
((è1, 
‹mp
);

79 ià(
mš_node_size
 == 0) {

80 
mš_node_size
 = 
DEFAULT_MIN_NODE_SIZE_CLASSIFICATION
;

84 ià(!
´ediùiÚ_mode
) {

85 
size_t
 
i
 = 0; i < 
num_§m¶es
; ++i) {

86 
v®ue
 = 
d©a
->
	`g‘
(
i
, 
d•’d’t_v¬ID
);

89 
ušt
 
şassID
 = 
	`fšd
(
şass_v®ues
.
	`begš
(), cÏss_v®ues.
	`’d
(), 
v®ue
) - class_values.begin();

90 ià(
şassID
 =ğ
şass_v®ues
.
	`size
()) {

91 
şass_v®ues
.
	`push_back
(
v®ue
);

93 
»¥Ú£_şassIDs
.
	`push_back
(
şassID
);

98 ià(!
memÜy_§všg_¥l™tšg
) {

99 
d©a
->
	`sÜt
();

101 
	}
}

103 
	gFÜe¡CÏssifiÿtiÚ
::
	$growIÁ”Çl
() {

104 
Œ“s
.
	`»£rve
(
num_Œ“s
);

105 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

106 
Œ“s
.
	`push_back
(
Ãw
 
	`T»eCÏssifiÿtiÚ
(&
şass_v®ues
, &
»¥Ú£_şassIDs
));

108 
	}
}

110 
	gFÜe¡CÏssifiÿtiÚ
::
	$´ediùIÁ”Çl
() {

113 
size_t
 
num_´ediùiÚ_§m¶es
 = 
d©a
->
	`g‘NumRows
();

114 
´ediùiÚs
.
	`»£rve
(
num_´ediùiÚ_§m¶es
);

117 
size_t
 
§m¶e_idx
 = 0; sam¶e_idx < 
num_´ediùiÚ_§m¶es
; ++sample_idx) {

119 ià(
´ediù_®l
) {

121 
¡d
::
veùÜ
<> 
§m¶e_´ediùiÚs
;

122 
§m¶e_´ediùiÚs
.
	`»£rve
(
num_Œ“s
);

123 
size_t
 
Œ“_idx
 = 0;»e_idx < 
num_Œ“s
; ++tree_idx) {

124 
v®ue
 = ((
T»eCÏssifiÿtiÚ
*è
Œ“s
[
Œ“_idx
])->
	`g‘P»diùiÚ
(
§m¶e_idx
);

125 
§m¶e_´ediùiÚs
.
	`push_back
(
v®ue
);

127 
´ediùiÚs
.
	`push_back
(
§m¶e_´ediùiÚs
);

130 
¡d
::
unÜd”ed_m­
<, 
size_t
> 
şass_couÁ
;

131 
size_t
 
Œ“_idx
 = 0;»e_idx < 
num_Œ“s
; ++tree_idx) {

132 
v®ue
 = ((
T»eCÏssifiÿtiÚ
*è
Œ“s
[
Œ“_idx
])->
	`g‘P»diùiÚ
(
§m¶e_idx
);

133 ++
şass_couÁ
[
v®ue
];

136 
¡d
::
veùÜ
<> 
‹mp
;

137 
‹mp
.
	`push_back
(
	`mo¡F»qu’tV®ue
(
şass_couÁ
, 
¿ndom_numb”_g’”©Ü
));

138 
´ediùiÚs
.
	`push_back
(
‹mp
);

142 
	}
}

144 
	gFÜe¡CÏssifiÿtiÚ
::
	$compu‹P»diùiÚE¼ÜIÁ”Çl
() {

147 
¡d
::
veùÜ
<¡d::
unÜd”ed_m­
<, 
size_t
>> 
şass_couÁs
;

148 
şass_couÁs
.
	`»£rve
(
num_§m¶es
);

149 
size_t
 
i
 = 0; i < 
num_§m¶es
; ++i) {

150 
şass_couÁs
.
	`push_back
(
¡d
::
unÜd”ed_m­
<, 
size_t
>());

154 
size_t
 
Œ“_idx
 = 0;»e_idx < 
num_Œ“s
; ++tree_idx) {

155 
size_t
 
§m¶e_idx
 = 0; sam¶e_idx < 
Œ“s
[
Œ“_idx
]->
	`g‘NumSam¶esOob
(); ++sample_idx) {

156 
size_t
 
§m¶eID
 = 
Œ“s
[
Œ“_idx
]->
	`g‘OobSam¶eIDs
()[
§m¶e_idx
];

157 
v®ue
 = ((
T»eCÏssifiÿtiÚ
*è
Œ“s
[
Œ“_idx
])->
	`g‘P»diùiÚ
(
§m¶e_idx
);

158 ++
şass_couÁs
[
§m¶eID
][
v®ue
];

163 
´ediùiÚs
.
	`»£rve
(
num_§m¶es
);

164 
size_t
 
i
 = 0; i < 
num_§m¶es
; ++i) {

165 
¡d
::
veùÜ
<> 
‹mp
;

166 ià(!
şass_couÁs
[
i
].
	`em±y
()) {

167 
‹mp
.
	`push_back
(
	`mo¡F»qu’tV®ue
(
şass_couÁs
[
i
], 
¿ndom_numb”_g’”©Ü
));

169 
‹mp
.
	`push_back
(
NAN
);

171 
´ediùiÚs
.
	`push_back
(
‹mp
);

175 
size_t
 
num_missşassifiÿtiÚs
 = 0;

176 
size_t
 
i
 = 0; i < 
´ediùiÚs
.
	`size
(); ++i) {

177 
´ediùed_v®ue
 = 
´ediùiÚs
[
i
][0];

178 ià(!
¡d
::
	`i¢ª
(
´ediùed_v®ue
)) {

179 
»®_v®ue
 = 
d©a
->
	`g‘
(
i
, 
d•’d’t_v¬ID
);

180 ià(
´ediùed_v®ue
 !ğ
»®_v®ue
) {

181 ++
num_missşassifiÿtiÚs
;

183 ++
şassifiÿtiÚ_bË
[
¡d
::
	`make_·œ
(
»®_v®ue
, 
´ediùed_v®ue
)];

186 
ov”®l_´ediùiÚ_”rÜ
 = (è
num_missşassifiÿtiÚs
 / (è
´ediùiÚs
.
	`size
();

187 
	}
}

189 
	gFÜe¡CÏssifiÿtiÚ
::
	$wr™eOuutIÁ”Çl
() {

190 *
v”bo£_out
 << "T»ty³: " << "CÏssifiÿtiÚ" << 
¡d
::
’dl
;

191 
	}
}

193 
	gFÜe¡CÏssifiÿtiÚ
::
	$wr™eCÚfusiÚFe
() {

196 
¡d
::
¡ršg
 
f’ame
 = 
ouut_´efix
 + ".confusion";

197 
¡d
::
of¡»am
 
outfe
;

198 
outfe
.
	`İ’
(
f’ame
, 
¡d
::
ios
::
out
);

199 ià(!
outfe
.
	`good
()) {

200 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù wr™tØcÚfusiÚ fe: " + 
f’ame
 + ".");

204 
outfe
 << "Ov”®ÈOOB…»diùiÚƒ¼Ü (F¿ùiÚ missşassif›d): " << 
ov”®l_´ediùiÚ_”rÜ
 << 
¡d
::
’dl
;

205 
outfe
 << 
¡d
::
’dl
;

206 
outfe
 << "CÏs ¥ecifiø´ediùiÚƒ¼Üs:" << 
¡d
::
’dl
;

207 
outfe
 << " ";

208 auto& 
şass_v®ue
 : 
şass_v®ues
) {

209 
outfe
 << " " << 
şass_v®ue
;

211 
outfe
 << 
¡d
::
’dl
;

212 auto& 
´ediùed_v®ue
 : 
şass_v®ues
) {

213 
outfe
 << "´ediùed " << 
´ediùed_v®ue
 << " ";

214 auto& 
»®_v®ue
 : 
şass_v®ues
) {

215 
size_t
 
v®ue
 = 
şassifiÿtiÚ_bË
[
¡d
::
	`make_·œ
(
»®_v®ue
, 
´ediùed_v®ue
)];

216 
outfe
 << 
v®ue
;

217 ià(
v®ue
 < 10) {

218 
outfe
 << " ";

219 } ià(
v®ue
 < 100) {

220 
outfe
 << " ";

221 } ià(
v®ue
 < 1000) {

222 
outfe
 << " ";

223 } ià(
v®ue
 < 10000) {

224 
outfe
 << " ";

225 } ià(
v®ue
 < 100000) {

226 
outfe
 << " ";

229 
outfe
 << 
¡d
::
’dl
;

232 
outfe
.
	`şo£
();

233 *
v”bo£_out
 << "Saved cÚfusiÚ m©rixØf" << 
f’ame
 << "." << 
¡d
::
’dl
;

234 
	}
}

236 
	gFÜe¡CÏssifiÿtiÚ
::
	$wr™eP»diùiÚFe
() {

239 
¡d
::
¡ršg
 
f’ame
 = 
ouut_´efix
 + ".prediction";

240 
¡d
::
of¡»am
 
outfe
;

241 
outfe
.
	`İ’
(
f’ame
, 
¡d
::
ios
::
out
);

242 ià(!
outfe
.
	`good
()) {

243 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù wr™tØ´ediùiÚ fe: " + 
f’ame
 + ".");

247 
outfe
 << "P»diùiÚs: " << 
¡d
::
’dl
;

248 
size_t
 
i
 = 0; i < 
´ediùiÚs
.
	`size
(); ++i) {

249 
size_t
 
j
 = 0; j < 
´ediùiÚs
[
i
].
	`size
(); ++j) {

250 
outfe
 << 
´ediùiÚs
[
i
][
j
] << " ";

252 
outfe
 << 
¡d
::
’dl
;

255 *
v”bo£_out
 << "Saved…»diùiÚ tØf" << 
f’ame
 << "." << 
¡d
::
’dl
;

256 
	}
}

258 
	gFÜe¡CÏssifiÿtiÚ
::
	$§veToFeIÁ”Çl
(
¡d
::
of¡»am
& 
outfe
) {

261 
outfe
.
	`wr™e
((*è&
num_v¬ŸbËs
, (num_variables));

264 
T»eTy³
 
Œ“ty³
 = 
TREE_CLASSIFICATION
;

265 
outfe
.
	`wr™e
((*è&
Œ“ty³
, (treetype));

268 
	`§veVeùÜ1D
(
şass_v®ues
, 
outfe
);

269 
	}
}

271 
	gFÜe¡CÏssifiÿtiÚ
::
	$lßdFromFeIÁ”Çl
(
¡d
::
if¡»am
& 
šfe
) {

274 
size_t
 
num_v¬ŸbËs_§ved
;

275 
šfe
.
	`»ad
((*è&
num_v¬ŸbËs_§ved
, (num_variables_saved));

278 
T»eTy³
 
Œ“ty³
;

279 
šfe
.
	`»ad
((*è&
Œ“ty³
, (treetype));

280 ià(
Œ“ty³
 !ğ
TREE_CLASSIFICATION
) {

281 
throw
 
¡d
::
	`ruÁime_”rÜ
("Wrongreetype. Loaded file is‚ot‡ classification forest.");

285 
	`»adVeùÜ1D
(
şass_v®ues
, 
šfe
);

287 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

290 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>> 
chd_nodeIDs
;

291 
	`»adVeùÜ2D
(
chd_nodeIDs
, 
šfe
);

292 
¡d
::
veùÜ
<
size_t
> 
¥l™_v¬IDs
;

293 
	`»adVeùÜ1D
(
¥l™_v¬IDs
, 
šfe
);

294 
¡d
::
veùÜ
<> 
¥l™_v®ues
;

295 
	`»adVeùÜ1D
(
¥l™_v®ues
, 
šfe
);

298 ià(
num_v¬ŸbËs_§ved
 > 
num_v¬ŸbËs
) {

299 auto& 
v¬ID
 : 
¥l™_v¬IDs
) {

300 ià(
v¬ID
 >ğ
d•’d’t_v¬ID
) {

301 --
v¬ID
;

307 
T»e
* 
Œ“
 = 
Ãw
 
	`T»eCÏssifiÿtiÚ
(
chd_nodeIDs
, 
¥l™_v¬IDs
, 
¥l™_v®ues
, &
şass_v®ues
, &
»¥Ú£_şassIDs
,

308 &
is_Üd”ed_v¬ŸbË
);

309 
Œ“s
.
	`push_back
(
Œ“
);

311 
	}
}

	@Forest/ForestClassification.h

29 #iâdeà
FORESTCLASSIFICATION_H_


30 
	#FORESTCLASSIFICATION_H_


	)

32 
	~<io¡»am
>

33 
	~<m­
>

34 
	~<ut™y
>

35 
	~<veùÜ
>

37 
	~"glob®s.h
"

38 
	~"FÜe¡.h
"

40 şas 
	cFÜe¡CÏssifiÿtiÚ
: 
public
 
FÜe¡
 {

41 
public
:

42 
FÜe¡CÏssifiÿtiÚ
();

43 
	mvœtu®
 ~
FÜe¡CÏssifiÿtiÚ
();

45 
lßdFÜe¡
(
size_t
 
d•’d’t_v¬ID
, size_ˆ
num_Œ“s
,

46 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<
size_t
>> >& 
fÜe¡_chd_nodeIDs
,

47 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
fÜe¡_¥l™_v¬IDs
, std::veùÜ<¡d::veùÜ<>>& 
fÜe¡_¥l™_v®ues
,

48 
¡d
::
veùÜ
<>& 
şass_v®ues
, std::veùÜ<
boŞ
>& 
is_Üd”ed_v¬ŸbË
);

50 cÚ¡ 
	m¡d
::
veùÜ
<>& 
	$g‘CÏssV®ues
() const {

51  
şass_v®ues
;

54 
´Ùeùed
:

55 
	`š™IÁ”Çl
(
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
);

56 
	`growIÁ”Çl
();

57 
	`´ediùIÁ”Çl
();

58 
	`compu‹P»diùiÚE¼ÜIÁ”Çl
();

59 
	`wr™eOuutIÁ”Çl
();

60 
	`wr™eCÚfusiÚFe
();

61 
	`wr™eP»diùiÚFe
();

62 
	`§veToFeIÁ”Çl
(
¡d
::
of¡»am
& 
outfe
);

63 
	`lßdFromFeIÁ”Çl
(
¡d
::
if¡»am
& 
šfe
);

66 
¡d
::
veùÜ
<> 
şass_v®ues
;

67 
¡d
::
veùÜ
<
ušt
> 
»¥Ú£_şassIDs
;

70 
¡d
::
m­
<¡d::
·œ
<, >, 
size_t
> 
şassifiÿtiÚ_bË
;

72 
´iv©e
:

73 
	`DISALLOW_COPY_AND_ASSIGN
(
FÜe¡CÏssifiÿtiÚ
);

74 
	}
};

	@Forest/ForestProbability.cpp

29 
	~<¡dexû±
>

31 
	~"ut™y.h
"

32 
	~"FÜe¡Probab™y.h
"

33 
	~"T»eProbab™y.h
"

34 
	~"D©a.h
"

36 
	gFÜe¡Probab™y
::
	$FÜe¡Probab™y
() {

37 
	}
}

39 
FÜe¡Probab™y
::~
	$FÜe¡Probab™y
() {

40 
	}
}

42 
FÜe¡Probab™y
::
lßdFÜe¡
(
size_t
 
d•’d’t_v¬ID
, size_ˆ
num_Œ“s
,

43 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<
size_t
>> >& 
fÜe¡_chd_nodeIDs
,

44 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
fÜe¡_¥l™_v¬IDs
, std::veùÜ<¡d::veùÜ<>>& 
fÜe¡_¥l™_v®ues
,

45 
¡d
::
veùÜ
<>& 
şass_v®ues
, std::veùÜ<¡d::veùÜ<¡d::veùÜ<>>>& 
fÜe¡_‹rmš®_şass_couÁs
, std::veùÜ<
boŞ
>& 
is_Üd”ed_v¬ŸbË
) {

47 
this
->
d•’d’t_v¬ID
 = dependent_varID;

48 
	gthis
->
	gnum_Œ“s
 = 
num_Œ“s
;

49 
	gthis
->
	gşass_v®ues
 = 
şass_v®ues
;

50 
	gthis
->
	gis_Üd”ed_v¬ŸbË
 = 
is_Üd”ed_v¬ŸbË
;

53 
	gŒ“s
.
»£rve
(
num_Œ“s
);

54 
size_t
 
	gi
 = 0; i < 
	gnum_Œ“s
; ++i) {

55 
T»e
* 
	gŒ“
 = 
Ãw
 
T»eProbab™y
(
fÜe¡_chd_nodeIDs
[
i
], 
fÜe¡_¥l™_v¬IDs
[i], 
fÜe¡_¥l™_v®ues
[i],

56 &
this
->
şass_v®ues
, &
»¥Ú£_şassIDs
, 
fÜe¡_‹rmš®_şass_couÁs
[
i
], &this->
is_Üd”ed_v¬ŸbË
);

57 
	gŒ“s
.
push_back
(
Œ“
);

61 
equ®S¶™
(
th»ad_¿nges
, 0, 
num_Œ“s
 - 1, 
num_th»ads
);

64 
	gFÜe¡Probab™y
::
	$š™IÁ”Çl
(
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
) {

67 ià(
mŒy
 == 0) {

68 
‹mp
 = 
	`sq¹
((è(
num_v¬ŸbËs
 - 1));

69 
mŒy
 = 
¡d
::
	`max
((è1, 
‹mp
);

73 ià(
mš_node_size
 == 0) {

74 
mš_node_size
 = 
DEFAULT_MIN_NODE_SIZE_PROBABILITY
;

78 ià(!
´ediùiÚ_mode
) {

79 
size_t
 
i
 = 0; i < 
num_§m¶es
; ++i) {

80 
v®ue
 = 
d©a
->
	`g‘
(
i
, 
d•’d’t_v¬ID
);

83 
ušt
 
şassID
 = 
	`fšd
(
şass_v®ues
.
	`begš
(), cÏss_v®ues.
	`’d
(), 
v®ue
) - class_values.begin();

84 ià(
şassID
 =ğ
şass_v®ues
.
	`size
()) {

85 
şass_v®ues
.
	`push_back
(
v®ue
);

87 
»¥Ú£_şassIDs
.
	`push_back
(
şassID
);

92 ià(!
memÜy_§všg_¥l™tšg
) {

93 
d©a
->
	`sÜt
();

95 
	}
}

97 
	gFÜe¡Probab™y
::
	$growIÁ”Çl
() {

98 
Œ“s
.
	`»£rve
(
num_Œ“s
);

99 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

100 
Œ“s
.
	`push_back
(
Ãw
 
	`T»eProbab™y
(&
şass_v®ues
, &
»¥Ú£_şassIDs
));

102 
	}
}

104 
	gFÜe¡Probab™y
::
	$´ediùIÁ”Çl
() {

107 
size_t
 
num_´ediùiÚ_§m¶es
 = 
d©a
->
	`g‘NumRows
();

108 
´ediùiÚs
.
	`»size
(
num_´ediùiÚ_§m¶es
);

109 
size_t
 
i
 = 0; i < 
num_´ediùiÚ_§m¶es
; ++i) {

110 
´ediùiÚs
[
i
].
	`»size
(
şass_v®ues
.
	`size
(), 0);

114 
size_t
 
§m¶e_idx
 = 0; sam¶e_idx < 
num_´ediùiÚ_§m¶es
; ++sample_idx) {

117 
size_t
 
Œ“_idx
 = 0;»e_idx < 
num_Œ“s
; ++tree_idx) {

118 
¡d
::
veùÜ
<> 
couÁs
 = ((
T»eProbab™y
*è
Œ“s
[
Œ“_idx
])->
	`g‘P»diùiÚ
(
§m¶e_idx
);

120 
size_t
 
şass_idx
 = 0; cÏss_idx < 
couÁs
.
	`size
(); ++class_idx) {

121 
´ediùiÚs
[
§m¶e_idx
][
şass_idx
] +ğ
couÁs
[şass_idx] / 
num_Œ“s
;

126 
	}
}

128 
	gFÜe¡Probab™y
::
	$compu‹P»diùiÚE¼ÜIÁ”Çl
() {

131 
¡d
::
veùÜ
<
size_t
> 
§m¶es_oob_couÁ
;

132 
§m¶es_oob_couÁ
.
	`»size
(
num_§m¶es
, 0);

133 
´ediùiÚs
.
	`»size
(
num_§m¶es
);

134 
size_t
 
i
 = 0; i < 
num_§m¶es
; ++i) {

135 
´ediùiÚs
[
i
].
	`»size
(
şass_v®ues
.
	`size
(), 0);

138 
size_t
 
Œ“_idx
 = 0;»e_idx < 
num_Œ“s
; ++tree_idx) {

139 
size_t
 
§m¶e_idx
 = 0; sam¶e_idx < 
Œ“s
[
Œ“_idx
]->
	`g‘NumSam¶esOob
(); ++sample_idx) {

140 
size_t
 
§m¶eID
 = 
Œ“s
[
Œ“_idx
]->
	`g‘OobSam¶eIDs
()[
§m¶e_idx
];

141 
¡d
::
veùÜ
<> 
couÁs
 = ((
T»eProbab™y
*è
Œ“s
[
Œ“_idx
])->
	`g‘P»diùiÚ
(
§m¶e_idx
);

143 
size_t
 
şass_idx
 = 0; cÏss_idx < 
couÁs
.
	`size
(); ++class_idx) {

144 
´ediùiÚs
[
§m¶eID
][
şass_idx
] +ğ
couÁs
[class_idx];

146 ++
§m¶es_oob_couÁ
[
§m¶eID
];

151 
size_t
 
i
 = 0; i < 
´ediùiÚs
.
	`size
(); ++i) {

152 ià(
§m¶es_oob_couÁ
[
i
] > 0) {

153 
size_t
 
j
 = 0; j < 
´ediùiÚs
[
i
].
	`size
(); ++j) {

154 
´ediùiÚs
[
i
][
j
] /ğ(è
§m¶es_oob_couÁ
[i];

156 
size_t
 
»®_şassID
 = 
»¥Ú£_şassIDs
[
i
];

157 
´ediùed_v®ue
 = 
´ediùiÚs
[
i
][
»®_şassID
];

158 
ov”®l_´ediùiÚ_”rÜ
 +ğ(1 - 
´ediùed_v®ue
) * (1 -…redicted_value);

162 
ov”®l_´ediùiÚ_”rÜ
 /ğ(è
´ediùiÚs
.
	`size
();

163 
	}
}

165 
	gFÜe¡Probab™y
::
	$wr™eOuutIÁ”Çl
() {

166 *
v”bo£_out
 << "T»ty³: " << "Probab™yƒ¡im©iÚ" << 
¡d
::
’dl
;

167 
	}
}

169 
	gFÜe¡Probab™y
::
	$wr™eCÚfusiÚFe
() {

172 
¡d
::
¡ršg
 
f’ame
 = 
ouut_´efix
 + ".confusion";

173 
¡d
::
of¡»am
 
outfe
;

174 
outfe
.
	`İ’
(
f’ame
, 
¡d
::
ios
::
out
);

175 ià(!
outfe
.
	`good
()) {

176 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù wr™tØcÚfusiÚ fe: " + 
f’ame
 + ".");

180 
outfe
 << "Ov”®ÈOOB…»diùiÚƒ¼Ü (MSE): " << 
ov”®l_´ediùiÚ_”rÜ
 << 
¡d
::
’dl
;

182 
outfe
.
	`şo£
();

183 *
v”bo£_out
 << "Saved…»diùiÚƒ¼ÜØf" << 
f’ame
 << "." << 
¡d
::
’dl
;

184 
	}
}

186 
	gFÜe¡Probab™y
::
	$wr™eP»diùiÚFe
() {

189 
¡d
::
¡ršg
 
f’ame
 = 
ouut_´efix
 + ".prediction";

190 
¡d
::
of¡»am
 
outfe
;

191 
outfe
.
	`İ’
(
f’ame
, 
¡d
::
ios
::
out
);

192 ià(!
outfe
.
	`good
()) {

193 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù wr™tØ´ediùiÚ fe: " + 
f’ame
 + ".");

197 
outfe
 << "CÏs ´ediùiÚs, oÃ sam¶³¸row." << 
¡d
::
’dl
;

198 auto& 
şass_v®ue
 : 
şass_v®ues
) {

199 
outfe
 << 
şass_v®ue
 << " ";

201 
outfe
 << 
¡d
::
’dl
;

202 
outfe
 << 
¡d
::
’dl
;

203 
size_t
 
i
 = 0; i < 
´ediùiÚs
.
	`size
(); ++i) {

204 
size_t
 
j
 = 0; j < 
´ediùiÚs
[
i
].
	`size
(); ++j) {

205 
outfe
 << 
´ediùiÚs
[
i
][
j
] << " ";

207 
outfe
 << 
¡d
::
’dl
;

210 *
v”bo£_out
 << "Saved…»diùiÚ tØf" << 
f’ame
 << "." << 
¡d
::
’dl
;

211 
	}
}

213 
	gFÜe¡Probab™y
::
	$§veToFeIÁ”Çl
(
¡d
::
of¡»am
& 
outfe
) {

216 
outfe
.
	`wr™e
((*è&
num_v¬ŸbËs
, (num_variables));

219 
T»eTy³
 
Œ“ty³
 = 
TREE_PROBABILITY
;

220 
outfe
.
	`wr™e
((*è&
Œ“ty³
, (treetype));

223 
	`§veVeùÜ1D
(
şass_v®ues
, 
outfe
);

224 
	}
}

226 
	gFÜe¡Probab™y
::
	$lßdFromFeIÁ”Çl
(
¡d
::
if¡»am
& 
šfe
) {

229 
size_t
 
num_v¬ŸbËs_§ved
;

230 
šfe
.
	`»ad
((*è&
num_v¬ŸbËs_§ved
, (num_variables_saved));

233 
T»eTy³
 
Œ“ty³
;

234 
šfe
.
	`»ad
((*è&
Œ“ty³
, (treetype));

235 ià(
Œ“ty³
 !ğ
TREE_PROBABILITY
) {

236 
throw
 
¡d
::
	`ruÁime_”rÜ
("Wrongreetype. Loaded file is‚ot‡…robabilityƒstimation forest.");

240 
	`»adVeùÜ1D
(
şass_v®ues
, 
šfe
);

242 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

245 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>> 
chd_nodeIDs
;

246 
	`»adVeùÜ2D
(
chd_nodeIDs
, 
šfe
);

247 
¡d
::
veùÜ
<
size_t
> 
¥l™_v¬IDs
;

248 
	`»adVeùÜ1D
(
¥l™_v¬IDs
, 
šfe
);

249 
¡d
::
veùÜ
<> 
¥l™_v®ues
;

250 
	`»adVeùÜ1D
(
¥l™_v®ues
, 
šfe
);

253 
¡d
::
veùÜ
<
size_t
> 
‹rmš®_nodes
;

254 
	`»adVeùÜ1D
(
‹rmš®_nodes
, 
šfe
);

255 
¡d
::
veùÜ
<¡d::veùÜ<>> 
‹rmš®_şass_couÁs_veùÜ
;

256 
	`»adVeùÜ2D
(
‹rmš®_şass_couÁs_veùÜ
, 
šfe
);

259 
¡d
::
veùÜ
<¡d::veùÜ<>> 
‹rmš®_şass_couÁs
;

260 
‹rmš®_şass_couÁs
.
	`»size
(
chd_nodeIDs
.
	`size
(), 
¡d
::
veùÜ
<>());

261 
size_t
 
i
 = 0; i < 
‹rmš®_nodes
.
	`size
(); ++i) {

262 
‹rmš®_şass_couÁs
[
‹rmš®_nodes
[
i
]] = 
‹rmš®_şass_couÁs_veùÜ
[i];

266 ià(
num_v¬ŸbËs_§ved
 > 
num_v¬ŸbËs
) {

267 auto& 
v¬ID
 : 
¥l™_v¬IDs
) {

268 ià(
v¬ID
 >ğ
d•’d’t_v¬ID
) {

269 --
v¬ID
;

275 
T»e
* 
Œ“
 = 
Ãw
 
	`T»eProbab™y
(
chd_nodeIDs
, 
¥l™_v¬IDs
, 
¥l™_v®ues
, &
şass_v®ues
, &
»¥Ú£_şassIDs
,

276 
‹rmš®_şass_couÁs
, &
is_Üd”ed_v¬ŸbË
);

277 
Œ“s
.
	`push_back
(
Œ“
);

279 
	}
}

	@Forest/ForestProbability.h

29 #iâdeà
FORESTPROBABILITY_H_


30 
	#FORESTPROBABILITY_H_


	)

32 
	~<m­
>

33 
	~<ut™y
>

34 
	~<veùÜ
>

36 
	~"glob®s.h
"

37 
	~"FÜe¡.h
"

38 
	~"T»eProbab™y.h
"

40 şas 
	cFÜe¡Probab™y
: 
public
 
FÜe¡
 {

41 
public
:

42 
FÜe¡Probab™y
();

43 
	mvœtu®
 ~
FÜe¡Probab™y
();

45 
lßdFÜe¡
(
size_t
 
d•’d’t_v¬ID
, size_ˆ
num_Œ“s
,

46 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<
size_t
>> >& 
fÜe¡_chd_nodeIDs
,

47 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
fÜe¡_¥l™_v¬IDs
, std::veùÜ<¡d::veùÜ<>>& 
fÜe¡_¥l™_v®ues
,

48 
¡d
::
veùÜ
<>& 
şass_v®ues
, std::veùÜ<¡d::veùÜ<¡d::veùÜ<>>>& 
fÜe¡_‹rmš®_şass_couÁs
, std::veùÜ<
boŞ
>& 
is_Üd”ed_v¬ŸbË
);

50 
	m¡d
::
veùÜ
<
¡d
::veùÜ<¡d::veùÜ<>>> 
	$g‘T”mš®CÏssCouÁs
() {

51 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<>>> 
»suÉ
;

52 
»suÉ
.
	`»£rve
(
num_Œ“s
);

53 
T»e
* 
Œ“
 : 
Œ“s
) {

54 
T»eProbab™y
* 
‹mp
 = (T»eProbab™y*è
Œ“
;

55 
»suÉ
.
	`push_back
(
‹mp
->
	`g‘T”mš®CÏssCouÁs
());

57  
»suÉ
;

60 cÚ¡ 
¡d
::
veùÜ
<>& 
	$g‘CÏssV®ues
() const {

61  
şass_v®ues
;

62 
	}
}

64 
	g´Ùeùed
:

65 
š™IÁ”Çl
(
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
);

66 
growIÁ”Çl
();

67 
´ediùIÁ”Çl
();

68 
compu‹P»diùiÚE¼ÜIÁ”Çl
();

69 
wr™eOuutIÁ”Çl
();

70 
wr™eCÚfusiÚFe
();

71 
wr™eP»diùiÚFe
();

72 
§veToFeIÁ”Çl
(
¡d
::
of¡»am
& 
outfe
);

73 
lßdFromFeIÁ”Çl
(
¡d
::
if¡»am
& 
šfe
);

76 
	g¡d
::
veùÜ
<> 
şass_v®ues
;

77 
	g¡d
::
veùÜ
<
ušt
> 
»¥Ú£_şassIDs
;

80 
	g¡d
::
m­
<
¡d
::
·œ
<, >, 
	gsize_t
> 
	gşassifiÿtiÚ_bË
;

82 
	g´iv©e
:

83 
DISALLOW_COPY_AND_ASSIGN
(
FÜe¡Probab™y
);

	@Forest/ForestRegression.cpp

29 
	~<®gÜ™hm
>

30 
	~<¡dexû±
>

31 
	~<¡ršg
>

33 
	~"ut™y.h
"

34 
	~"FÜe¡Reg»ssiÚ.h
"

35 
	~"T»eReg»ssiÚ.h
"

36 
	~"D©a.h
"

38 
	gFÜe¡Reg»ssiÚ
::
	$FÜe¡Reg»ssiÚ
() {

39 
	}
}

41 
FÜe¡Reg»ssiÚ
::~
	$FÜe¡Reg»ssiÚ
() {

42 
	}
}

44 
FÜe¡Reg»ssiÚ
::
lßdFÜe¡
(
size_t
 
d•’d’t_v¬ID
, size_ˆ
num_Œ“s
,

45 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<
size_t
>> >& 
fÜe¡_chd_nodeIDs
,

46 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
fÜe¡_¥l™_v¬IDs
, std::veùÜ<¡d::veùÜ<>>& 
fÜe¡_¥l™_v®ues
,

47 
¡d
::
veùÜ
<
boŞ
>& 
is_Üd”ed_v¬ŸbË
) {

49 
this
->
d•’d’t_v¬ID
 = dependent_varID;

50 
	gthis
->
	gnum_Œ“s
 = 
num_Œ“s
;

51 
	gthis
->
	gis_Üd”ed_v¬ŸbË
 = 
is_Üd”ed_v¬ŸbË
;

54 
	gŒ“s
.
»£rve
(
num_Œ“s
);

55 
size_t
 
	gi
 = 0; i < 
	gnum_Œ“s
; ++i) {

56 
T»e
* 
	gŒ“
 = 
Ãw
 
T»eReg»ssiÚ
(
fÜe¡_chd_nodeIDs
[
i
], 
fÜe¡_¥l™_v¬IDs
[i], 
fÜe¡_¥l™_v®ues
[i],

57 &
this
->
is_Üd”ed_v¬ŸbË
);

58 
	gŒ“s
.
push_back
(
Œ“
);

62 
equ®S¶™
(
th»ad_¿nges
, 0, 
num_Œ“s
 - 1, 
num_th»ads
);

65 
	gFÜe¡Reg»ssiÚ
::
	$š™IÁ”Çl
(
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
) {

68 ià(
mŒy
 == 0) {

69 
‹mp
 = 
	`sq¹
((è(
num_v¬ŸbËs
 - 1));

70 
mŒy
 = 
¡d
::
	`max
((è1, 
‹mp
);

74 ià(
mš_node_size
 == 0) {

75 
mš_node_size
 = 
DEFAULT_MIN_NODE_SIZE_REGRESSION
;

79 ià(!
memÜy_§všg_¥l™tšg
) {

80 
d©a
->
	`sÜt
();

82 
	}
}

84 
	gFÜe¡Reg»ssiÚ
::
	$growIÁ”Çl
() {

85 
Œ“s
.
	`»£rve
(
num_Œ“s
);

86 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

87 
Œ“s
.
	`push_back
(
Ãw
 
	`T»eReg»ssiÚ
());

89 
	}
}

91 
	gFÜe¡Reg»ssiÚ
::
	$´ediùIÁ”Çl
() {

93 
size_t
 
num_´ediùiÚ_§m¶es
 = 
d©a
->
	`g‘NumRows
();

94 
´ediùiÚs
.
	`»£rve
(
num_´ediùiÚ_§m¶es
);

97 
size_t
 
§m¶e_idx
 = 0; sam¶e_idx < 
num_´ediùiÚ_§m¶es
; ++sample_idx) {

99 ià(
´ediù_®l
) {

101 
¡d
::
veùÜ
<> 
§m¶e_´ediùiÚs
;

102 
§m¶e_´ediùiÚs
.
	`»£rve
(
num_Œ“s
);

103 
size_t
 
Œ“_idx
 = 0;»e_idx < 
num_Œ“s
; ++tree_idx) {

104 
v®ue
 = ((
T»eReg»ssiÚ
*è
Œ“s
[
Œ“_idx
])->
	`g‘P»diùiÚ
(
§m¶e_idx
);

105 
§m¶e_´ediùiÚs
.
	`push_back
(
v®ue
);

107 
´ediùiÚs
.
	`push_back
(
§m¶e_´ediùiÚs
);

110 
´ediùiÚ_sum
 = 0;

111 
size_t
 
Œ“_idx
 = 0;»e_idx < 
num_Œ“s
; ++tree_idx) {

112 
´ediùiÚ_sum
 +ğ((
T»eReg»ssiÚ
*è
Œ“s
[
Œ“_idx
])->
	`g‘P»diùiÚ
(
§m¶e_idx
);

114 
¡d
::
veùÜ
<> 
‹mp
;

115 
‹mp
.
	`push_back
(
´ediùiÚ_sum
 / 
num_Œ“s
);

116 
´ediùiÚs
.
	`push_back
(
‹mp
);

119 
	}
}

121 
	gFÜe¡Reg»ssiÚ
::
	$compu‹P»diùiÚE¼ÜIÁ”Çl
() {

124 
¡d
::
veùÜ
<
size_t
> 
§m¶es_oob_couÁ
;

125 
´ediùiÚs
.
	`»£rve
(
num_§m¶es
);

126 
§m¶es_oob_couÁ
.
	`»size
(
num_§m¶es
, 0);

127 
size_t
 
i
 = 0; i < 
num_§m¶es
; ++i) {

128 
¡d
::
veùÜ
<> 
‹mp
 { 0 };

129 
´ediùiÚs
.
	`push_back
(
‹mp
);

131 
size_t
 
Œ“_idx
 = 0;»e_idx < 
num_Œ“s
; ++tree_idx) {

132 
size_t
 
§m¶e_idx
 = 0; sam¶e_idx < 
Œ“s
[
Œ“_idx
]->
	`g‘NumSam¶esOob
(); ++sample_idx) {

133 
size_t
 
§m¶eID
 = 
Œ“s
[
Œ“_idx
]->
	`g‘OobSam¶eIDs
()[
§m¶e_idx
];

134 
v®ue
 = ((
T»eReg»ssiÚ
*è
Œ“s
[
Œ“_idx
])->
	`g‘P»diùiÚ
(
§m¶e_idx
);

136 
´ediùiÚs
[
§m¶eID
][0] +ğ
v®ue
;

137 ++
§m¶es_oob_couÁ
[
§m¶eID
];

143 
size_t
 
i
 = 0; i < 
´ediùiÚs
.
	`size
(); ++i) {

144 ià(
§m¶es_oob_couÁ
[
i
] > 0) {

146 
´ediùiÚs
[
i
][0] /ğ(è
§m¶es_oob_couÁ
[i];

147 
´ediùed_v®ue
 = 
´ediùiÚs
[
i
][0];

148 
»®_v®ue
 = 
d©a
->
	`g‘
(
i
, 
d•’d’t_v¬ID
);

149 
ov”®l_´ediùiÚ_”rÜ
 +ğ(
´ediùed_v®ue
 - 
»®_v®ue
) * (predicted_value -„eal_value);

153 
ov”®l_´ediùiÚ_”rÜ
 /ğ(è
´ediùiÚs
.
	`size
();

154 
	}
}

156 
	gFÜe¡Reg»ssiÚ
::
	$wr™eOuutIÁ”Çl
() {

157 *
v”bo£_out
 << "T»ty³: " << "Reg»ssiÚ" << 
¡d
::
’dl
;

158 
	}
}

160 
	gFÜe¡Reg»ssiÚ
::
	$wr™eCÚfusiÚFe
() {

163 
¡d
::
¡ršg
 
f’ame
 = 
ouut_´efix
 + ".confusion";

164 
¡d
::
of¡»am
 
outfe
;

165 
outfe
.
	`İ’
(
f’ame
, 
¡d
::
ios
::
out
);

166 ià(!
outfe
.
	`good
()) {

167 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù wr™tØcÚfusiÚ fe: " + 
f’ame
 + ".");

171 
outfe
 << "Ov”®ÈOOB…»diùiÚƒ¼Ü (MSE): " << 
ov”®l_´ediùiÚ_”rÜ
 << 
¡d
::
’dl
;

173 
outfe
.
	`şo£
();

174 *
v”bo£_out
 << "Saved…»diùiÚƒ¼ÜØf" << 
f’ame
 << "." << 
¡d
::
’dl
;

175 
	}
}

177 
	gFÜe¡Reg»ssiÚ
::
	$wr™eP»diùiÚFe
() {

180 
¡d
::
¡ršg
 
f’ame
 = 
ouut_´efix
 + ".prediction";

181 
¡d
::
of¡»am
 
outfe
;

182 
outfe
.
	`İ’
(
f’ame
, 
¡d
::
ios
::
out
);

183 ià(!
outfe
.
	`good
()) {

184 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù wr™tØ´ediùiÚ fe: " + 
f’ame
 + ".");

188 
outfe
 << "P»diùiÚs: " << 
¡d
::
’dl
;

189 
size_t
 
i
 = 0; i < 
´ediùiÚs
.
	`size
(); ++i) {

190 
size_t
 
j
 = 0; j < 
´ediùiÚs
[
i
].
	`size
(); ++j) {

191 
outfe
 << 
´ediùiÚs
[
i
][
j
] << " ";

193 
outfe
 << 
¡d
::
’dl
;

196 *
v”bo£_out
 << "Saved…»diùiÚ tØf" << 
f’ame
 << "." << 
¡d
::
’dl
;

197 
	}
}

199 
	gFÜe¡Reg»ssiÚ
::
	$§veToFeIÁ”Çl
(
¡d
::
of¡»am
& 
outfe
) {

202 
outfe
.
	`wr™e
((*è&
num_v¬ŸbËs
, (num_variables));

205 
T»eTy³
 
Œ“ty³
 = 
TREE_REGRESSION
;

206 
outfe
.
	`wr™e
((*è&
Œ“ty³
, (treetype));

207 
	}
}

209 
	gFÜe¡Reg»ssiÚ
::
	$lßdFromFeIÁ”Çl
(
¡d
::
if¡»am
& 
šfe
) {

212 
size_t
 
num_v¬ŸbËs_§ved
;

213 
šfe
.
	`»ad
((*è&
num_v¬ŸbËs_§ved
, (num_variables_saved));

216 
T»eTy³
 
Œ“ty³
;

217 
šfe
.
	`»ad
((*è&
Œ“ty³
, (treetype));

218 ià(
Œ“ty³
 !ğ
TREE_REGRESSION
) {

219 
throw
 
¡d
::
	`ruÁime_”rÜ
("Wrongreetype. Loaded file is‚ot‡„egression forest.");

222 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

225 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>> 
chd_nodeIDs
;

226 
	`»adVeùÜ2D
(
chd_nodeIDs
, 
šfe
);

227 
¡d
::
veùÜ
<
size_t
> 
¥l™_v¬IDs
;

228 
	`»adVeùÜ1D
(
¥l™_v¬IDs
, 
šfe
);

229 
¡d
::
veùÜ
<> 
¥l™_v®ues
;

230 
	`»adVeùÜ1D
(
¥l™_v®ues
, 
šfe
);

233 ià(
num_v¬ŸbËs_§ved
 > 
num_v¬ŸbËs
) {

234 auto& 
v¬ID
 : 
¥l™_v¬IDs
) {

235 ià(
v¬ID
 >ğ
d•’d’t_v¬ID
) {

236 --
v¬ID
;

242 
T»e
* 
Œ“
 = 
Ãw
 
	`T»eReg»ssiÚ
(
chd_nodeIDs
, 
¥l™_v¬IDs
, 
¥l™_v®ues
, &
is_Üd”ed_v¬ŸbË
);

243 
Œ“s
.
	`push_back
(
Œ“
);

245 
	}
}

	@Forest/ForestRegression.h

29 #iâdeà
FORESTREGRESSION_H_


30 
	#FORESTREGRESSION_H_


	)

32 
	~<io¡»am
>

33 
	~<veùÜ
>

35 
	~"glob®s.h
"

36 
	~"FÜe¡.h
"

38 şas 
	cFÜe¡Reg»ssiÚ
: 
public
 
FÜe¡
 {

39 
public
:

40 
FÜe¡Reg»ssiÚ
();

41 
	mvœtu®
 ~
FÜe¡Reg»ssiÚ
();

43 
lßdFÜe¡
(
size_t
 
d•’d’t_v¬ID
, size_ˆ
num_Œ“s
,

44 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<
size_t
>> >& 
fÜe¡_chd_nodeIDs
,

45 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
fÜe¡_¥l™_v¬IDs
, std::veùÜ<¡d::veùÜ<>>& 
fÜe¡_¥l™_v®ues
,

46 
¡d
::
veùÜ
<
boŞ
>& 
is_Üd”ed_v¬ŸbË
);

48 
	m´iv©e
:

49 
š™IÁ”Çl
(
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
);

50 
growIÁ”Çl
();

51 
´ediùIÁ”Çl
();

52 
compu‹P»diùiÚE¼ÜIÁ”Çl
();

53 
wr™eOuutIÁ”Çl
();

54 
wr™eCÚfusiÚFe
();

55 
wr™eP»diùiÚFe
();

56 
§veToFeIÁ”Çl
(
¡d
::
of¡»am
& 
outfe
);

57 
lßdFromFeIÁ”Çl
(
¡d
::
if¡»am
& 
šfe
);

59 
DISALLOW_COPY_AND_ASSIGN
(
FÜe¡Reg»ssiÚ
);

	@Forest/ForestSurvival.cpp

29 
	~<£t
>

30 
	~<®gÜ™hm
>

31 
	~<cm©h
>

32 
	~<¡dexû±
>

33 
	~<¡ršg
>

35 
	~"ut™y.h
"

36 
	~"FÜe¡Surviv®.h
"

37 
	~"D©a.h
"

39 
	gFÜe¡Surviv®
::
	$FÜe¡Surviv®
() :

40 
	`¡©us_v¬ID
(0), 
	$»¥Ú£_tim•oštIDs
(0) {

41 
	}
}

43 
	gFÜe¡Surviv®
::~
	$FÜe¡Surviv®
() {

44 
	}
}

46 
FÜe¡Surviv®
::
lßdFÜe¡
(
size_t
 
d•’d’t_v¬ID
, size_ˆ
num_Œ“s
,

47 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<
size_t
>> >& 
fÜe¡_chd_nodeIDs
,

48 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
fÜe¡_¥l™_v¬IDs
, std::veùÜ<¡d::veùÜ<>>& 
fÜe¡_¥l™_v®ues
,

49 
size_t
 
¡©us_v¬ID
, 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<>> >& 
fÜe¡_chf
,

50 
¡d
::
veùÜ
<>& 
unique_tim•ošts
, std::veùÜ<
boŞ
>& 
is_Üd”ed_v¬ŸbË
) {

52 
this
->
d•’d’t_v¬ID
 = dependent_varID;

53 
	gthis
->
	g¡©us_v¬ID
 = 
¡©us_v¬ID
;

54 
	gthis
->
	gnum_Œ“s
 = 
num_Œ“s
;

55 
	gthis
->
	gis_Üd”ed_v¬ŸbË
 = 
is_Üd”ed_v¬ŸbË
;

56 
	gthis
->
	gunique_tim•ošts
 = 
unique_tim•ošts
;

59 
	gŒ“s
.
»£rve
(
num_Œ“s
);

60 
size_t
 
	gi
 = 0; i < 
	gnum_Œ“s
; ++i) {

61 
T»e
* 
	gŒ“
 = 
Ãw
 
T»eSurviv®
(
fÜe¡_chd_nodeIDs
[
i
], 
fÜe¡_¥l™_v¬IDs
[i], 
fÜe¡_¥l™_v®ues
[i],

62 
fÜe¡_chf
[
i
], &
this
->
unique_tim•ošts
, &
»¥Ú£_tim•oštIDs
, &this->
is_Üd”ed_v¬ŸbË
);

63 
	gŒ“s
.
push_back
(
Œ“
);

67 
equ®S¶™
(
th»ad_¿nges
, 0, 
num_Œ“s
 - 1, 
num_th»ads
);

70 
	gFÜe¡Surviv®
::
	$š™IÁ”Çl
(
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
) {

73 ià(!
´ediùiÚ_mode
 && !
¡©us_v¬ŸbË_Çme
.
	`em±y
()) {

74 
¡©us_v¬ID
 = 
d©a
->
	`g‘V¬ŸbËID
(
¡©us_v¬ŸbË_Çme
);

77 
no_¥l™_v¬ŸbËs
.
	`push_back
(
¡©us_v¬ID
);

80 ià(
mŒy
 == 0) {

81 
‹mp
 = 
	`û
(
	`sq¹
((è(
num_v¬ŸbËs
 - 2)));

82 
mŒy
 = 
¡d
::
	`max
((è1, 
‹mp
);

86 ià(
mš_node_size
 == 0) {

87 
mš_node_size
 = 
DEFAULT_MIN_NODE_SIZE_SURVIVAL
;

91 
¡d
::
£t
<> 
unique_tim•ošt_£t
;

92 
size_t
 
i
 = 0; i < 
num_§m¶es
; ++i) {

93 
unique_tim•ošt_£t
.
	`š£¹
(
d©a
->
	`g‘
(
i
, 
d•’d’t_v¬ID
));

95 
unique_tim•ošts
.
	`»£rve
(
unique_tim•ošt_£t
.
	`size
());

96 auto& 
t
 : 
unique_tim•ošt_£t
) {

97 
unique_tim•ošts
.
	`push_back
(
t
);

101 ià(!
´ediùiÚ_mode
) {

102 
size_t
 
i
 = 0; i < 
num_§m¶es
; ++i) {

103 
v®ue
 = 
d©a
->
	`g‘
(
i
, 
d•’d’t_v¬ID
);

106 
ušt
 
tim•oštID
 = 
	`fšd
(
unique_tim•ošts
.
	`begš
(), unique_tim•ošts.
	`’d
(), 
v®ue
) - unique_timepoints.begin();

107 
»¥Ú£_tim•oštIDs
.
	`push_back
(
tim•oštID
);

110 
	}
}

112 
	gFÜe¡Surviv®
::
	$growIÁ”Çl
() {

113 
Œ“s
.
	`»£rve
(
num_Œ“s
);

114 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

115 
Œ“s
.
	`push_back
(
Ãw
 
	`T»eSurviv®
(&
unique_tim•ošts
, 
¡©us_v¬ID
, &
»¥Ú£_tim•oštIDs
));

117 
	}
}

119 
	gFÜe¡Surviv®
::
	$´ediùIÁ”Çl
() {

121 
size_t
 
num_´ediùiÚ_§m¶es
 = 
d©a
->
	`g‘NumRows
();

122 
size_t
 
num_tim•ošts
 = 
unique_tim•ošts
.
	`size
();

124 
´ediùiÚs
.
	`»£rve
(
num_´ediùiÚ_§m¶es
);

128 
size_t
 
i
 = 0; i < 
num_´ediùiÚ_§m¶es
; ++i) {

129 
¡d
::
veùÜ
<> 
§m¶e_´ediùiÚ
;

130 
§m¶e_´ediùiÚ
.
	`»£rve
(
num_tim•ošts
);

131 
size_t
 
j
 = 0; j < 
num_tim•ošts
; ++j) {

132 
§m¶e_time_´ediùiÚ
 = 0;

133 
size_t
 
k
 = 0; k < 
num_Œ“s
; ++k) {

134 
§m¶e_time_´ediùiÚ
 +ğ((
T»eSurviv®
*è
Œ“s
[
k
])->
	`g‘P»diùiÚ
(
i
)[
j
];

136 
§m¶e_´ediùiÚ
.
	`push_back
(
§m¶e_time_´ediùiÚ
 / 
num_Œ“s
);

138 
´ediùiÚs
.
	`push_back
(
§m¶e_´ediùiÚ
);

141 
	}
}

143 
	gFÜe¡Surviv®
::
	$compu‹P»diùiÚE¼ÜIÁ”Çl
() {

145 
size_t
 
num_tim•ošts
 = 
unique_tim•ošts
.
	`size
();

148 
¡d
::
veùÜ
<
size_t
> 
§m¶es_oob_couÁ
;

149 
§m¶es_oob_couÁ
.
	`»size
(
num_§m¶es
, 0);

150 
´ediùiÚs
.
	`»£rve
(
num_§m¶es
);

151 
size_t
 
i
 = 0; i < 
num_§m¶es
; ++i) {

152 
¡d
::
veùÜ
<> 
‹mp
;

153 
‹mp
.
	`»size
(
num_tim•ošts
, 0);

154 
´ediùiÚs
.
	`push_back
(
‹mp
);

156 
size_t
 
Œ“_idx
 = 0;»e_idx < 
num_Œ“s
; ++tree_idx) {

157 
size_t
 
§m¶e_idx
 = 0; sam¶e_idx < 
Œ“s
[
Œ“_idx
]->
	`g‘NumSam¶esOob
(); ++sample_idx) {

158 
size_t
 
§m¶eID
 = 
Œ“s
[
Œ“_idx
]->
	`g‘OobSam¶eIDs
()[
§m¶e_idx
];

159 
¡d
::
veùÜ
<> 
Œ“_§m¶e_chf
 = ((
T»eSurviv®
*è
Œ“s
[
Œ“_idx
])->
	`g‘P»diùiÚ
(
§m¶e_idx
);

161 
size_t
 
time_idx
 = 0;ime_idx < 
Œ“_§m¶e_chf
.
	`size
(); ++time_idx) {

162 
´ediùiÚs
[
§m¶eID
][
time_idx
] +ğ
Œ“_§m¶e_chf
[time_idx];

164 ++
§m¶es_oob_couÁ
[
§m¶eID
];

169 
¡d
::
veùÜ
<> 
sum_chf
;

170 
sum_chf
.
	`»£rve
(
´ediùiÚs
.
	`size
());

171 
size_t
 
i
 = 0; i < 
´ediùiÚs
.
	`size
(); ++i) {

172 ià(
§m¶es_oob_couÁ
[
i
] > 0) {

173 
sum
 = 0;

174 
size_t
 
j
 = 0; j < 
´ediùiÚs
[
i
].
	`size
(); ++j) {

175 
´ediùiÚs
[
i
][
j
] /ğ
§m¶es_oob_couÁ
[i];

176 
sum
 +ğ
´ediùiÚs
[
i
][
j
];

178 
sum_chf
.
	`push_back
(
sum
);

183 
¡d
::
veùÜ
<
size_t
> 
‹mp
;

184 
ov”®l_´ediùiÚ_”rÜ
 = 1 - 
	`compu‹CÚcÜdªûIndex
(
d©a
, 
sum_chf
, 
d•’d’t_v¬ID
, 
¡©us_v¬ID
, 
‹mp
);

185 
	}
}

187 
	gFÜe¡Surviv®
::
	$wr™eOuutIÁ”Çl
() {

188 *
v”bo£_out
 << "T»ty³: " << "Surviv®" << 
¡d
::
’dl
;

189 *
v”bo£_out
 << "Stu v¬ŸbË‚ame: " << 
d©a
->
	`g‘V¬ŸbËNames
()[
¡©us_v¬ID
] << 
¡d
::
’dl
;

190 *
v”bo£_out
 << "Stu v¬ŸbË ID: " << 
¡©us_v¬ID
 << 
¡d
::
’dl
;

191 
	}
}

193 
	gFÜe¡Surviv®
::
	$wr™eCÚfusiÚFe
() {

196 
¡d
::
¡ršg
 
f’ame
 = 
ouut_´efix
 + ".confusion";

197 
¡d
::
of¡»am
 
outfe
;

198 
outfe
.
	`İ’
(
f’ame
, 
¡d
::
ios
::
out
);

199 ià(!
outfe
.
	`good
()) {

200 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù wr™tØcÚfusiÚ fe: " + 
f’ame
 + ".");

204 
outfe
 << "Ov”®ÈOOB…»diùiÚƒ¼Ü (1 - C): " << 
ov”®l_´ediùiÚ_”rÜ
 << 
¡d
::
’dl
;

206 
outfe
.
	`şo£
();

207 *
v”bo£_out
 << "Saved…»diùiÚƒ¼ÜØf" << 
f’ame
 << "." << 
¡d
::
’dl
;

209 
	}
}

211 
	gFÜe¡Surviv®
::
	$wr™eP»diùiÚFe
() {

214 
¡d
::
¡ršg
 
f’ame
 = 
ouut_´efix
 + ".prediction";

215 
¡d
::
of¡»am
 
outfe
;

216 
outfe
.
	`İ’
(
f’ame
, 
¡d
::
ios
::
out
);

217 ià(!
outfe
.
	`good
()) {

218 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù wr™tØ´ediùiÚ fe: " + 
f’ame
 + ".");

222 
outfe
 << "Uniqutim•ošts: " << 
¡d
::
’dl
;

223 auto& 
tim•ošt
 : 
unique_tim•ošts
) {

224 
outfe
 << 
tim•ošt
 << " ";

226 
outfe
 << 
¡d
::
’dl
 << std::endl;

227 
outfe
 << "CumuÏtivhaz¬d funùiÚ, oÃ„ow…” sam¶e: " << 
¡d
::
’dl
;

228 
size_t
 
i
 = 0; i < 
´ediùiÚs
.
	`size
(); ++i) {

229 
size_t
 
j
 = 0; j < 
´ediùiÚs
[
i
].
	`size
(); ++j) {

230 
outfe
 << 
´ediùiÚs
[
i
][
j
] << " ";

232 
outfe
 << 
¡d
::
’dl
;

235 *
v”bo£_out
 << "Saved…»diùiÚ tØf" << 
f’ame
 << "." << 
¡d
::
’dl
;

236 
	}
}

238 
	gFÜe¡Surviv®
::
	$§veToFeIÁ”Çl
(
¡d
::
of¡»am
& 
outfe
) {

241 
outfe
.
	`wr™e
((*è&
num_v¬ŸbËs
, (num_variables));

244 
T»eTy³
 
Œ“ty³
 = 
TREE_SURVIVAL
;

245 
outfe
.
	`wr™e
((*è&
Œ“ty³
, (treetype));

248 
outfe
.
	`wr™e
((*è&
¡©us_v¬ID
, (status_varID));

251 
	`§veVeùÜ1D
(
unique_tim•ošts
, 
outfe
);

252 
	}
}

254 
	gFÜe¡Surviv®
::
	$lßdFromFeIÁ”Çl
(
¡d
::
if¡»am
& 
šfe
) {

257 
size_t
 
num_v¬ŸbËs_§ved
;

258 
šfe
.
	`»ad
((*è&
num_v¬ŸbËs_§ved
, (num_variables_saved));

261 
T»eTy³
 
Œ“ty³
;

262 
šfe
.
	`»ad
((*è&
Œ“ty³
, (treetype));

263 ià(
Œ“ty³
 !ğ
TREE_SURVIVAL
) {

264 
throw
 
¡d
::
	`ruÁime_”rÜ
("Wrongreetype. Loaded file is‚ot‡ survival forest.");

268 
šfe
.
	`»ad
((*è&
¡©us_v¬ID
, (status_varID));

271 
unique_tim•ošts
.
	`ş—r
();

272 
	`»adVeùÜ1D
(
unique_tim•ošts
, 
šfe
);

274 
size_t
 
i
 = 0; i < 
num_Œ“s
; ++i) {

277 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>> 
chd_nodeIDs
;

278 
	`»adVeùÜ2D
(
chd_nodeIDs
, 
šfe
);

279 
¡d
::
veùÜ
<
size_t
> 
¥l™_v¬IDs
;

280 
	`»adVeùÜ1D
(
¥l™_v¬IDs
, 
šfe
);

281 
¡d
::
veùÜ
<> 
¥l™_v®ues
;

282 
	`»adVeùÜ1D
(
¥l™_v®ues
, 
šfe
);

285 
¡d
::
veùÜ
<
size_t
> 
‹rmš®_nodes
;

286 
	`»adVeùÜ1D
(
‹rmš®_nodes
, 
šfe
);

287 
¡d
::
veùÜ
<¡d::veùÜ<>> 
chf_veùÜ
;

288 
	`»adVeùÜ2D
(
chf_veùÜ
, 
šfe
);

291 
¡d
::
veùÜ
<¡d::veùÜ<>> 
chf
;

292 
chf
.
	`»size
(
chd_nodeIDs
.
	`size
(), 
¡d
::
veùÜ
<>());

296 
size_t
 
i
 = 0; i < 
‹rmš®_nodes
.
	`size
(); ++i) {

297 
chf
[
‹rmš®_nodes
[
i
]] = 
chf_veùÜ
[i];

301 ià(
num_v¬ŸbËs_§ved
 > 
num_v¬ŸbËs
) {

302 auto& 
v¬ID
 : 
¥l™_v¬IDs
) {

303 ià(
v¬ID
 >ğ
d•’d’t_v¬ID
) {

304 --
v¬ID
;

308 ià(
num_v¬ŸbËs_§ved
 > 
num_v¬ŸbËs
 + 1) {

309 auto& 
v¬ID
 : 
¥l™_v¬IDs
) {

310 ià(
v¬ID
 >ğ
¡©us_v¬ID
) {

311 --
v¬ID
;

317 
T»e
* 
Œ“
 = 
Ãw
 
	`T»eSurviv®
(
chd_nodeIDs
, 
¥l™_v¬IDs
, 
¥l™_v®ues
, 
chf
, &
unique_tim•ošts
,

318 &
»¥Ú£_tim•oštIDs
, &
is_Üd”ed_v¬ŸbË
);

319 
Œ“s
.
	`push_back
(
Œ“
);

321 
	}
}

	@Forest/ForestSurvival.h

29 #iâdeà
FORESTSURVIVAL_H_


30 
	#FORESTSURVIVAL_H_


	)

32 
	~<io¡»am
>

33 
	~<veùÜ
>

35 
	~"glob®s.h
"

36 
	~"FÜe¡.h
"

37 
	~"T»eSurviv®.h
"

39 şas 
	cFÜe¡Surviv®
: 
public
 
FÜe¡
 {

40 
public
:

41 
FÜe¡Surviv®
();

42 
	mvœtu®
 ~
FÜe¡Surviv®
();

44 
lßdFÜe¡
(
size_t
 
d•’d’t_v¬ID
, size_ˆ
num_Œ“s
,

45 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<
size_t
>> >& 
fÜe¡_chd_nodeIDs
,

46 
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
fÜe¡_¥l™_v¬IDs
, std::veùÜ<¡d::veùÜ<>>& 
fÜe¡_¥l™_v®ues
,

47 
size_t
 
¡©us_v¬ID
, 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<>> >& 
fÜe¡_chf
,

48 
¡d
::
veùÜ
<>& 
unique_tim•ošts
, std::veùÜ<
boŞ
>& 
is_Üd”ed_v¬ŸbË
);

50 
	m¡d
::
veùÜ
<
¡d
::veùÜ<¡d::veùÜ<>>>
	$g‘Chf
() {

51 
¡d
::
veùÜ
<¡d::veùÜ<¡d::veùÜ<>>> 
»suÉ
;

52 
»suÉ
.
	`»£rve
(
num_Œ“s
);

53 
T»e
* 
Œ“
 : 
Œ“s
) {

54 
T»eSurviv®
* 
‹mp
 = (T»eSurviv®*è
Œ“
;

55 
»suÉ
.
	`push_back
(
‹mp
->
	`g‘Chf
());

57  
»suÉ
;

59 
size_t
 
	$g‘StusV¬Id
() const {

60  
¡©us_v¬ID
;

61 
	}
}

62 cÚ¡ 
	g¡d
::
veùÜ
<>& 
	$g‘UniqueTim•ošts
() const {

63  
unique_tim•ošts
;

64 
	}
}

66 
	g´iv©e
:

67 
š™IÁ”Çl
(
¡d
::
¡ršg
 
¡©us_v¬ŸbË_Çme
);

68 
growIÁ”Çl
();

69 
´ediùIÁ”Çl
();

70 
compu‹P»diùiÚE¼ÜIÁ”Çl
();

71 
wr™eOuutIÁ”Çl
();

72 
wr™eCÚfusiÚFe
();

73 
wr™eP»diùiÚFe
();

74 
§veToFeIÁ”Çl
(
¡d
::
of¡»am
& 
outfe
);

75 
lßdFromFeIÁ”Çl
(
¡d
::
if¡»am
& 
šfe
);

77 
size_t
 
	g¡©us_v¬ID
;

78 
	g¡d
::
veùÜ
<> 
unique_tim•ošts
;

79 
	g¡d
::
veùÜ
<
size_t
> 
»¥Ú£_tim•oštIDs
;

81 
DISALLOW_COPY_AND_ASSIGN
(
FÜe¡Surviv®
);

	@Tree/Tree.cpp

29 
	~<™”©Ü
>

31 
	~"T»e.h
"

32 
	~"ut™y.h
"

34 
	gT»e
::
	$T»e
() :

35 
	`d•’d’t_v¬ID
(0), 
	`mŒy
(0), 
	`num_§m¶es
(0), 
	`num_§m¶es_oob
(0), 
	`is_Üd”ed_v¬ŸbË
(0), 
	`no_¥l™_v¬ŸbËs
(0), 
	`mš_node_size
(

36 0), 
	`d‘”mši¡ic_v¬IDs
(0), 
	`¥l™_£Ëù_v¬IDs
(0), 
	`¥l™_£Ëù_weights
(0), 
	`ÿ£_weights
(0), 
	`oob_§m¶eIDs
(0), 
	`hŞdout
(

37 
çl£
), 
	`k“p_šbag
(çl£), 
	`d©a
(0), 
	`v¬ŸbË_impÜnû
(0), 
	`impÜnû_mode
(
DEFAULT_IMPORTANCE_MODE
), 
	`§m¶e_w™h_»¶aûm’t
(

38 
Œue
), 
	`§m¶e_äaùiÚ
(1), 
	`memÜy_§všg_¥l™tšg
(
çl£
), 
	`¥l™ruË
(
DEFAULT_SPLITRULE
), 
	`®pha
(
DEFAULT_ALPHA
), 
	$mš´İ
(

39 
DEFAULT_MINPROP
) {

40 
	}
}

42 
	gT»e
::
T»e
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
chd_nodeIDs
, std::veùÜ<size_t>& 
¥l™_v¬IDs
,

43 
¡d
::
veùÜ
<>& 
¥l™_v®ues
, std::veùÜ<
boŞ
>* 
is_Üd”ed_v¬ŸbË
) :

44 
d•’d’t_v¬ID
(0), 
mŒy
(0), 
num_§m¶es
(0), 
num_§m¶es_oob
(0), 
is_Üd”ed_v¬ŸbË
(is_Üd”ed_v¬ŸbË), 
no_¥l™_v¬ŸbËs
(

45 0), 
mš_node_size
(0), 
d‘”mši¡ic_v¬IDs
(0), 
¥l™_£Ëù_v¬IDs
(0), 
¥l™_£Ëù_weights
(0), 
ÿ£_weights
(0), 
¥l™_v¬IDs
(

46 
¥l™_v¬IDs
), 
¥l™_v®ues
(¥l™_v®ues), 
chd_nodeIDs
(chd_nodeIDs), 
oob_§m¶eIDs
(0), 
hŞdout
(
çl£
), 
k“p_šbag
(

47 
çl£
), 
d©a
(0), 
v¬ŸbË_impÜnû
(0), 
impÜnû_mode
(
DEFAULT_IMPORTANCE_MODE
), 
§m¶e_w™h_»¶aûm’t
(

48 
Œue
), 
§m¶e_äaùiÚ
(1), 
memÜy_§všg_¥l™tšg
(
çl£
), 
¥l™ruË
(
DEFAULT_SPLITRULE
), 
®pha
(
DEFAULT_ALPHA
), 
	$mš´İ
(

49 
DEFAULT_MINPROP
) {

50 
	}
}

52 
	gT»e
::~
	$T»e
() {

53 
	}
}

55 
T»e
::
š™
(
D©a
* 
d©a
, 
ušt
 
mŒy
, 
size_t
 
d•’d’t_v¬ID
, size_ˆ
num_§m¶es
, ušˆ
£ed
,

56 
¡d
::
veùÜ
<
size_t
>* 
d‘”mši¡ic_v¬IDs
, std::veùÜ<size_t>* 
¥l™_£Ëù_v¬IDs
,

57 
¡d
::
veùÜ
<>* 
¥l™_£Ëù_weights
, 
ImpÜnûMode
 
impÜnû_mode
, 
ušt
 
mš_node_size
,

58 
¡d
::
veùÜ
<
size_t
>* 
no_¥l™_v¬ŸbËs
, 
boŞ
 
§m¶e_w™h_»¶aûm’t
, std::veùÜ<boŞ>* 
is_unÜd”ed
,

59 
boŞ
 
memÜy_§všg_¥l™tšg
, 
S¶™RuË
 
¥l™ruË
, 
¡d
::
veùÜ
<>* 
ÿ£_weights
, boŞ 
k“p_šbag
,

60 
§m¶e_äaùiÚ
, 
®pha
, 
mš´İ
, 
boŞ
 
hŞdout
) {

62 
	gthis
->
	gd©a
 = 
d©a
;

63 
	gthis
->
	gmŒy
 = 
mŒy
;

64 
	gthis
->
	gd•’d’t_v¬ID
 = 
d•’d’t_v¬ID
;

65 
	gthis
->
	gnum_§m¶es
 = 
num_§m¶es
;

66 
	gthis
->
	gmemÜy_§všg_¥l™tšg
 = 
memÜy_§všg_¥l™tšg
;

69 
	gchd_nodeIDs
.
push_back
(
¡d
::
veùÜ
<
size_t
>());

70 
	gchd_nodeIDs
.
push_back
(
¡d
::
veùÜ
<
size_t
>());

71 
ü—‹Em±yNode
();

74 
	g¿ndom_numb”_g’”©Ü
.
£ed
(seed);

76 
	gthis
->
	gd‘”mši¡ic_v¬IDs
 = 
d‘”mši¡ic_v¬IDs
;

77 
	gthis
->
	g¥l™_£Ëù_v¬IDs
 = 
¥l™_£Ëù_v¬IDs
;

78 
	gthis
->
	g¥l™_£Ëù_weights
 = 
¥l™_£Ëù_weights
;

79 
	gthis
->
	gimpÜnû_mode
 = 
impÜnû_mode
;

80 
	gthis
->
	gmš_node_size
 = 
mš_node_size
;

81 
	gthis
->
	gno_¥l™_v¬ŸbËs
 = 
no_¥l™_v¬ŸbËs
;

82 
	gthis
->
	gis_Üd”ed_v¬ŸbË
 = 
is_unÜd”ed
;

83 
	gthis
->
	g§m¶e_w™h_»¶aûm’t
 = 
§m¶e_w™h_»¶aûm’t
;

84 
	gthis
->
	g¥l™ruË
 = 
¥l™ruË
;

85 
	gthis
->
	gÿ£_weights
 = 
ÿ£_weights
;

86 
	gthis
->
	gk“p_šbag
 = 
k“p_šbag
;

87 
	gthis
->
	g§m¶e_äaùiÚ
 = 
§m¶e_äaùiÚ
;

88 
	gthis
->
	ghŞdout
 = 
hŞdout
;

89 
	gthis
->
	g®pha
 = 
®pha
;

90 
	gthis
->
	gmš´İ
 = 
mš´İ
;

92 
š™IÁ”Çl
();

95 
	gT»e
::
grow
(
¡d
::
veùÜ
<>* 
v¬ŸbË_impÜnû
) {

97 
this
->
v¬ŸbË_impÜnû
 = variable_importance;

100 ià(
	gÿ£_weights
->
em±y
()) {

101 ià(
	g§m¶e_w™h_»¶aûm’t
) {

102 
boÙ¡¿p
();

104 
boÙ¡¿pW™houtR•Ïûm’t
();

107 ià(
	g§m¶e_w™h_»¶aûm’t
) {

108 
boÙ¡¿pWeigh‹d
();

110 
boÙ¡¿pW™houtR•Ïûm’tWeigh‹d
();

115 
size_t
 
	gnum_İ’_nodes
 = 1;

116 
size_t
 
	gi
 = 0;

117 
	gnum_İ’_nodes
 > 0) {

118 
boŞ
 
	gis_‹rmš®_node
 = 
¥l™Node
(
i
);

119 ià(
	gis_‹rmš®_node
) {

120 --
	gnum_İ’_nodes
;

122 ++
	gnum_İ’_nodes
;

124 ++
	gi
;

128 
	g§m¶eIDs
.
ş—r
();

129 
ş—nUpIÁ”Çl
();

132 
	gT»e
::
	$´ediù
(cÚ¡ 
D©a
* 
´ediùiÚ_d©a
, 
boŞ
 
oob_´ediùiÚ
) {

134 
size_t
 
num_§m¶es_´ediù
;

135 ià(
oob_´ediùiÚ
) {

136 
num_§m¶es_´ediù
 = 
num_§m¶es_oob
;

138 
num_§m¶es_´ediù
 = 
´ediùiÚ_d©a
->
	`g‘NumRows
();

141 
´ediùiÚ_‹rmš®_nodeIDs
.
	`»size
(
num_§m¶es_´ediù
, 0);

144 
size_t
 
i
 = 0; i < 
num_§m¶es_´ediù
; ++i) {

145 
size_t
 
§m¶e_idx
;

146 ià(
oob_´ediùiÚ
) {

147 
§m¶e_idx
 = 
oob_§m¶eIDs
[
i
];

149 
§m¶e_idx
 = 
i
;

151 
size_t
 
nodeID
 = 0;

155 ià(
chd_nodeIDs
[0][
nodeID
] == 0 && child_nodeIDs[1][nodeID] == 0) {

160 
size_t
 
¥l™_v¬ID
 = 
¥l™_v¬IDs
[
nodeID
];

161 
v®ue
 = 
´ediùiÚ_d©a
->
	`g‘
(
§m¶e_idx
, 
¥l™_v¬ID
);

162 ià((*
is_Üd”ed_v¬ŸbË
)[
¥l™_v¬ID
]) {

163 ià(
v®ue
 <ğ
¥l™_v®ues
[
nodeID
]) {

165 
nodeID
 = 
chd_nodeIDs
[0][nodeID];

168 
nodeID
 = 
chd_nodeIDs
[1][nodeID];

171 
size_t
 
çùÜID
 = 
	`æoÜ
(
v®ue
) - 1;

172 
size_t
 
¥l™ID
 = 
	`æoÜ
(
¥l™_v®ues
[
nodeID
]);

175 ià(!(
¥l™ID
 & (1 << 
çùÜID
))) {

177 
nodeID
 = 
chd_nodeIDs
[0][nodeID];

180 
nodeID
 = 
chd_nodeIDs
[1][nodeID];

185 
´ediùiÚ_‹rmš®_nodeIDs
[
i
] = 
nodeID
;

187 
	}
}

189 
	gT»e
::
compu‹P”mutiÚImpÜnû
(
¡d
::
veùÜ
<>* 
fÜe¡_impÜnû
, std::veùÜ<>* 
fÜe¡_v¬Ÿnû
) {

191 
size_t
 
num_šd•’d’t_v¬ŸbËs
 = 
d©a
->
g‘NumCŞs
(è- 
no_¥l™_v¬ŸbËs
->
size
();

194 
	gaccu¿cy_nÜm®
 = 
compu‹P»diùiÚAccu¿cyIÁ”Çl
();

196 
	g´ediùiÚ_‹rmš®_nodeIDs
.
ş—r
();

197 
	g´ediùiÚ_‹rmš®_nodeIDs
.
»size
(
num_§m¶es_oob
, 0);

200 
	g¡d
::
veùÜ
<
size_t
> 
³rmutiÚs
(
oob_§m¶eIDs
);

203 
size_t
 
	gi
 = 0; i < 
	gnum_šd•’d’t_v¬ŸbËs
; ++i) {

206 
size_t
 
	gv¬ID
 = 
i
;

207 auto& 
	gsk
 : *
no_¥l™_v¬ŸbËs
) {

208 ià(
v¬ID
 >ğ
sk
) {

209 ++
v¬ID
;

214 
³rmu‹AndP»diùOobSam¶es
(
v¬ID
, 
³rmutiÚs
);

215 
	gaccu¿cy_³rmu‹d
 = 
compu‹P»diùiÚAccu¿cyIÁ”Çl
();

216 
	gaccu¿cy_difã»nû
 = 
accu¿cy_nÜm®
 - 
accu¿cy_³rmu‹d
;

217 (*
	gfÜe¡_impÜnû
)[
i
] +ğ
accu¿cy_difã»nû
;

220 ià(
	gimpÜnû_mode
 =ğ
IMP_PERM_BREIMAN
) {

221 (*
fÜe¡_v¬Ÿnû
)[
i
] +ğ
accu¿cy_difã»nû
 *‡ccuracy_difference;

222 } ià(
	gimpÜnû_mode
 =ğ
IMP_PERM_LIAW
) {

223 (*
fÜe¡_v¬Ÿnû
)[
i
] +ğ
accu¿cy_difã»nû
 *‡ccu¿cy_difã»nû * 
num_§m¶es_oob
;

228 
	gT»e
::
	$­³ndToFe
(
¡d
::
of¡»am
& 
fe
) {

231 
	`§veVeùÜ2D
(
chd_nodeIDs
, 
fe
);

232 
	`§veVeùÜ1D
(
¥l™_v¬IDs
, 
fe
);

233 
	`§veVeùÜ1D
(
¥l™_v®ues
, 
fe
);

236 
	`­³ndToFeIÁ”Çl
(
fe
);

237 
	}
}

239 
	gT»e
::
ü—‹PossibËS¶™V¬Sub£t
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
) {

242 
¡d
::
cİy
(
d‘”mši¡ic_v¬IDs
->
begš
(), d‘”mši¡ic_v¬IDs->
’d
(), std::
š£¹”
(
»suÉ
,„esult.end()));

245 ià(
	g¥l™_£Ëù_weights
->
em±y
()) {

246 
d¿wW™houtR•Ïûm’tSk
(
»suÉ
, 
¿ndom_numb”_g’”©Ü
, 
d©a
->
g‘NumCŞs
(), *
no_¥l™_v¬ŸbËs
, 
mŒy
);

248 
size_t
 
	gnum_d¿ws
 = 
mŒy
 - 
»suÉ
.
size
();

249 
d¿wW™houtR•Ïûm’tWeigh‹d
(
»suÉ
, 
¿ndom_numb”_g’”©Ü
, *
¥l™_£Ëù_v¬IDs
, 
num_d¿ws
,

250 *
¥l™_£Ëù_weights
);

254 
boŞ
 
	gT»e
::
	$¥l™Node
(
size_t
 
nodeID
) {

257 
¡d
::
veùÜ
<
size_t
> 
possibË_¥l™_v¬IDs
;

258 
	`ü—‹PossibËS¶™V¬Sub£t
(
possibË_¥l™_v¬IDs
);

261 
boŞ
 
¡İ
 = 
	`¥l™NodeIÁ”Çl
(
nodeID
, 
possibË_¥l™_v¬IDs
);

262 ià(
¡İ
) {

264  
Œue
;

267 
size_t
 
¥l™_v¬ID
 = 
¥l™_v¬IDs
[
nodeID
];

268 
¥l™_v®ue
 = 
¥l™_v®ues
[
nodeID
];

271 
size_t
 
Ëá_chd_nodeID
 = 
§m¶eIDs
.
	`size
();

272 
chd_nodeIDs
[0][
nodeID
] = 
Ëá_chd_nodeID
;

273 
	`ü—‹Em±yNode
();

275 
size_t
 
right_chd_nodeID
 = 
§m¶eIDs
.
	`size
();

276 
chd_nodeIDs
[1][
nodeID
] = 
right_chd_nodeID
;

277 
	`ü—‹Em±yNode
();

280 ià((*
is_Üd”ed_v¬ŸbË
)[
¥l™_v¬ID
]) {

282 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

283 ià(
d©a
->
	`g‘
(
§m¶eID
, 
¥l™_v¬ID
è<ğ
¥l™_v®ue
) {

284 
§m¶eIDs
[
Ëá_chd_nodeID
].
	`push_back
(
§m¶eID
);

286 
§m¶eIDs
[
right_chd_nodeID
].
	`push_back
(
§m¶eID
);

291 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

292 
Ëv–
 = 
d©a
->
	`g‘
(
§m¶eID
, 
¥l™_v¬ID
);

293 
size_t
 
çùÜID
 = 
	`æoÜ
(
Ëv–
) - 1;

294 
size_t
 
¥l™ID
 = 
	`æoÜ
(
¥l™_v®ue
);

297 ià(!(
¥l™ID
 & (1 << 
çùÜID
))) {

298 
§m¶eIDs
[
Ëá_chd_nodeID
].
	`push_back
(
§m¶eID
);

300 
§m¶eIDs
[
right_chd_nodeID
].
	`push_back
(
§m¶eID
);

306  
çl£
;

307 
	}
}

309 
	gT»e
::
	$ü—‹Em±yNode
() {

310 
¥l™_v¬IDs
.
	`push_back
(0);

311 
¥l™_v®ues
.
	`push_back
(0);

312 
chd_nodeIDs
[0].
	`push_back
(0);

313 
chd_nodeIDs
[1].
	`push_back
(0);

314 
§m¶eIDs
.
	`push_back
(
¡d
::
veùÜ
<
size_t
>());

316 
	`ü—‹Em±yNodeIÁ”Çl
();

317 
	}
}

319 
size_t
 
	gT»e
::
	$drİDownSam¶eP”mu‹d
(
size_t
 
³rmu‹d_v¬ID
, size_ˆ
§m¶eID
, size_ˆ
³rmu‹d_§m¶eID
) {

322 
size_t
 
nodeID
 = 0;

323 
chd_nodeIDs
[0][
nodeID
] != 0 || child_nodeIDs[1][nodeID] != 0) {

326 
size_t
 
¥l™_v¬ID
 = 
¥l™_v¬IDs
[
nodeID
];

327 
size_t
 
§m¶eID_fš®
 = 
§m¶eID
;

328 ià(
¥l™_v¬ID
 =ğ
³rmu‹d_v¬ID
) {

329 
§m¶eID_fš®
 = 
³rmu‹d_§m¶eID
;

333 
v®ue
 = 
d©a
->
	`g‘
(
§m¶eID_fš®
, 
¥l™_v¬ID
);

334 ià((*
is_Üd”ed_v¬ŸbË
)[
¥l™_v¬ID
]) {

335 ià(
v®ue
 <ğ
¥l™_v®ues
[
nodeID
]) {

337 
nodeID
 = 
chd_nodeIDs
[0][nodeID];

340 
nodeID
 = 
chd_nodeIDs
[1][nodeID];

343 
size_t
 
çùÜID
 = 
	`æoÜ
(
v®ue
) - 1;

344 
size_t
 
¥l™ID
 = 
	`æoÜ
(
¥l™_v®ues
[
nodeID
]);

347 ià(!(
¥l™ID
 & (1 << 
çùÜID
))) {

349 
nodeID
 = 
chd_nodeIDs
[0][nodeID];

352 
nodeID
 = 
chd_nodeIDs
[1][nodeID];

357  
nodeID
;

358 
	}
}

360 
	gT»e
::
³rmu‹AndP»diùOobSam¶es
(
size_t
 
³rmu‹d_v¬ID
, 
¡d
::
veùÜ
<size_t>& 
³rmutiÚs
) {

364 
¡d
::
shufæe
(
³rmutiÚs
.
begš
(),…”mutiÚs.
’d
(), 
¿ndom_numb”_g’”©Ü
);

367 
size_t
 
	gi
 = 0; i < 
	gnum_§m¶es_oob
; ++i) {

368 
size_t
 
	gnodeID
 = 
drİDownSam¶eP”mu‹d
(
³rmu‹d_v¬ID
, 
oob_§m¶eIDs
[
i
], 
³rmutiÚs
[i]);

369 
	g´ediùiÚ_‹rmš®_nodeIDs
[
i
] = 
nodeID
;

373 
	gT»e
::
	$boÙ¡¿p
() {

376 
size_t
 
num_§m¶es_šbag
 = (size_tè
num_§m¶es
 * 
§m¶e_äaùiÚ
;

379 
§m¶eIDs
[0].
	`»£rve
(
num_§m¶es_šbag
);

380 
oob_§m¶eIDs
.
	`»£rve
(
num_§m¶es
 * (
	`exp
(-
§m¶e_äaùiÚ
) + 0.1));

382 
¡d
::
unifÜm_št_di¡ributiÚ
<
size_t
> 
	`unif_di¡
(0, 
num_§m¶es
 - 1);

385 
šbag_couÁs
.
	`»size
(
num_§m¶es
, 0);

388 
size_t
 
s
 = 0; s < 
num_§m¶es_šbag
; ++s) {

389 
size_t
 
d¿w
 = 
	`unif_di¡
(
¿ndom_numb”_g’”©Ü
);

390 
§m¶eIDs
[0].
	`push_back
(
d¿w
);

391 ++
šbag_couÁs
[
d¿w
];

395 
size_t
 
s
 = 0; s < 
šbag_couÁs
.
	`size
(); ++s) {

396 ià(
šbag_couÁs
[
s
] == 0) {

397 
oob_§m¶eIDs
.
	`push_back
(
s
);

400 
num_§m¶es_oob
 = 
oob_§m¶eIDs
.
	`size
();

402 ià(!
k“p_šbag
) {

403 
šbag_couÁs
.
	`ş—r
();

405 
	}
}

407 
	gT»e
::
	$boÙ¡¿pWeigh‹d
() {

410 
size_t
 
num_§m¶es_šbag
 = (size_tè
num_§m¶es
 * 
§m¶e_äaùiÚ
;

413 
§m¶eIDs
[0].
	`»£rve
(
num_§m¶es_šbag
);

414 
oob_§m¶eIDs
.
	`»£rve
(
num_§m¶es
 * (
	`exp
(-
§m¶e_äaùiÚ
) + 0.1));

416 
¡d
::
disü‘e_di¡ributiÚ
<> 
	`weigh‹d_di¡
(
ÿ£_weights
->
	`begš
(), ca£_weights->
	`’d
());

419 
šbag_couÁs
.
	`»size
(
num_§m¶es
, 0);

422 
size_t
 
s
 = 0; s < 
num_§m¶es_šbag
; ++s) {

423 
size_t
 
d¿w
 = 
	`weigh‹d_di¡
(
¿ndom_numb”_g’”©Ü
);

424 
§m¶eIDs
[0].
	`push_back
(
d¿w
);

425 ++
šbag_couÁs
[
d¿w
];

429 ià(
hŞdout
) {

430 
size_t
 
s
 = 0; s < (*
ÿ£_weights
).
	`size
(); ++s) {

431 ià((*
ÿ£_weights
)[
s
] == 0) {

432 
oob_§m¶eIDs
.
	`push_back
(
s
);

436 
size_t
 
s
 = 0; s < 
šbag_couÁs
.
	`size
(); ++s) {

437 ià(
šbag_couÁs
[
s
] == 0) {

438 
oob_§m¶eIDs
.
	`push_back
(
s
);

442 
num_§m¶es_oob
 = 
oob_§m¶eIDs
.
	`size
();

444 ià(!
k“p_šbag
) {

445 
šbag_couÁs
.
	`ş—r
();

447 
	}
}

449 
	gT»e
::
	$boÙ¡¿pW™houtR•Ïûm’t
() {

452 
size_t
 
num_§m¶es_šbag
 = (size_tè
num_§m¶es
 * 
§m¶e_äaùiÚ
;

453 
	`shufæeAndS¶™
(
§m¶eIDs
[0], 
oob_§m¶eIDs
, 
num_§m¶es
, 
num_§m¶es_šbag
, 
¿ndom_numb”_g’”©Ü
);

454 
num_§m¶es_oob
 = 
oob_§m¶eIDs
.
	`size
();

456 ià(
k“p_šbag
) {

458 
šbag_couÁs
.
	`»size
(
num_§m¶es
, 1);

459 
size_t
 
i
 = 0; i < 
oob_§m¶eIDs
.
	`size
(); i++) {

460 
šbag_couÁs
[
oob_§m¶eIDs
[
i
]] = 0;

463 
	}
}

465 
	gT»e
::
	$boÙ¡¿pW™houtR•Ïûm’tWeigh‹d
() {

468 
size_t
 
num_§m¶es_šbag
 = (size_tè
num_§m¶es
 * 
§m¶e_äaùiÚ
;

469 
	`d¿wW™houtR•Ïûm’tWeigh‹d
(
§m¶eIDs
[0], 
¿ndom_numb”_g’”©Ü
, 
num_§m¶es
 - 1, 
num_§m¶es_šbag
,

470 *
ÿ£_weights
);

473 
šbag_couÁs
.
	`»size
(
num_§m¶es
, 0);

474 auto& 
§m¶eID
 : 
§m¶eIDs
[0]) {

475 
šbag_couÁs
[
§m¶eID
] = 1;

479 ià(
hŞdout
) {

480 
size_t
 
s
 = 0; s < (*
ÿ£_weights
).
	`size
(); ++s) {

481 ià((*
ÿ£_weights
)[
s
] == 0) {

482 
oob_§m¶eIDs
.
	`push_back
(
s
);

486 
size_t
 
s
 = 0; s < 
šbag_couÁs
.
	`size
(); ++s) {

487 ià(
šbag_couÁs
[
s
] == 0) {

488 
oob_§m¶eIDs
.
	`push_back
(
s
);

492 
num_§m¶es_oob
 = 
oob_§m¶eIDs
.
	`size
();

494 ià(!
k“p_šbag
) {

495 
šbag_couÁs
.
	`ş—r
();

497 
	}
}

	@Tree/Tree.h

29 #iâdeà
TREE_H_


30 
	#TREE_H_


	)

32 
	~<veùÜ
>

33 
	~<¿ndom
>

34 
	~<io¡»am
>

36 
	~"glob®s.h
"

37 
	~"D©a.h
"

39 şas 
	cT»e
 {

40 
	mpublic
:

41 
T»e
();

44 
T»e
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
chd_nodeIDs
, std::veùÜ<size_t>& 
¥l™_v¬IDs
,

45 
¡d
::
veùÜ
<>& 
¥l™_v®ues
, std::veùÜ<
boŞ
>* 
is_Üd”ed_v¬ŸbË
);

47 
	mvœtu®
 ~
T»e
();

49 
š™
(
D©a
* 
d©a
, 
ušt
 
mŒy
, 
size_t
 
d•’d’t_v¬ID
, size_ˆ
num_§m¶es
, ušˆ
£ed
,

50 
¡d
::
veùÜ
<
size_t
>* 
d‘”mši¡ic_v¬IDs
, std::veùÜ<size_t>* 
¥l™_£Ëù_v¬IDs
,

51 
¡d
::
veùÜ
<>* 
¥l™_£Ëù_weights
, 
ImpÜnûMode
 
impÜnû_mode
, 
ušt
 
mš_node_size
,

52 
¡d
::
veùÜ
<
size_t
>* 
no_¥l™_v¬ŸbËs
, 
boŞ
 
§m¶e_w™h_»¶aûm’t
, std::veùÜ<boŞ>* 
is_unÜd”ed
,

53 
boŞ
 
memÜy_§všg_¥l™tšg
, 
S¶™RuË
 
¥l™ruË
, 
¡d
::
veùÜ
<>* 
ÿ£_weights
, boŞ 
k“p_šbag
,

54 
§m¶e_äaùiÚ
, 
®pha
, 
mš´İ
, 
boŞ
 
hŞdout
);

56 
vœtu®
 
š™IÁ”Çl
() = 0;

58 
grow
(
¡d
::
veùÜ
<>* 
v¬ŸbË_impÜnû
);

60 
´ediù
(cÚ¡ 
D©a
* 
´ediùiÚ_d©a
, 
boŞ
 
oob_´ediùiÚ
);

62 
compu‹P”mutiÚImpÜnû
(
¡d
::
veùÜ
<>* 
fÜe¡_impÜnû
, std::veùÜ<>* 
fÜe¡_v¬Ÿnû
);

64 
­³ndToFe
(
¡d
::
of¡»am
& 
fe
);

65 
vœtu®
 
­³ndToFeIÁ”Çl
(
¡d
::
of¡»am
& 
fe
) = 0;

67 cÚ¡ 
	m¡d
::
veùÜ
<
¡d
::veùÜ<
size_t
> >& 
	$g‘ChdNodeIDs
() const {

68  
chd_nodeIDs
;

70 cÚ¡ 
¡d
::
veùÜ
<>& 
	$g‘S¶™V®ues
() const {

71  
¥l™_v®ues
;

72 
	}
}

73 cÚ¡ 
	g¡d
::
veùÜ
<
size_t
>& 
	$g‘S¶™V¬IDs
() const {

74  
¥l™_v¬IDs
;

75 
	}
}

77 cÚ¡ 
	g¡d
::
veùÜ
<
size_t
>& 
	$g‘OobSam¶eIDs
() const {

78  
oob_§m¶eIDs
;

79 
	}
}

80 
size_t
 
	$g‘NumSam¶esOob
() const {

81  
num_§m¶es_oob
;

82 
	}
}

84 cÚ¡ 
	g¡d
::
veùÜ
<
size_t
>& 
	$g‘InbagCouÁs
() const {

85  
šbag_couÁs
;

86 
	}
}

88 
	g´Ùeùed
:

89 
ü—‹PossibËS¶™V¬Sub£t
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
);

91 
boŞ
 
¥l™Node
(
size_t
 
nodeID
);

92 
vœtu®
 
boŞ
 
¥l™NodeIÁ”Çl
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
) = 0;

94 
ü—‹Em±yNode
();

95 
vœtu®
 
ü—‹Em±yNodeIÁ”Çl
() = 0;

97 
size_t
 
drİDownSam¶eP”mu‹d
(size_ˆ
³rmu‹d_v¬ID
, size_ˆ
§m¶eID
, size_ˆ
³rmu‹d_§m¶eID
);

98 
³rmu‹AndP»diùOobSam¶es
(
size_t
 
³rmu‹d_v¬ID
, 
¡d
::
veùÜ
<size_t>& 
³rmutiÚs
);

100 
vœtu®
 
compu‹P»diùiÚAccu¿cyIÁ”Çl
() = 0;

102 
boÙ¡¿p
();

103 
boÙ¡¿pW™houtR•Ïûm’t
();

105 
boÙ¡¿pWeigh‹d
();

106 
boÙ¡¿pW™houtR•Ïûm’tWeigh‹d
();

108 
vœtu®
 
ş—nUpIÁ”Çl
() = 0;

110 
size_t
 
	gd•’d’t_v¬ID
;

111 
ušt
 
	gmŒy
;

114 
size_t
 
	gnum_§m¶es
;

117 
size_t
 
	gnum_§m¶es_oob
;

120 
	g¡d
::
veùÜ
<
boŞ
>* 
is_Üd”ed_v¬ŸbË
;

123 
	g¡d
::
veùÜ
<
size_t
>* 
no_¥l™_v¬ŸbËs
;

126 
ušt
 
	gmš_node_size
;

130 
	g¡d
::
veùÜ
<
size_t
>* 
d‘”mši¡ic_v¬IDs
;

131 
	g¡d
::
veùÜ
<
size_t
>* 
¥l™_£Ëù_v¬IDs
;

132 
	g¡d
::
veùÜ
<>* 
¥l™_£Ëù_weights
;

135 
	g¡d
::
veùÜ
<>* 
ÿ£_weights
;

138 
	g¡d
::
veùÜ
<
size_t
> 
¥l™_v¬IDs
;

142 
	g¡d
::
veùÜ
<> 
¥l™_v®ues
;

145 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
size_t
>> 
chd_nodeIDs
;

148 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
size_t
>> 
§m¶eIDs
;

151 
	g¡d
::
veùÜ
<
size_t
> 
oob_§m¶eIDs
;

154 
boŞ
 
	ghŞdout
;

157 
boŞ
 
	gk“p_šbag
;

158 
	g¡d
::
veùÜ
<
size_t
> 
šbag_couÁs
;

161 
	g¡d
::
mt19937_64
 
¿ndom_numb”_g’”©Ü
;

164 
D©a
* 
	gd©a
;

167 
	g¡d
::
veùÜ
<>* 
v¬ŸbË_impÜnû
;

168 
ImpÜnûMode
 
	gimpÜnû_mode
;

172 
	g¡d
::
veùÜ
<
size_t
> 
´ediùiÚ_‹rmš®_nodeIDs
;

174 
boŞ
 
	g§m¶e_w™h_»¶aûm’t
;

175 
	g§m¶e_äaùiÚ
;

177 
boŞ
 
	gmemÜy_§všg_¥l™tšg
;

178 
S¶™RuË
 
	g¥l™ruË
;

179 
	g®pha
;

180 
	gmš´İ
;

182 
	g´iv©e
:

183 
DISALLOW_COPY_AND_ASSIGN
(
T»e
);

	@Tree/TreeClassification.cpp

29 
	~<unÜd”ed_m­
>

30 
	~<¿ndom
>

31 
	~<®gÜ™hm
>

32 
	~<io¡»am
>

33 
	~<™”©Ü
>

34 
	~<veùÜ
>

36 
	~"T»eCÏssifiÿtiÚ.h
"

37 
	~"ut™y.h
"

38 
	~"D©a.h
"

40 
	gT»eCÏssifiÿtiÚ
::
T»eCÏssifiÿtiÚ
(
¡d
::
veùÜ
<>* 
şass_v®ues
, std::veùÜ<
ušt
>* 
»¥Ú£_şassIDs
) :

41 
şass_v®ues
(şass_v®ues), 
»¥Ú£_şassIDs
Ôe¥Ú£_şassIDs), 
couÁ”
(0), 
	$couÁ”_³r_şass
(0) {

42 
	}
}

44 
	gT»eCÏssifiÿtiÚ
::
T»eCÏssifiÿtiÚ
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
chd_nodeIDs
,

45 
¡d
::
veùÜ
<
size_t
>& 
¥l™_v¬IDs
, std::veùÜ<>& 
¥l™_v®ues
, std::veùÜ<>* 
şass_v®ues
,

46 
¡d
::
veùÜ
<
ušt
>* 
»¥Ú£_şassIDs
, std::veùÜ<
boŞ
>* 
is_Üd”ed_v¬ŸbË
) :

47 
T»e
(
chd_nodeIDs
, 
¥l™_v¬IDs
, 
¥l™_v®ues
, 
is_Üd”ed_v¬ŸbË
), 
şass_v®ues
(şass_v®ues), 
»¥Ú£_şassIDs
(

48 
»¥Ú£_şassIDs
), 
couÁ”
(0), 
	$couÁ”_³r_şass
(0) {

49 
	}
}

51 
	gT»eCÏssifiÿtiÚ
::~
	$T»eCÏssifiÿtiÚ
() {

53 
	}
}

55 
T»eCÏssifiÿtiÚ
::
	$š™IÁ”Çl
() {

57 ià(!
memÜy_§všg_¥l™tšg
) {

58 
size_t
 
num_şas£s
 = 
şass_v®ues
->
	`size
();

59 
size_t
 
max_num_unique_v®ues
 = 
d©a
->
	`g‘MaxNumUniqueV®ues
();

60 
couÁ”
 = 
Ãw
 
size_t
[
max_num_unique_v®ues
];

61 
couÁ”_³r_şass
 = 
Ãw
 
size_t
[
num_şas£s
 * 
max_num_unique_v®ues
];

63 
	}
}

65 
	gT»eCÏssifiÿtiÚ
::
	$e¡im©e
(
size_t
 
nodeID
) {

68 
¡d
::
unÜd”ed_m­
<, 
size_t
> 
şass_couÁ
;

69 
size_t
 
i
 = 0; i < 
§m¶eIDs
[
nodeID
].
	`size
(); ++i) {

70 
v®ue
 = 
d©a
->
	`g‘
(
§m¶eIDs
[
nodeID
][
i
], 
d•’d’t_v¬ID
);

71 ++
şass_couÁ
[
v®ue
];

74  (
	`mo¡F»qu’tV®ue
(
şass_couÁ
, 
¿ndom_numb”_g’”©Ü
));

75 
	}
}

77 
	gT»eCÏssifiÿtiÚ
::
	$­³ndToFeIÁ”Çl
(
¡d
::
of¡»am
& 
fe
) {

79 
	}
}

81 
boŞ
 
T»eCÏssifiÿtiÚ
::
¥l™NodeIÁ”Çl
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
) {

84 ià(
§m¶eIDs
[
nodeID
].
size
(è<ğ
mš_node_size
) {

85 
¥l™_v®ues
[
nodeID
] = 
e¡im©e
(nodeID);

86  
	gŒue
;

90 
boŞ
 
	gpu»
 = 
Œue
;

91 
	gpu»_v®ue
 = 0;

92 
size_t
 
	gi
 = 0; i < 
	g§m¶eIDs
[
nodeID
].
size
(); ++i) {

93 
	gv®ue
 = 
d©a
->
g‘
(
§m¶eIDs
[
nodeID
][
i
], 
d•’d’t_v¬ID
);

94 ià(
	gi
 !ğ0 && 
v®ue
 !ğ
pu»_v®ue
) {

95 
pu»
 = 
çl£
;

98 
	gpu»_v®ue
 = 
v®ue
;

100 ià(
	gpu»
) {

101 
	g¥l™_v®ues
[
nodeID
] = 
pu»_v®ue
;

102  
	gŒue
;

106 
boŞ
 
	g¡İ
 = 
fšdBe¡S¶™
(
nodeID
, 
possibË_¥l™_v¬IDs
);

107 ià(
	g¡İ
) {

108 
	g¥l™_v®ues
[
nodeID
] = 
e¡im©e
(nodeID);

109  
	gŒue
;

112  
	gçl£
;

115 
	gT»eCÏssifiÿtiÚ
::
	$ü—‹Em±yNodeIÁ”Çl
() {

117 
	}
}

119 
T»eCÏssifiÿtiÚ
::
	$compu‹P»diùiÚAccu¿cyIÁ”Çl
() {

121 
size_t
 
num_´ediùiÚs
 = 
´ediùiÚ_‹rmš®_nodeIDs
.
	`size
();

122 
size_t
 
num_missşassifiÿtiÚs
 = 0;

123 
size_t
 
i
 = 0; i < 
num_´ediùiÚs
; ++i) {

124 
size_t
 
‹rmš®_nodeID
 = 
´ediùiÚ_‹rmš®_nodeIDs
[
i
];

125 
´ediùed_v®ue
 = 
¥l™_v®ues
[
‹rmš®_nodeID
];

126 
»®_v®ue
 = 
d©a
->
	`g‘
(
oob_§m¶eIDs
[
i
], 
d•’d’t_v¬ID
);

127 ià(
´ediùed_v®ue
 !ğ
»®_v®ue
) {

128 ++
num_missşassifiÿtiÚs
;

131  (1.0 - (è
num_missşassifiÿtiÚs
 / (è
num_´ediùiÚs
);

132 
	}
}

134 
boŞ
 
	gT»eCÏssifiÿtiÚ
::
fšdBe¡S¶™
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
) {

136 
size_t
 
num_§m¶es_node
 = 
§m¶eIDs
[
nodeID
].
size
();

137 
size_t
 
	gnum_şas£s
 = 
şass_v®ues
->
size
();

138 
	gbe¡_deü—£
 = -1;

139 
size_t
 
	gbe¡_v¬ID
 = 0;

140 
	gbe¡_v®ue
 = 0;

142 
size_t
* 
	gşass_couÁs
 = 
Ãw
 size_t[
num_şas£s
]();

144 
size_t
 
	gi
 = 0; i < 
	gnum_§m¶es_node
; ++i) {

145 
size_t
 
	g§m¶eID
 = 
§m¶eIDs
[
nodeID
][
i
];

146 
ušt
 
	g§m¶e_şassID
 = (*
»¥Ú£_şassIDs
)[
§m¶eID
];

147 ++
	gşass_couÁs
[
§m¶e_şassID
];

151 auto& 
	gv¬ID
 : 
possibË_¥l™_v¬IDs
) {

153 ià((*
is_Üd”ed_v¬ŸbË
)[
v¬ID
]) {

156 ià(
memÜy_§všg_¥l™tšg
) {

157 
fšdBe¡S¶™V®ueSm®lQ
(
nodeID
, 
v¬ID
, 
num_şas£s
, 
şass_couÁs
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
,

158 
be¡_deü—£
);

161 
	gq
 = (è
num_§m¶es_node
 / (è
d©a
->
g‘NumUniqueD©aV®ues
(
v¬ID
);

162 ià(
	gq
 < 
	gQ_THRESHOLD
) {

163 
fšdBe¡S¶™V®ueSm®lQ
(
nodeID
, 
v¬ID
, 
num_şas£s
, 
şass_couÁs
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
,

164 
be¡_deü—£
);

166 
fšdBe¡S¶™V®ueL¬geQ
(
nodeID
, 
v¬ID
, 
num_şas£s
, 
şass_couÁs
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
,

167 
be¡_deü—£
);

171 
fšdBe¡S¶™V®ueUnÜd”ed
(
nodeID
, 
v¬ID
, 
num_şas£s
, 
şass_couÁs
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
,

172 
be¡_deü—£
);

176 
	gd–‘e
[] 
	gşass_couÁs
;

179 ià(
	gbe¡_deü—£
 < 0) {

180  
	gŒue
;

184 
	g¥l™_v¬IDs
[
nodeID
] = 
be¡_v¬ID
;

185 
	g¥l™_v®ues
[
nodeID
] = 
be¡_v®ue
;

188 ià(
	gimpÜnû_mode
 =ğ
IMP_GINI
) {

189 
addGšiImpÜnû
(
nodeID
, 
be¡_v¬ID
, 
be¡_deü—£
);

191  
	gçl£
;

194 
	gT»eCÏssifiÿtiÚ
::
	$fšdBe¡S¶™V®ueSm®lQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
, size_t* 
şass_couÁs
,

195 
size_t
 
num_§m¶es_node
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
, & 
be¡_deü—£
) {

198 
¡d
::
veùÜ
<> 
possibË_¥l™_v®ues
;

199 
d©a
->
	`g‘AÎV®ues
(
possibË_¥l™_v®ues
, 
§m¶eIDs
[
nodeID
], 
v¬ID
);

202 ià(
possibË_¥l™_v®ues
.
	`size
() < 2) {

207 
possibË_¥l™_v®ues
.
	`pİ_back
();

210 
size_t
 
num_¥l™s
 = 
possibË_¥l™_v®ues
.
	`size
();

211 
size_t
* 
şass_couÁs_right
;

212 
size_t
* 
n_right
;

213 ià(
memÜy_§všg_¥l™tšg
) {

214 
şass_couÁs_right
 = 
Ãw
 
size_t
[
num_¥l™s
 * 
num_şas£s
]();

215 
n_right
 = 
Ãw
 
size_t
[
num_¥l™s
]();

217 
şass_couÁs_right
 = 
couÁ”_³r_şass
;

218 
n_right
 = 
couÁ”
;

219 
¡d
::
	`fl
(
şass_couÁs_right
, cÏss_couÁs_righˆ+ 
num_¥l™s
 * 
num_şas£s
, 0);

220 
¡d
::
	`fl
(
n_right
,‚_righˆ+ 
num_¥l™s
, 0);

224 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

225 
v®ue
 = 
d©a
->
	`g‘
(
§m¶eID
, 
v¬ID
);

226 
ušt
 
§m¶e_şassID
 = (*
»¥Ú£_şassIDs
)[
§m¶eID
];

229 
size_t
 
i
 = 0; i < 
num_¥l™s
; ++i) {

230 ià(
v®ue
 > 
possibË_¥l™_v®ues
[
i
]) {

231 ++
n_right
[
i
];

232 ++
şass_couÁs_right
[
i
 * 
num_şas£s
 + 
§m¶e_şassID
];

240 
size_t
 
i
 = 0; i < 
num_¥l™s
; ++i) {

243 
size_t
 
n_Ëá
 = 
num_§m¶es_node
 - 
n_right
[
i
];

244 ià(
n_Ëá
 =ğ0 || 
n_right
[
i
] == 0) {

249 
sum_Ëá
 = 0;

250 
sum_right
 = 0;

251 
size_t
 
j
 = 0; j < 
num_şas£s
; ++j) {

252 
size_t
 
şass_couÁ_right
 = 
şass_couÁs_right
[
i
 * 
num_şas£s
 + 
j
];

253 
size_t
 
şass_couÁ_Ëá
 = 
şass_couÁs
[
j
] - 
şass_couÁ_right
;

255 
sum_right
 +ğ
şass_couÁ_right
 * class_count_right;

256 
sum_Ëá
 +ğ
şass_couÁ_Ëá
 * class_count_left;

260 
deü—£
 = 
sum_Ëá
 / (è
n_Ëá
 + 
sum_right
 / (è
n_right
[
i
];

263 ià(
deü—£
 > 
be¡_deü—£
) {

264 
be¡_v®ue
 = 
possibË_¥l™_v®ues
[
i
];

265 
be¡_v¬ID
 = 
v¬ID
;

266 
be¡_deü—£
 = 
deü—£
;

270 ià(
memÜy_§všg_¥l™tšg
) {

271 
d–‘e
[] 
şass_couÁs_right
;

272 
d–‘e
[] 
n_right
;

274 
	}
}

276 
	gT»eCÏssifiÿtiÚ
::
	$fšdBe¡S¶™V®ueL¬geQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
, size_t* 
şass_couÁs
,

277 
size_t
 
num_§m¶es_node
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
, & 
be¡_deü—£
) {

280 
size_t
 
num_unique
 = 
d©a
->
	`g‘NumUniqueD©aV®ues
(
v¬ID
);

281 
¡d
::
	`fl
(
couÁ”_³r_şass
, couÁ”_³r_şas + 
num_unique
 * 
num_şas£s
, 0);

282 
¡d
::
	`fl
(
couÁ”
, couÁ” + 
num_unique
, 0);

285 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

286 
size_t
 
šdex
 = 
d©a
->
	`g‘Index
(
§m¶eID
, 
v¬ID
);

287 
size_t
 
şassID
 = (*
»¥Ú£_şassIDs
)[
§m¶eID
];

289 ++
couÁ”
[
šdex
];

290 ++
couÁ”_³r_şass
[
šdex
 * 
num_şas£s
 + 
şassID
];

293 
size_t
 
n_Ëá
 = 0;

294 
size_t
* 
şass_couÁs_Ëá
 = 
Ãw
 size_t[
num_şas£s
]();

297 
size_t
 
i
 = 0; i < 
num_unique
 - 1; ++i) {

300 ià(
couÁ”
[
i
] == 0) {

304 
n_Ëá
 +ğ
couÁ”
[
i
];

307 
size_t
 
n_right
 = 
num_§m¶es_node
 - 
n_Ëá
;

308 ià(
n_right
 == 0) {

313 
sum_Ëá
 = 0;

314 
sum_right
 = 0;

315 
size_t
 
j
 = 0; j < 
num_şas£s
; ++j) {

316 
şass_couÁs_Ëá
[
j
] +ğ
couÁ”_³r_şass
[
i
 * 
num_şas£s
 + j];

317 
size_t
 
şass_couÁ_right
 = 
şass_couÁs
[
j
] - 
şass_couÁs_Ëá
[j];

319 
sum_Ëá
 +ğ
şass_couÁs_Ëá
[
j
] * class_counts_left[j];

320 
sum_right
 +ğ
şass_couÁ_right
 * class_count_right;

324 
deü—£
 = 
sum_right
 / (è
n_right
 + 
sum_Ëá
 / (è
n_Ëá
;

327 ià(
deü—£
 > 
be¡_deü—£
) {

328 
be¡_v®ue
 = 
d©a
->
	`g‘UniqueD©aV®ue
(
v¬ID
, 
i
);

329 
be¡_v¬ID
 = 
v¬ID
;

330 
be¡_deü—£
 = 
deü—£
;

334 
d–‘e
[] 
şass_couÁs_Ëá
;

335 
	}
}

337 
	gT»eCÏssifiÿtiÚ
::
	$fšdBe¡S¶™V®ueUnÜd”ed
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
,

338 
size_t
* 
şass_couÁs
, size_ˆ
num_§m¶es_node
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
, & 
be¡_deü—£
) {

341 
¡d
::
veùÜ
<> 
çùÜ_Ëv–s
;

342 
d©a
->
	`g‘AÎV®ues
(
çùÜ_Ëv–s
, 
§m¶eIDs
[
nodeID
], 
v¬ID
);

345 ià(
çùÜ_Ëv–s
.
	`size
() < 2) {

350 
size_t
 
num_¥l™s
 = (1 << 
çùÜ_Ëv–s
.
	`size
());

355 
size_t
 
loÿl_¥l™ID
 = 1;†oÿl_¥l™ID < 
num_¥l™s
 / 2; ++local_splitID) {

358 
size_t
 
¥l™ID
 = 0;

359 
size_t
 
j
 = 0; j < 
çùÜ_Ëv–s
.
	`size
(); ++j) {

360 ià((
loÿl_¥l™ID
 & (1 << 
j
))) {

361 
Ëv–
 = 
çùÜ_Ëv–s
[
j
];

362 
size_t
 
çùÜID
 = 
	`æoÜ
(
Ëv–
) - 1;

363 
¥l™ID
 = s¶™ID | (1 << 
çùÜID
);

368 
size_t
* 
şass_couÁs_right
 = 
Ãw
 size_t[
num_şas£s
]();

369 
size_t
 
n_right
 = 0;

372 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

373 
ušt
 
§m¶e_şassID
 = (*
»¥Ú£_şassIDs
)[
§m¶eID
];

374 
v®ue
 = 
d©a
->
	`g‘
(
§m¶eID
, 
v¬ID
);

375 
size_t
 
çùÜID
 = 
	`æoÜ
(
v®ue
) - 1;

379 ià((
¥l™ID
 & (1 << 
çùÜID
))) {

380 ++
n_right
;

381 ++
şass_couÁs_right
[
§m¶e_şassID
];

384 
size_t
 
n_Ëá
 = 
num_§m¶es_node
 - 
n_right
;

387 
sum_Ëá
 = 0;

388 
sum_right
 = 0;

389 
size_t
 
j
 = 0; j < 
num_şas£s
; ++j) {

390 
size_t
 
şass_couÁ_right
 = 
şass_couÁs_right
[
j
];

391 
size_t
 
şass_couÁ_Ëá
 = 
şass_couÁs
[
j
] - 
şass_couÁ_right
;

393 
sum_right
 +ğ
şass_couÁ_right
 * class_count_right;

394 
sum_Ëá
 +ğ
şass_couÁ_Ëá
 * class_count_left;

398 
deü—£
 = 
sum_Ëá
 / (è
n_Ëá
 + 
sum_right
 / (è
n_right
;

401 ià(
deü—£
 > 
be¡_deü—£
) {

402 
be¡_v®ue
 = 
¥l™ID
;

403 
be¡_v¬ID
 = 
v¬ID
;

404 
be¡_deü—£
 = 
deü—£
;

407 
d–‘e
[] 
şass_couÁs_right
;

409 
	}
}

411 
	gT»eCÏssifiÿtiÚ
::
	$addGšiImpÜnû
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
deü—£
) {

413 
¡d
::
veùÜ
<
size_t
> 
şass_couÁs
;

414 
şass_couÁs
.
	`»size
(
şass_v®ues
->
	`size
(), 0);

416 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

417 
ušt
 
§m¶e_şassID
 = (*
»¥Ú£_şassIDs
)[
§m¶eID
];

418 
şass_couÁs
[
§m¶e_şassID
]++;

420 
sum_node
 = 0;

421 auto& 
şass_couÁ
 : 
şass_couÁs
) {

422 
sum_node
 +ğ
şass_couÁ
 * class_count;

424 
be¡_gši
 = 
deü—£
 - 
sum_node
 / (è
§m¶eIDs
[
nodeID
].
	`size
();

427 
size_t
 
‹mpv¬ID
 = 
v¬ID
;

428 auto& 
sk
 : *
no_¥l™_v¬ŸbËs
) {

429 ià(
v¬ID
 >ğ
sk
) {

430 --
‹mpv¬ID
;

433 (*
v¬ŸbË_impÜnû
)[
‹mpv¬ID
] +ğ
be¡_gši
;

434 
	}
}

	@Tree/TreeClassification.h

29 #iâdeà
TREECLASSIFICATION_H_


30 
	#TREECLASSIFICATION_H_


	)

32 
	~"glob®s.h
"

33 
	~"T»e.h
"

35 şas 
	cT»eCÏssifiÿtiÚ
: 
public
 
T»e
 {

36 
public
:

37 
T»eCÏssifiÿtiÚ
(
¡d
::
veùÜ
<>* 
şass_v®ues
, std::veùÜ<
ušt
>* 
»¥Ú£_şassIDs
);

40 
T»eCÏssifiÿtiÚ
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
chd_nodeIDs
, std::veùÜ<size_t>& 
¥l™_v¬IDs
,

41 
¡d
::
veùÜ
<>& 
¥l™_v®ues
, std::veùÜ<>* 
şass_v®ues
, std::veùÜ<
ušt
>* 
»¥Ú£_şassIDs
,

42 
¡d
::
veùÜ
<
boŞ
>* 
is_Üd”ed_v¬ŸbË
);

44 
	mvœtu®
 ~
T»eCÏssifiÿtiÚ
();

46 
š™IÁ”Çl
();

48 
e¡im©e
(
size_t
 
nodeID
);

49 
compu‹P”mutiÚImpÜnûIÁ”Çl
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>* 
³rmutiÚs
);

50 
­³ndToFeIÁ”Çl
(
¡d
::
of¡»am
& 
fe
);

52 
	$g‘P»diùiÚ
(
size_t
 
§m¶eID
) const {

53 
size_t
 
‹rmš®_nodeID
 = 
´ediùiÚ_‹rmš®_nodeIDs
[
§m¶eID
];

54  (
¥l™_v®ues
[
‹rmš®_nodeID
]);

57 
´iv©e
:

58 
boŞ
 
	`¥l™NodeIÁ”Çl
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
);

59 
	`ü—‹Em±yNodeIÁ”Çl
();

61 
	`compu‹P»diùiÚAccu¿cyIÁ”Çl
();

64 
boŞ
 
	`fšdBe¡S¶™
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
);

65 
	`fšdBe¡S¶™V®ueSm®lQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
, size_t* 
şass_couÁs
,

66 
size_t
 
num_§m¶es_node
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
, & 
be¡_deü—£
);

67 
	`fšdBe¡S¶™V®ueL¬geQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
, size_t* 
şass_couÁs
,

68 
size_t
 
num_§m¶es_node
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
, & 
be¡_deü—£
);

69 
	`fšdBe¡S¶™V®ueUnÜd”ed
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
, size_t* 
şass_couÁs
,

70 
size_t
 
num_§m¶es_node
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
, & 
be¡_deü—£
);

72 
	`addGšiImpÜnû
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
deü—£
);

74 
	$ş—nUpIÁ”Çl
() {

75 ià(
couÁ”
 != 0) {

76 
d–‘e
[] 
couÁ”
;

78 ià(
couÁ”_³r_şass
 != 0) {

79 
d–‘e
[] 
couÁ”_³r_şass
;

81 
	}
}

84 
	g¡d
::
veùÜ
<>* 
şass_v®ues
;

85 
	g¡d
::
veùÜ
<
ušt
>* 
»¥Ú£_şassIDs
;

87 
size_t
* 
	gcouÁ”
;

88 
size_t
* 
	gcouÁ”_³r_şass
;

90 
DISALLOW_COPY_AND_ASSIGN
(
T»eCÏssifiÿtiÚ
);

	@Tree/TreeProbability.cpp

29 
	~"T»eProbab™y.h
"

30 
	~"ut™y.h
"

31 
	~"D©a.h
"

33 
	gT»eProbab™y
::
T»eProbab™y
(
¡d
::
veùÜ
<>* 
şass_v®ues
, std::veùÜ<
ušt
>* 
»¥Ú£_şassIDs
) :

34 
şass_v®ues
(şass_v®ues), 
»¥Ú£_şassIDs
Ôe¥Ú£_şassIDs), 
couÁ”
(0), 
	$couÁ”_³r_şass
(0) {

35 
	}
}

37 
	gT»eProbab™y
::
T»eProbab™y
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
chd_nodeIDs
, std::veùÜ<size_t>& 
¥l™_v¬IDs
,

38 
¡d
::
veùÜ
<>& 
¥l™_v®ues
, std::veùÜ<>* 
şass_v®ues
, std::veùÜ<
ušt
>* 
»¥Ú£_şassIDs
,

39 
¡d
::
veùÜ
<¡d::veùÜ<>>& 
‹rmš®_şass_couÁs
, std::veùÜ<
boŞ
>* 
is_Üd”ed_v¬ŸbË
) :

40 
T»e
(
chd_nodeIDs
, 
¥l™_v¬IDs
, 
¥l™_v®ues
, 
is_Üd”ed_v¬ŸbË
), 
şass_v®ues
(şass_v®ues), 
»¥Ú£_şassIDs
(

41 
»¥Ú£_şassIDs
), 
‹rmš®_şass_couÁs
Ñ”mš®_şass_couÁs), 
couÁ”
(0), 
	$couÁ”_³r_şass
(0) {

42 
	}
}

44 
	gT»eProbab™y
::~
	$T»eProbab™y
() {

46 
	}
}

48 
T»eProbab™y
::
	$š™IÁ”Çl
() {

50 ià(!
memÜy_§všg_¥l™tšg
) {

51 
size_t
 
num_şas£s
 = 
şass_v®ues
->
	`size
();

52 
size_t
 
max_num_unique_v®ues
 = 
d©a
->
	`g‘MaxNumUniqueV®ues
();

53 
couÁ”
 = 
Ãw
 
size_t
[
max_num_unique_v®ues
];

54 
couÁ”_³r_şass
 = 
Ãw
 
size_t
[
num_şas£s
 * 
max_num_unique_v®ues
];

56 
	}
}

58 
	gT»eProbab™y
::
	$addToT”mš®Nodes
(
size_t
 
nodeID
) {

60 
size_t
 
num_§m¶es_š_node
 = 
§m¶eIDs
[
nodeID
].
	`size
();

61 
‹rmš®_şass_couÁs
[
nodeID
].
	`»size
(
şass_v®ues
->
	`size
(), 0);

64 
size_t
 
i
 = 0; i < 
num_§m¶es_š_node
; ++i) {

65 
size_t
 
node_§m¶eID
 = 
§m¶eIDs
[
nodeID
][
i
];

66 
size_t
 
şassID
 = (*
»¥Ú£_şassIDs
)[
node_§m¶eID
];

67 ++
‹rmš®_şass_couÁs
[
nodeID
][
şassID
];

71 
size_t
 
i
 = 0; i < 
‹rmš®_şass_couÁs
[
nodeID
].
	`size
(); ++i) {

72 
‹rmš®_şass_couÁs
[
nodeID
][
i
] /ğ
num_§m¶es_š_node
;

74 
	}
}

76 
	gT»eProbab™y
::
	$­³ndToFeIÁ”Çl
(
¡d
::
of¡»am
& 
fe
) {

80 
¡d
::
veùÜ
<
size_t
> 
‹rmš®_nodes
;

81 
¡d
::
veùÜ
<¡d::veùÜ<>> 
‹rmš®_şass_couÁs_veùÜ
;

82 
size_t
 
i
 = 0; i < 
‹rmš®_şass_couÁs
.
	`size
(); ++i) {

83 ià(!
‹rmš®_şass_couÁs
[
i
].
	`em±y
()) {

84 
‹rmš®_nodes
.
	`push_back
(
i
);

85 
‹rmš®_şass_couÁs_veùÜ
.
	`push_back
(
‹rmš®_şass_couÁs
[
i
]);

88 
	`§veVeùÜ1D
(
‹rmš®_nodes
, 
fe
);

89 
	`§veVeùÜ2D
(
‹rmš®_şass_couÁs_veùÜ
, 
fe
);

90 
	}
}

92 
boŞ
 
	gT»eProbab™y
::
¥l™NodeIÁ”Çl
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
) {

95 ià(
§m¶eIDs
[
nodeID
].
size
(è<ğ
mš_node_size
) {

96 
addToT”mš®Nodes
(
nodeID
);

97  
	gŒue
;

101 
boŞ
 
	gpu»
 = 
Œue
;

102 
	gpu»_v®ue
 = 0;

103 
size_t
 
	gi
 = 0; i < 
	g§m¶eIDs
[
nodeID
].
size
(); ++i) {

104 
	gv®ue
 = 
d©a
->
g‘
(
§m¶eIDs
[
nodeID
][
i
], 
d•’d’t_v¬ID
);

105 ià(
	gi
 !ğ0 && 
v®ue
 !ğ
pu»_v®ue
) {

106 
pu»
 = 
çl£
;

109 
	gpu»_v®ue
 = 
v®ue
;

111 ià(
	gpu»
) {

112 
addToT”mš®Nodes
(
nodeID
);

113  
	gŒue
;

117 
boŞ
 
	g¡İ
 = 
fšdBe¡S¶™
(
nodeID
, 
possibË_¥l™_v¬IDs
);

118 ià(
	g¡İ
) {

119 
addToT”mš®Nodes
(
nodeID
);

120  
	gŒue
;

123  
	gçl£
;

126 
	gT»eProbab™y
::
	$ü—‹Em±yNodeIÁ”Çl
() {

127 
‹rmš®_şass_couÁs
.
	`push_back
(
¡d
::
veùÜ
<>());

128 
	}
}

130 
	gT»eProbab™y
::
	$compu‹P»diùiÚAccu¿cyIÁ”Çl
() {

132 
size_t
 
num_´ediùiÚs
 = 
´ediùiÚ_‹rmš®_nodeIDs
.
	`size
();

133 
sum_of_squ¬es
 = 0;

134 
size_t
 
i
 = 0; i < 
num_´ediùiÚs
; ++i) {

135 
size_t
 
§m¶eID
 = 
oob_§m¶eIDs
[
i
];

136 
size_t
 
»®_şassID
 = (*
»¥Ú£_şassIDs
)[
§m¶eID
];

137 
size_t
 
‹rmš®_nodeID
 = 
´ediùiÚ_‹rmš®_nodeIDs
[
i
];

138 
´ediùed_v®ue
 = 
‹rmš®_şass_couÁs
[
‹rmš®_nodeID
][
»®_şassID
];

139 
sum_of_squ¬es
 +ğ(1 - 
´ediùed_v®ue
) * (1 -…redicted_value);

141  (1.0 - 
sum_of_squ¬es
 / (è
num_´ediùiÚs
);

142 
	}
}

144 
boŞ
 
	gT»eProbab™y
::
fšdBe¡S¶™
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
) {

146 
size_t
 
num_§m¶es_node
 = 
§m¶eIDs
[
nodeID
].
size
();

147 
size_t
 
	gnum_şas£s
 = 
şass_v®ues
->
size
();

148 
	gbe¡_deü—£
 = -1;

149 
size_t
 
	gbe¡_v¬ID
 = 0;

150 
	gbe¡_v®ue
 = 0;

152 
size_t
* 
	gşass_couÁs
 = 
Ãw
 size_t[
num_şas£s
]();

154 
size_t
 
	gi
 = 0; i < 
	gnum_§m¶es_node
; ++i) {

155 
size_t
 
	g§m¶eID
 = 
§m¶eIDs
[
nodeID
][
i
];

156 
ušt
 
	g§m¶e_şassID
 = (*
»¥Ú£_şassIDs
)[
§m¶eID
];

157 ++
	gşass_couÁs
[
§m¶e_şassID
];

161 auto& 
	gv¬ID
 : 
possibË_¥l™_v¬IDs
) {

163 ià((*
is_Üd”ed_v¬ŸbË
)[
v¬ID
]) {

166 ià(
memÜy_§všg_¥l™tšg
) {

167 
fšdBe¡S¶™V®ueSm®lQ
(
nodeID
, 
v¬ID
, 
num_şas£s
, 
şass_couÁs
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
,

168 
be¡_deü—£
);

171 
	gq
 = (è
num_§m¶es_node
 / (è
d©a
->
g‘NumUniqueD©aV®ues
(
v¬ID
);

172 ià(
	gq
 < 
	gQ_THRESHOLD
) {

173 
fšdBe¡S¶™V®ueSm®lQ
(
nodeID
, 
v¬ID
, 
num_şas£s
, 
şass_couÁs
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
,

174 
be¡_deü—£
);

176 
fšdBe¡S¶™V®ueL¬geQ
(
nodeID
, 
v¬ID
, 
num_şas£s
, 
şass_couÁs
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
,

177 
be¡_deü—£
);

181 
fšdBe¡S¶™V®ueUnÜd”ed
(
nodeID
, 
v¬ID
, 
num_şas£s
, 
şass_couÁs
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
,

182 
be¡_deü—£
);

186 
	gd–‘e
[] 
	gşass_couÁs
;

189 ià(
	gbe¡_deü—£
 < 0) {

190  
	gŒue
;

194 
	g¥l™_v¬IDs
[
nodeID
] = 
be¡_v¬ID
;

195 
	g¥l™_v®ues
[
nodeID
] = 
be¡_v®ue
;

198 ià(
	gimpÜnû_mode
 =ğ
IMP_GINI
) {

199 
addImpur™yImpÜnû
(
nodeID
, 
be¡_v¬ID
, 
be¡_deü—£
);

201  
	gçl£
;

204 
	gT»eProbab™y
::
	$fšdBe¡S¶™V®ueSm®lQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
, size_t* 
şass_couÁs
,

205 
size_t
 
num_§m¶es_node
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
, & 
be¡_deü—£
) {

208 
¡d
::
veùÜ
<> 
possibË_¥l™_v®ues
;

209 
d©a
->
	`g‘AÎV®ues
(
possibË_¥l™_v®ues
, 
§m¶eIDs
[
nodeID
], 
v¬ID
);

212 ià(
possibË_¥l™_v®ues
.
	`size
() < 2) {

217 
possibË_¥l™_v®ues
.
	`pİ_back
();

220 
size_t
 
num_¥l™s
 = 
possibË_¥l™_v®ues
.
	`size
();

221 
size_t
* 
şass_couÁs_right
;

222 
size_t
* 
n_right
;

223 ià(
memÜy_§všg_¥l™tšg
) {

224 
şass_couÁs_right
 = 
Ãw
 
size_t
[
num_¥l™s
 * 
num_şas£s
]();

225 
n_right
 = 
Ãw
 
size_t
[
num_¥l™s
]();

227 
şass_couÁs_right
 = 
couÁ”_³r_şass
;

228 
n_right
 = 
couÁ”
;

229 
¡d
::
	`fl
(
şass_couÁs_right
, cÏss_couÁs_righˆ+ 
num_¥l™s
 * 
num_şas£s
, 0);

230 
¡d
::
	`fl
(
n_right
,‚_righˆ+ 
num_¥l™s
, 0);

234 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

235 
v®ue
 = 
d©a
->
	`g‘
(
§m¶eID
, 
v¬ID
);

236 
ušt
 
§m¶e_şassID
 = (*
»¥Ú£_şassIDs
)[
§m¶eID
];

239 
size_t
 
i
 = 0; i < 
num_¥l™s
; ++i) {

240 ià(
v®ue
 > 
possibË_¥l™_v®ues
[
i
]) {

241 ++
n_right
[
i
];

242 ++
şass_couÁs_right
[
i
 * 
num_şas£s
 + 
§m¶e_şassID
];

250 
size_t
 
i
 = 0; i < 
num_¥l™s
; ++i) {

253 
size_t
 
n_Ëá
 = 
num_§m¶es_node
 - 
n_right
[
i
];

254 ià(
n_Ëá
 =ğ0 || 
n_right
[
i
] == 0) {

259 
sum_Ëá
 = 0;

260 
sum_right
 = 0;

261 
size_t
 
j
 = 0; j < 
num_şas£s
; ++j) {

262 
size_t
 
şass_couÁ_right
 = 
şass_couÁs_right
[
i
 * 
num_şas£s
 + 
j
];

263 
size_t
 
şass_couÁ_Ëá
 = 
şass_couÁs
[
j
] - 
şass_couÁ_right
;

265 
sum_right
 +ğ
şass_couÁ_right
 * class_count_right;

266 
sum_Ëá
 +ğ
şass_couÁ_Ëá
 * class_count_left;

270 
deü—£
 = 
sum_Ëá
 / (è
n_Ëá
 + 
sum_right
 / (è
n_right
[
i
];

273 ià(
deü—£
 > 
be¡_deü—£
) {

274 
be¡_v®ue
 = 
possibË_¥l™_v®ues
[
i
];

275 
be¡_v¬ID
 = 
v¬ID
;

276 
be¡_deü—£
 = 
deü—£
;

280 ià(
memÜy_§všg_¥l™tšg
) {

281 
d–‘e
[] 
şass_couÁs_right
;

282 
d–‘e
[] 
n_right
;

284 
	}
}

286 
	gT»eProbab™y
::
	$fšdBe¡S¶™V®ueL¬geQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
, size_t* 
şass_couÁs
,

287 
size_t
 
num_§m¶es_node
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
, & 
be¡_deü—£
) {

290 
size_t
 
num_unique
 = 
d©a
->
	`g‘NumUniqueD©aV®ues
(
v¬ID
);

291 
¡d
::
	`fl
(
couÁ”_³r_şass
, couÁ”_³r_şas + 
num_unique
 * 
num_şas£s
, 0);

292 
¡d
::
	`fl
(
couÁ”
, couÁ” + 
num_unique
, 0);

295 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

296 
size_t
 
šdex
 = 
d©a
->
	`g‘Index
(
§m¶eID
, 
v¬ID
);

297 
size_t
 
şassID
 = (*
»¥Ú£_şassIDs
)[
§m¶eID
];

299 ++
couÁ”
[
šdex
];

300 ++
couÁ”_³r_şass
[
šdex
 * 
num_şas£s
 + 
şassID
];

303 
size_t
 
n_Ëá
 = 0;

304 
size_t
* 
şass_couÁs_Ëá
 = 
Ãw
 size_t[
num_şas£s
]();

307 
size_t
 
i
 = 0; i < 
num_unique
 - 1; ++i) {

310 ià(
couÁ”
[
i
] == 0) {

314 
n_Ëá
 +ğ
couÁ”
[
i
];

317 
size_t
 
n_right
 = 
num_§m¶es_node
 - 
n_Ëá
;

318 ià(
n_right
 == 0) {

323 
sum_Ëá
 = 0;

324 
sum_right
 = 0;

325 
size_t
 
j
 = 0; j < 
num_şas£s
; ++j) {

326 
şass_couÁs_Ëá
[
j
] +ğ
couÁ”_³r_şass
[
i
 * 
num_şas£s
 + j];

327 
size_t
 
şass_couÁ_right
 = 
şass_couÁs
[
j
] - 
şass_couÁs_Ëá
[j];

329 
sum_Ëá
 +ğ
şass_couÁs_Ëá
[
j
] * class_counts_left[j];

330 
sum_right
 +ğ
şass_couÁ_right
 * class_count_right;

334 
deü—£
 = 
sum_right
 / (è
n_right
 + 
sum_Ëá
 / (è
n_Ëá
;

337 ià(
deü—£
 > 
be¡_deü—£
) {

338 
be¡_v®ue
 = 
d©a
->
	`g‘UniqueD©aV®ue
(
v¬ID
, 
i
);

339 
be¡_v¬ID
 = 
v¬ID
;

340 
be¡_deü—£
 = 
deü—£
;

343 
	}
}

345 
	gT»eProbab™y
::
	$fšdBe¡S¶™V®ueUnÜd”ed
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
, size_t* 
şass_couÁs
,

346 
size_t
 
num_§m¶es_node
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
, & 
be¡_deü—£
) {

349 
¡d
::
veùÜ
<> 
çùÜ_Ëv–s
;

350 
d©a
->
	`g‘AÎV®ues
(
çùÜ_Ëv–s
, 
§m¶eIDs
[
nodeID
], 
v¬ID
);

353 ià(
çùÜ_Ëv–s
.
	`size
() < 2) {

358 
size_t
 
num_¥l™s
 = (1 << 
çùÜ_Ëv–s
.
	`size
());

363 
size_t
 
loÿl_¥l™ID
 = 1;†oÿl_¥l™ID < 
num_¥l™s
 / 2; ++local_splitID) {

366 
size_t
 
¥l™ID
 = 0;

367 
size_t
 
j
 = 0; j < 
çùÜ_Ëv–s
.
	`size
(); ++j) {

368 ià((
loÿl_¥l™ID
 & (1 << 
j
))) {

369 
Ëv–
 = 
çùÜ_Ëv–s
[
j
];

370 
size_t
 
çùÜID
 = 
	`æoÜ
(
Ëv–
) - 1;

371 
¥l™ID
 = s¶™ID | (1 << 
çùÜID
);

376 
size_t
* 
şass_couÁs_right
 = 
Ãw
 size_t[
num_şas£s
]();

377 
size_t
 
n_right
 = 0;

380 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

381 
ušt
 
§m¶e_şassID
 = (*
»¥Ú£_şassIDs
)[
§m¶eID
];

382 
v®ue
 = 
d©a
->
	`g‘
(
§m¶eID
, 
v¬ID
);

383 
size_t
 
çùÜID
 = 
	`æoÜ
(
v®ue
) - 1;

387 ià((
¥l™ID
 & (1 << 
çùÜID
))) {

388 ++
n_right
;

389 ++
şass_couÁs_right
[
§m¶e_şassID
];

392 
size_t
 
n_Ëá
 = 
num_§m¶es_node
 - 
n_right
;

395 
sum_Ëá
 = 0;

396 
sum_right
 = 0;

397 
size_t
 
j
 = 0; j < 
num_şas£s
; ++j) {

398 
size_t
 
şass_couÁ_right
 = 
şass_couÁs_right
[
j
];

399 
size_t
 
şass_couÁ_Ëá
 = 
şass_couÁs
[
j
] - 
şass_couÁ_right
;

401 
sum_right
 +ğ
şass_couÁ_right
 * class_count_right;

402 
sum_Ëá
 +ğ
şass_couÁ_Ëá
 * class_count_left;

406 
deü—£
 = 
sum_Ëá
 / (è
n_Ëá
 + 
sum_right
 / (è
n_right
;

409 ià(
deü—£
 > 
be¡_deü—£
) {

410 
be¡_v®ue
 = 
¥l™ID
;

411 
be¡_v¬ID
 = 
v¬ID
;

412 
be¡_deü—£
 = 
deü—£
;

415 
	}
}

417 
	gT»eProbab™y
::
	$addImpur™yImpÜnû
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
deü—£
) {

419 
¡d
::
veùÜ
<
size_t
> 
şass_couÁs
;

420 
şass_couÁs
.
	`»size
(
şass_v®ues
->
	`size
(), 0);

422 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

423 
ušt
 
§m¶e_şassID
 = (*
»¥Ú£_şassIDs
)[
§m¶eID
];

424 
şass_couÁs
[
§m¶e_şassID
]++;

426 
sum_node
 = 0;

427 auto& 
şass_couÁ
 : 
şass_couÁs
) {

428 
sum_node
 +ğ
şass_couÁ
 * class_count;

430 
be¡_gši
 = 
deü—£
 - 
sum_node
 / (è
§m¶eIDs
[
nodeID
].
	`size
();

433 
size_t
 
‹mpv¬ID
 = 
v¬ID
;

434 auto& 
sk
 : *
no_¥l™_v¬ŸbËs
) {

435 ià(
v¬ID
 >ğ
sk
) {

436 --
‹mpv¬ID
;

439 (*
v¬ŸbË_impÜnû
)[
‹mpv¬ID
] +ğ
be¡_gši
;

440 
	}
}

	@Tree/TreeProbability.h

29 #iâdeà
TREEPROBABILITY_H_


30 
	#TREEPROBABILITY_H_


	)

32 
	~<m­
>

34 
	~"glob®s.h
"

35 
	~"T»e.h
"

37 şas 
	cT»eProbab™y
: 
public
 
T»e
 {

38 
public
:

39 
T»eProbab™y
(
¡d
::
veùÜ
<>* 
şass_v®ues
, std::veùÜ<
ušt
>* 
»¥Ú£_şassIDs
);

42 
T»eProbab™y
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
chd_nodeIDs
, std::veùÜ<size_t>& 
¥l™_v¬IDs
,

43 
¡d
::
veùÜ
<>& 
¥l™_v®ues
, std::veùÜ<>* 
şass_v®ues
, std::veùÜ<
ušt
>* 
»¥Ú£_şassIDs
,

44 
¡d
::
veùÜ
<¡d::veùÜ<>>& 
‹rmš®_şass_couÁs
, std::veùÜ<
boŞ
>* 
is_Üd”ed_v¬ŸbË
);

46 
	mvœtu®
 ~
T»eProbab™y
();

48 
š™IÁ”Çl
();

50 
addToT”mš®Nodes
(
size_t
 
nodeID
);

51 
compu‹P”mutiÚImpÜnûIÁ”Çl
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>* 
³rmutiÚs
);

52 
­³ndToFeIÁ”Çl
(
¡d
::
of¡»am
& 
fe
);

54 cÚ¡ 
	m¡d
::
veùÜ
<>& 
	$g‘P»diùiÚ
(
size_t
 
§m¶eID
) const {

55 
size_t
 
‹rmš®_nodeID
 = 
´ediùiÚ_‹rmš®_nodeIDs
[
§m¶eID
];

56  (
‹rmš®_şass_couÁs
[
‹rmš®_nodeID
]);

59 cÚ¡ 
¡d
::
veùÜ
<¡d::veùÜ<>>& 
	$g‘T”mš®CÏssCouÁs
() const {

60  
‹rmš®_şass_couÁs
;

61 
	}
}

63 
	g´iv©e
:

64 
boŞ
 
¥l™NodeIÁ”Çl
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
);

65 
ü—‹Em±yNodeIÁ”Çl
();

67 
compu‹P»diùiÚAccu¿cyIÁ”Çl
();

70 
boŞ
 
fšdBe¡S¶™
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
);

71 
fšdBe¡S¶™V®ueSm®lQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
, size_t* 
şass_couÁs
, size_ˆ
num_§m¶es_node
,

72 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_deü—£
);

73 
fšdBe¡S¶™V®ueL¬geQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
, size_t* 
şass_couÁs
, size_ˆ
num_§m¶es_node
,

74 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_deü—£
);

75 
fšdBe¡S¶™V®ueUnÜd”ed
(
size_t
 
nodeID
, size_ˆ
v¬ID
, size_ˆ
num_şas£s
, size_t* 
şass_couÁs
, size_ˆ
num_§m¶es_node
,

76 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_deü—£
);

78 
addImpur™yImpÜnû
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
deü—£
);

80 
	$ş—nUpIÁ”Çl
() {

81 ià(
couÁ”
 != 0) {

82 
d–‘e
[] 
couÁ”
;

84 ià(
couÁ”_³r_şass
 != 0) {

85 
d–‘e
[] 
couÁ”_³r_şass
;

87 
	}
}

90 
	g¡d
::
veùÜ
<>* 
şass_v®ues
;

91 
	g¡d
::
veùÜ
<
ušt
>* 
»¥Ú£_şassIDs
;

94 
	g¡d
::
veùÜ
<
¡d
::veùÜ<>> 
‹rmš®_şass_couÁs
;

96 
size_t
* 
	gcouÁ”
;

97 
size_t
* 
	gcouÁ”_³r_şass
;

99 
DISALLOW_COPY_AND_ASSIGN
(
T»eProbab™y
);

	@Tree/TreeRegression.cpp

29 
	~<®gÜ™hm
>

30 
	~<io¡»am
>

31 
	~<™”©Ü
>

32 
	~<veùÜ
>

34 
	~<ùime
>

36 
	~"ut™y.h
"

37 
	~"T»eReg»ssiÚ.h
"

38 
	~"D©a.h
"

40 
	gT»eReg»ssiÚ
::
	$T»eReg»ssiÚ
() :

41 
	`couÁ”
(0), 
	$sums
(0) {

42 
	}
}

44 
	gT»eReg»ssiÚ
::
T»eReg»ssiÚ
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
chd_nodeIDs
, std::veùÜ<size_t>& 
¥l™_v¬IDs
,

45 
¡d
::
veùÜ
<>& 
¥l™_v®ues
, std::veùÜ<
boŞ
>* 
is_Üd”ed_v¬ŸbË
) :

46 
T»e
(
chd_nodeIDs
, 
¥l™_v¬IDs
, 
¥l™_v®ues
, 
is_Üd”ed_v¬ŸbË
), 
couÁ”
(0), 
	$sums
(0) {

47 
	}
}

49 
	gT»eReg»ssiÚ
::~
	$T»eReg»ssiÚ
() {

51 
	}
}

53 
T»eReg»ssiÚ
::
	$š™IÁ”Çl
() {

55 ià(!
memÜy_§všg_¥l™tšg
) {

56 
size_t
 
max_num_unique_v®ues
 = 
d©a
->
	`g‘MaxNumUniqueV®ues
();

57 
couÁ”
 = 
Ãw
 
size_t
[
max_num_unique_v®ues
];

58 
sums
 = 
Ãw
 [
max_num_unique_v®ues
];

60 
	}
}

62 
	gT»eReg»ssiÚ
::
	$e¡im©e
(
size_t
 
nodeID
) {

65 
sum_»¥Ú£s_š_node
 = 0;

66 
size_t
 
num_§m¶es_š_node
 = 
§m¶eIDs
[
nodeID
].
	`size
();

67 
size_t
 
i
 = 0; i < 
§m¶eIDs
[
nodeID
].
	`size
(); ++i) {

68 
sum_»¥Ú£s_š_node
 +ğ
d©a
->
	`g‘
(
§m¶eIDs
[
nodeID
][
i
], 
d•’d’t_v¬ID
);

70  (
sum_»¥Ú£s_š_node
 / (è
num_§m¶es_š_node
);

71 
	}
}

73 
	gT»eReg»ssiÚ
::
	$­³ndToFeIÁ”Çl
(
¡d
::
of¡»am
& 
fe
) {

75 
	}
}

77 
boŞ
 
T»eReg»ssiÚ
::
¥l™NodeIÁ”Çl
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
) {

80 ià(
§m¶eIDs
[
nodeID
].
size
(è<ğ
mš_node_size
) {

81 
¥l™_v®ues
[
nodeID
] = 
e¡im©e
(nodeID);

82  
	gŒue
;

86 
boŞ
 
	gpu»
 = 
Œue
;

87 
	gpu»_v®ue
 = 0;

88 
size_t
 
	gi
 = 0; i < 
	g§m¶eIDs
[
nodeID
].
size
(); ++i) {

89 
	gv®ue
 = 
d©a
->
g‘
(
§m¶eIDs
[
nodeID
][
i
], 
d•’d’t_v¬ID
);

90 ià(
	gi
 !ğ0 && 
v®ue
 !ğ
pu»_v®ue
) {

91 
pu»
 = 
çl£
;

94 
	gpu»_v®ue
 = 
v®ue
;

96 ià(
	gpu»
) {

97 
	g¥l™_v®ues
[
nodeID
] = 
pu»_v®ue
;

98  
	gŒue
;

102 
boŞ
 
	g¡İ
;

103 ià(
	g¥l™ruË
 =ğ
MAXSTAT
) {

104 
¡İ
 = 
fšdBe¡S¶™Max¡©
(
nodeID
, 
possibË_¥l™_v¬IDs
);

106 
	g¡İ
 = 
fšdBe¡S¶™
(
nodeID
, 
possibË_¥l™_v¬IDs
);

109 ià(
	g¡İ
) {

110 
	g¥l™_v®ues
[
nodeID
] = 
e¡im©e
(nodeID);

111  
	gŒue
;

114  
	gçl£
;

117 
	gT»eReg»ssiÚ
::
	$ü—‹Em±yNodeIÁ”Çl
() {

119 
	}
}

121 
T»eReg»ssiÚ
::
	$compu‹P»diùiÚAccu¿cyIÁ”Çl
() {

123 
size_t
 
num_´ediùiÚs
 = 
´ediùiÚ_‹rmš®_nodeIDs
.
	`size
();

124 
sum_of_squ¬es
 = 0;

125 
size_t
 
i
 = 0; i < 
num_´ediùiÚs
; ++i) {

126 
size_t
 
‹rmš®_nodeID
 = 
´ediùiÚ_‹rmš®_nodeIDs
[
i
];

127 
´ediùed_v®ue
 = 
¥l™_v®ues
[
‹rmš®_nodeID
];

128 
»®_v®ue
 = 
d©a
->
	`g‘
(
oob_§m¶eIDs
[
i
], 
d•’d’t_v¬ID
);

129 ià(
´ediùed_v®ue
 !ğ
»®_v®ue
) {

130 
sum_of_squ¬es
 +ğ(
´ediùed_v®ue
 - 
»®_v®ue
) * (predicted_value -„eal_value);

133  (1.0 - 
sum_of_squ¬es
 / (è
num_´ediùiÚs
);

134 
	}
}

136 
boŞ
 
	gT»eReg»ssiÚ
::
fšdBe¡S¶™
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
) {

138 
size_t
 
num_§m¶es_node
 = 
§m¶eIDs
[
nodeID
].
size
();

139 
	gbe¡_deü—£
 = -1;

140 
size_t
 
	gbe¡_v¬ID
 = 0;

141 
	gbe¡_v®ue
 = 0;

144 
	gsum_node
 = 0;

145 auto& 
	g§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

146 
sum_node
 +ğ
d©a
->
g‘
(
§m¶eID
, 
d•’d’t_v¬ID
);

150 auto& 
	gv¬ID
 : 
possibË_¥l™_v¬IDs
) {

153 ià((*
is_Üd”ed_v¬ŸbË
)[
v¬ID
]) {

156 ià(
memÜy_§všg_¥l™tšg
) {

157 
fšdBe¡S¶™V®ueSm®lQ
(
nodeID
, 
v¬ID
, 
sum_node
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
, 
be¡_deü—£
);

160 
	gq
 = (è
num_§m¶es_node
 / (è
d©a
->
g‘NumUniqueD©aV®ues
(
v¬ID
);

161 ià(
	gq
 < 
	gQ_THRESHOLD
) {

162 
fšdBe¡S¶™V®ueSm®lQ
(
nodeID
, 
v¬ID
, 
sum_node
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
, 
be¡_deü—£
);

164 
fšdBe¡S¶™V®ueL¬geQ
(
nodeID
, 
v¬ID
, 
sum_node
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
, 
be¡_deü—£
);

168 
fšdBe¡S¶™V®ueUnÜd”ed
(
nodeID
, 
v¬ID
, 
sum_node
, 
num_§m¶es_node
, 
be¡_v®ue
, 
be¡_v¬ID
, 
be¡_deü—£
);

173 ià(
	gbe¡_deü—£
 < 0) {

174  
	gŒue
;

178 
	g¥l™_v¬IDs
[
nodeID
] = 
be¡_v¬ID
;

179 
	g¥l™_v®ues
[
nodeID
] = 
be¡_v®ue
;

182 ià(
	gimpÜnû_mode
 =ğ
IMP_GINI
) {

183 
addImpur™yImpÜnû
(
nodeID
, 
be¡_v¬ID
, 
be¡_deü—£
);

185  
	gçl£
;

188 
	gT»eReg»ssiÚ
::
	$fšdBe¡S¶™V®ueSm®lQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
sum_node
, size_ˆ
num_§m¶es_node
,

189 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_deü—£
) {

192 
¡d
::
veùÜ
<> 
possibË_¥l™_v®ues
;

193 
d©a
->
	`g‘AÎV®ues
(
possibË_¥l™_v®ues
, 
§m¶eIDs
[
nodeID
], 
v¬ID
);

196 ià(
possibË_¥l™_v®ues
.
	`size
() < 2) {

201 
possibË_¥l™_v®ues
.
	`pİ_back
();

204 
size_t
 
num_¥l™s
 = 
possibË_¥l™_v®ues
.
	`size
();

205 * 
sums_right
;

206 
size_t
* 
n_right
;

207 ià(
memÜy_§všg_¥l™tšg
) {

208 
sums_right
 = 
Ãw
 [
num_¥l™s
]();

209 
n_right
 = 
Ãw
 
size_t
[
num_¥l™s
]();

211 
sums_right
 = 
sums
;

212 
n_right
 = 
couÁ”
;

213 
¡d
::
	`fl
(
sums_right
, sums_righˆ+ 
num_¥l™s
, 0);

214 
¡d
::
	`fl
(
n_right
,‚_righˆ+ 
num_¥l™s
, 0);

218 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

219 
v®ue
 = 
d©a
->
	`g‘
(
§m¶eID
, 
v¬ID
);

220 
»¥Ú£
 = 
d©a
->
	`g‘
(
§m¶eID
, 
d•’d’t_v¬ID
);

223 
size_t
 
i
 = 0; i < 
num_¥l™s
; ++i) {

224 ià(
v®ue
 > 
possibË_¥l™_v®ues
[
i
]) {

225 ++
n_right
[
i
];

226 
sums_right
[
i
] +ğ
»¥Ú£
;

234 
size_t
 
i
 = 0; i < 
num_¥l™s
; ++i) {

237 
size_t
 
n_Ëá
 = 
num_§m¶es_node
 - 
n_right
[
i
];

238 ià(
n_Ëá
 =ğ0 || 
n_right
[
i
] == 0) {

242 
sum_right
 = 
sums_right
[
i
];

243 
sum_Ëá
 = 
sum_node
 - 
sum_right
;

244 
deü—£
 = 
sum_Ëá
 * sum_Ëá / (è
n_Ëá
 + 
sum_right
 * sum_righˆ/ (è
n_right
[
i
];

247 ià(
deü—£
 > 
be¡_deü—£
) {

248 
be¡_v®ue
 = 
possibË_¥l™_v®ues
[
i
];

249 
be¡_v¬ID
 = 
v¬ID
;

250 
be¡_deü—£
 = 
deü—£
;

254 ià(
memÜy_§všg_¥l™tšg
) {

255 
d–‘e
[] 
sums_right
;

256 
d–‘e
[] 
n_right
;

258 
	}
}

260 
	gT»eReg»ssiÚ
::
	$fšdBe¡S¶™V®ueL¬geQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
sum_node
, size_ˆ
num_§m¶es_node
,

261 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_deü—£
) {

264 
size_t
 
num_unique
 = 
d©a
->
	`g‘NumUniqueD©aV®ues
(
v¬ID
);

265 
¡d
::
	`fl
(
couÁ”
, couÁ” + 
num_unique
, 0);

266 
¡d
::
	`fl
(
sums
, sum + 
num_unique
, 0);

268 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

269 
size_t
 
šdex
 = 
d©a
->
	`g‘Index
(
§m¶eID
, 
v¬ID
);

271 
sums
[
šdex
] +ğ
d©a
->
	`g‘
(
§m¶eID
, 
d•’d’t_v¬ID
);

272 ++
couÁ”
[
šdex
];

275 
size_t
 
n_Ëá
 = 0;

276 
sum_Ëá
 = 0;

279 
size_t
 
i
 = 0; i < 
num_unique
 - 1; ++i) {

282 ià(
couÁ”
[
i
] == 0) {

286 
n_Ëá
 +ğ
couÁ”
[
i
];

287 
sum_Ëá
 +ğ
sums
[
i
];

290 
size_t
 
n_right
 = 
num_§m¶es_node
 - 
n_Ëá
;

291 ià(
n_right
 == 0) {

295 
sum_right
 = 
sum_node
 - 
sum_Ëá
;

296 
deü—£
 = 
sum_Ëá
 * sum_Ëá / (è
n_Ëá
 + 
sum_right
 * sum_righˆ/ (è
n_right
;

299 ià(
deü—£
 > 
be¡_deü—£
) {

300 
be¡_v®ue
 = 
d©a
->
	`g‘UniqueD©aV®ue
(
v¬ID
, 
i
);

301 
be¡_v¬ID
 = 
v¬ID
;

302 
be¡_deü—£
 = 
deü—£
;

305 
	}
}

307 
	gT»eReg»ssiÚ
::
	$fšdBe¡S¶™V®ueUnÜd”ed
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
sum_node
, size_ˆ
num_§m¶es_node
,

308 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_deü—£
) {

311 
¡d
::
veùÜ
<> 
çùÜ_Ëv–s
;

312 
d©a
->
	`g‘AÎV®ues
(
çùÜ_Ëv–s
, 
§m¶eIDs
[
nodeID
], 
v¬ID
);

315 ià(
çùÜ_Ëv–s
.
	`size
() < 2) {

320 
size_t
 
num_¥l™s
 = (1 << 
çùÜ_Ëv–s
.
	`size
());

325 
size_t
 
loÿl_¥l™ID
 = 1;†oÿl_¥l™ID < 
num_¥l™s
 / 2; ++local_splitID) {

328 
size_t
 
¥l™ID
 = 0;

329 
size_t
 
j
 = 0; j < 
çùÜ_Ëv–s
.
	`size
(); ++j) {

330 ià((
loÿl_¥l™ID
 & (1 << 
j
))) {

331 
Ëv–
 = 
çùÜ_Ëv–s
[
j
];

332 
size_t
 
çùÜID
 = 
	`æoÜ
(
Ëv–
) - 1;

333 
¥l™ID
 = s¶™ID | (1 << 
çùÜID
);

338 
sum_right
 = 0;

339 
size_t
 
n_right
 = 0;

342 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

343 
»¥Ú£
 = 
d©a
->
	`g‘
(
§m¶eID
, 
d•’d’t_v¬ID
);

344 
v®ue
 = 
d©a
->
	`g‘
(
§m¶eID
, 
v¬ID
);

345 
size_t
 
çùÜID
 = 
	`æoÜ
(
v®ue
) - 1;

349 ià((
¥l™ID
 & (1 << 
çùÜID
))) {

350 ++
n_right
;

351 
sum_right
 +ğ
»¥Ú£
;

354 
size_t
 
n_Ëá
 = 
num_§m¶es_node
 - 
n_right
;

357 
sum_Ëá
 = 
sum_node
 - 
sum_right
;

358 
deü—£
 = 
sum_Ëá
 * sum_Ëá / (è
n_Ëá
 + 
sum_right
 * sum_righˆ/ (è
n_right
;

361 ià(
deü—£
 > 
be¡_deü—£
) {

362 
be¡_v®ue
 = 
¥l™ID
;

363 
be¡_v¬ID
 = 
v¬ID
;

364 
be¡_deü—£
 = 
deü—£
;

367 
	}
}

369 
boŞ
 
	gT»eReg»ssiÚ
::
fšdBe¡S¶™Max¡©
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
) {

371 
size_t
 
num_§m¶es_node
 = 
§m¶eIDs
[
nodeID
].
size
();

374 
	g¡d
::
veùÜ
<> 
»¥Ú£
;

375 
	g»¥Ú£
.
»£rve
(
num_§m¶es_node
);

376 auto& 
	g§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

377 
»¥Ú£
.
push_back
(
d©a
->
g‘
(
§m¶eID
, 
d•’d’t_v¬ID
));

379 
	g¡d
::
veùÜ
<> 
¿nks
 = 
¿nk
(
»¥Ú£
);

382 
	g¡d
::
veùÜ
<> 
pv®ues
;

383 
	gpv®ues
.
»£rve
(
possibË_¥l™_v¬IDs
.
size
());

384 
	g¡d
::
veùÜ
<> 
v®ues
;

385 
	gv®ues
.
»£rve
(
possibË_¥l™_v¬IDs
.
size
());

386 
	g¡d
::
veùÜ
<> 
ÿndid©e_v¬IDs
;

387 
	gÿndid©e_v¬IDs
.
»£rve
(
possibË_¥l™_v¬IDs
.
size
());

390 auto& 
	gv¬ID
 : 
possibË_¥l™_v¬IDs
) {

393 
¡d
::
veùÜ
<> 
x
;

394 
	gx
.
»£rve
(
num_§m¶es_node
);

395 auto& 
	g§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

396 
x
.
push_back
(
d©a
->
g‘
(
§m¶eID
, 
v¬ID
));

400 
	g¡d
::
veùÜ
<
size_t
> 
šdiûs
 = 
Üd”
(
x
, 
çl£
);

404 
	gbe¡_max¡©
;

405 
	gbe¡_¥l™_v®ue
;

406 
max¡©
(
¿nks
, 
x
, 
šdiûs
, 
be¡_max¡©
, 
be¡_¥l™_v®ue
, 
mš´İ
, 1 - minprop);

409 ià(
	gbe¡_max¡©
 > -1) {

411 
	g¡d
::
veùÜ
<
size_t
> 
num_§m¶es_Ëá
 = 
numSam¶esLeáOfCuošt
(
x
, 
šdiûs
);

415 
	gpv®ue_Ïu92
 = 
max¡©PV®ueLau92
(
be¡_max¡©
, 
mš´İ
, 1 - minprop);

416 
	gpv®ue_Ïu94
 = 
max¡©PV®ueLau94
(
be¡_max¡©
, 
mš´İ
, 1 - mš´İ, 
num_§m¶es_node
, 
num_§m¶es_Ëá
);

419 
	gpv®ue
 = 
¡d
::
mš
(
pv®ue_Ïu92
, 
pv®ue_Ïu94
);

422 
	gpv®ues
.
push_back
(
pv®ue
);

423 
	gv®ues
.
push_back
(
be¡_¥l™_v®ue
);

424 
	gÿndid©e_v¬IDs
.
push_back
(
v¬ID
);

428 
	gadju¡ed_be¡_pv®ue
 = 
¡d
::
num”ic_lim™s
<>::
max
();

429 
size_t
 
	gbe¡_v¬ID
 = 0;

430 
	gbe¡_v®ue
 = 0;

432 ià(
	gpv®ues
.
size
() > 0) {

434 
	g¡d
::
veùÜ
<> 
adju¡ed_pv®ues
 = 
adju¡Pv®ues
(
pv®ues
);

437 
	gmš_pv®ue
 = 
¡d
::
num”ic_lim™s
<>::
max
();

438 
size_t
 
	gi
 = 0; i < 
	gpv®ues
.
size
(); ++i) {

439 ià(
	gpv®ues
[
i
] < 
	gmš_pv®ue
) {

440 
	gmš_pv®ue
 = 
pv®ues
[
i
];

441 
	gbe¡_v¬ID
 = 
ÿndid©e_v¬IDs
[
i
];

442 
	gbe¡_v®ue
 = 
v®ues
[
i
];

443 
	gadju¡ed_be¡_pv®ue
 = 
adju¡ed_pv®ues
[
i
];

449 ià(
	gadju¡ed_be¡_pv®ue
 > 
	g®pha
) {

450  
	gŒue
;

453 
	g¥l™_v¬IDs
[
nodeID
] = 
be¡_v¬ID
;

454 
	g¥l™_v®ues
[
nodeID
] = 
be¡_v®ue
;

455  
	gçl£
;

459 
	gT»eReg»ssiÚ
::
	$addImpur™yImpÜnû
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
deü—£
) {

461 
sum_node
 = 0;

462 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

463 
sum_node
 +ğ
d©a
->
	`g‘
(
§m¶eID
, 
d•’d’t_v¬ID
);

465 
be¡_deü—£
 = 
deü—£
 - 
sum_node
 * sum_nod/ (è
§m¶eIDs
[
nodeID
].
	`size
();

468 
size_t
 
‹mpv¬ID
 = 
v¬ID
;

469 auto& 
sk
 : *
no_¥l™_v¬ŸbËs
) {

470 ià(
v¬ID
 >ğ
sk
) {

471 --
‹mpv¬ID
;

474 (*
v¬ŸbË_impÜnû
)[
‹mpv¬ID
] +ğ
be¡_deü—£
;

475 
	}
}

	@Tree/TreeRegression.h

29 #iâdeà
TREEREGRESSION_H_


30 
	#TREEREGRESSION_H_


	)

32 
	~"glob®s.h
"

33 
	~"T»e.h
"

35 şas 
	cT»eReg»ssiÚ
: 
public
 
T»e
 {

36 
public
:

37 
T»eReg»ssiÚ
();

40 
T»eReg»ssiÚ
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
chd_nodeIDs
, std::veùÜ<size_t>& 
¥l™_v¬IDs
,

41 
¡d
::
veùÜ
<>& 
¥l™_v®ues
, std::veùÜ<
boŞ
>* 
is_Üd”ed_v¬ŸbË
);

43 
	mvœtu®
 ~
T»eReg»ssiÚ
();

45 
š™IÁ”Çl
();

47 
e¡im©e
(
size_t
 
nodeID
);

48 
compu‹P”mutiÚImpÜnûIÁ”Çl
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>* 
³rmutiÚs
);

49 
­³ndToFeIÁ”Çl
(
¡d
::
of¡»am
& 
fe
);

51 
	$g‘P»diùiÚ
(
size_t
 
§m¶eID
) const {

52 
size_t
 
‹rmš®_nodeID
 = 
´ediùiÚ_‹rmš®_nodeIDs
[
§m¶eID
];

53  (
¥l™_v®ues
[
‹rmš®_nodeID
]);

56 
´iv©e
:

57 
boŞ
 
	`¥l™NodeIÁ”Çl
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
);

58 
	`ü—‹Em±yNodeIÁ”Çl
();

60 
	`compu‹P»diùiÚAccu¿cyIÁ”Çl
();

63 
boŞ
 
	`fšdBe¡S¶™
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
);

64 
	`fšdBe¡S¶™V®ueSm®lQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
sum_node
, size_ˆ
num_§m¶es_node
,

65 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_deü—£
);

66 
	`fšdBe¡S¶™V®ueL¬geQ
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
sum_node
, size_ˆ
num_§m¶es_node
,

67 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_deü—£
);

68 
	`fšdBe¡S¶™V®ueUnÜd”ed
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
sum_node
, size_ˆ
num_§m¶es_node
,

69 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_deü—£
);

70 
boŞ
 
	`fšdBe¡S¶™Max¡©
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
);

72 
	`addImpur™yImpÜnû
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
deü—£
);

74 
	`compu‹P»diùiÚMSE
();

76 
	$ş—nUpIÁ”Çl
() {

77 ià(
couÁ”
 != 0) {

78 
d–‘e
[] 
couÁ”
;

80 ià(
sums
 != 0) {

81 
d–‘e
[] 
sums
;

83 
	}
}

85 
size_t
* 
	gcouÁ”
;

86 * 
	gsums
;

88 
DISALLOW_COPY_AND_ASSIGN
(
T»eReg»ssiÚ
);

	@Tree/TreeSurvival.cpp

29 
	~<®gÜ™hm
>

30 
	~<cm©h
>

31 
	~<io¡»am
>

32 
	~<™”©Ü
>

33 
	~<num”ic
>

34 
	~<veùÜ
>

36 
	~"ut™y.h
"

37 
	~"T»eSurviv®.h
"

38 
	~"D©a.h
"

40 
	gT»eSurviv®
::
T»eSurviv®
(
¡d
::
veùÜ
<>* 
unique_tim•ošts
, 
size_t
 
¡©us_v¬ID
,

41 
¡d
::
veùÜ
<
size_t
>* 
»¥Ú£_tim•oštIDs
) :

42 
¡©us_v¬ID
(¡©us_v¬ID), 
unique_tim•ošts
(unique_tim•ošts), 
»¥Ú£_tim•oštIDs
Ôe¥Ú£_tim•oštIDs), 
num_d—ths
(

43 0), 
	$num_§m¶es_©_risk
(0) {

44 
this
->
num_tim•ošts
 = 
unique_tim•ošts
->
	`size
();

45 
	}
}

47 
	gT»eSurviv®
::
T»eSurviv®
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
chd_nodeIDs
, std::veùÜ<size_t>& 
¥l™_v¬IDs
,

48 
¡d
::
veùÜ
<>& 
¥l™_v®ues
, std::veùÜ<¡d::veùÜ<>> 
chf
, std::veùÜ<>* 
unique_tim•ošts
,

49 
¡d
::
veùÜ
<
size_t
>* 
»¥Ú£_tim•oštIDs
, std::veùÜ<
boŞ
>* 
is_Üd”ed_v¬ŸbË
) :

50 
T»e
(
chd_nodeIDs
, 
¥l™_v¬IDs
, 
¥l™_v®ues
, 
is_Üd”ed_v¬ŸbË
), 
¡©us_v¬ID
(0), 
unique_tim•ošts
(

51 
unique_tim•ošts
), 
»¥Ú£_tim•oštIDs
Ôe¥Ú£_tim•oštIDs), 
chf
(chf), 
num_d—ths
(0), 
	$num_§m¶es_©_risk
(

53 
this
->
num_tim•ošts
 = 
unique_tim•ošts
->
	`size
();

54 
	}
}

56 
	gT»eSurviv®
::~
	$T»eSurviv®
() {

57 
	}
}

59 
T»eSurviv®
::
	$š™IÁ”Çl
() {

61 
num_d—ths
 = 
Ãw
 
size_t
[
num_tim•ošts
];

62 
num_§m¶es_©_risk
 = 
Ãw
 
size_t
[
num_tim•ošts
];

63 
	}
}

65 
	gT»eSurviv®
::
	$­³ndToFeIÁ”Çl
(
¡d
::
of¡»am
& 
fe
) {

68 
¡d
::
veùÜ
<
size_t
> 
‹rmš®_nodes
;

69 
¡d
::
veùÜ
<¡d::veùÜ<>> 
chf_veùÜ
;

70 
size_t
 
i
 = 0; i < 
chf
.
	`size
(); ++i) {

71 ià(!
chf
[
i
].
	`em±y
()) {

72 
‹rmš®_nodes
.
	`push_back
(
i
);

73 
chf_veùÜ
.
	`push_back
(
chf
[
i
]);

76 
	`§veVeùÜ1D
(
‹rmš®_nodes
, 
fe
);

77 
	`§veVeùÜ2D
(
chf_veùÜ
, 
fe
);

78 
	}
}

80 
	gT»eSurviv®
::
	$ü—‹Em±yNodeIÁ”Çl
() {

81 
chf
.
	`push_back
(
¡d
::
veùÜ
<>());

82 
	}
}

84 
	gT»eSurviv®
::
	$compu‹Surviv®
(
size_t
 
nodeID
) {

85 
¡d
::
veùÜ
<> 
chf_‹mp
;

86 
chf_‹mp
.
	`»£rve
(
num_tim•ošts
);

87 
chf_v®ue
 = 0;

88 
size_t
 
i
 = 0; i < 
num_tim•ošts
; ++i) {

89 ià(
num_§m¶es_©_risk
[
i
] != 0) {

90 
chf_v®ue
 +ğ(è
num_d—ths
[
i
] / (è
num_§m¶es_©_risk
[i];

92 
chf_‹mp
.
	`push_back
(
chf_v®ue
);

94 
chf
[
nodeID
] = 
chf_‹mp
;

95 
	}
}

97 
	gT»eSurviv®
::
	$compu‹P»diùiÚAccu¿cyIÁ”Çl
() {

100 
¡d
::
veùÜ
<> 
sum_chf
;

101 
size_t
 
i
 = 0; i < 
´ediùiÚ_‹rmš®_nodeIDs
.
	`size
(); ++i) {

102 
size_t
 
‹rmš®_nodeID
 = 
´ediùiÚ_‹rmš®_nodeIDs
[
i
];

103 
sum_chf
.
	`push_back
(
¡d
::
	`accumuÏ‹
(
chf
[
‹rmš®_nodeID
].
	`begš
(), chf[‹rmš®_nodeID].
	`’d
(), 0));

107  
	`compu‹CÚcÜdªûIndex
(
d©a
, 
sum_chf
, 
d•’d’t_v¬ID
, 
¡©us_v¬ID
, 
oob_§m¶eIDs
);

108 
	}
}

110 
boŞ
 
	gT»eSurviv®
::
¥l™NodeIÁ”Çl
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
) {

112 ià(
¥l™ruË
 =ğ
MAXSTAT
) {

113  
fšdBe¡S¶™Max¡©
(
nodeID
, 
possibË_¥l™_v¬IDs
);

115  
fšdBe¡S¶™
(
nodeID
, 
possibË_¥l™_v¬IDs
);

119 
boŞ
 
	gT»eSurviv®
::
fšdBe¡S¶™
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
) {

121 
be¡_deü—£
 = -1;

122 
size_t
 
	gnum_§m¶es_node
 = 
§m¶eIDs
[
nodeID
].
size
();

123 
size_t
 
	gbe¡_v¬ID
 = 0;

124 
	gbe¡_v®ue
 = 0;

126 
compu‹D—thCouÁs
(
nodeID
);

129 ià(
	gnum_§m¶es_node
 >ğ2 * 
mš_node_size
) {

132 auto& 
v¬ID
 : 
possibË_¥l™_v¬IDs
) {

135 ià((*
is_Üd”ed_v¬ŸbË
)[
v¬ID
]) {

136 ià(
¥l™ruË
 =ğ
LOGRANK
) {

137 
fšdBe¡S¶™V®ueLogRªk
(
nodeID
, 
v¬ID
, 
be¡_v®ue
, 
be¡_v¬ID
, 
be¡_deü—£
);

138 } ià(
	g¥l™ruË
 =ğ
AUC
 || 
¥l™ruË
 =ğ
AUC_IGNORE_TIES
) {

139 
fšdBe¡S¶™V®ueAUC
(
nodeID
, 
v¬ID
, 
be¡_v®ue
, 
be¡_v¬ID
, 
be¡_deü—£
);

142 
fšdBe¡S¶™V®ueLogRªkUnÜd”ed
(
nodeID
, 
v¬ID
, 
be¡_v®ue
, 
be¡_v¬ID
, 
be¡_deü—£
);

149 ià(
	gbe¡_deü—£
 < 0) {

150 
compu‹Surviv®
(
nodeID
);

151  
	gŒue
;

154 
	g¥l™_v¬IDs
[
nodeID
] = 
be¡_v¬ID
;

155 
	g¥l™_v®ues
[
nodeID
] = 
be¡_v®ue
;

156  
	gçl£
;

160 
boŞ
 
	gT»eSurviv®
::
fšdBe¡S¶™Max¡©
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
) {

162 
size_t
 
num_§m¶es_node
 = 
§m¶eIDs
[
nodeID
].
size
();

165 ià(
	gnum_§m¶es_node
 <ğ
mš_node_size
) {

166 
compu‹D—thCouÁs
(
nodeID
);

167 
compu‹Surviv®
(
nodeID
);

168  
	gŒue
;

172 
	g¡d
::
veùÜ
<> 
time
;

173 
	gtime
.
»£rve
(
num_§m¶es_node
);

174 
	g¡d
::
veùÜ
<> 
¡©us
;

175 
	g¡©us
.
»£rve
(
num_§m¶es_node
);

176 auto& 
	g§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

177 
time
.
push_back
(
d©a
->
g‘
(
§m¶eID
, 
d•’d’t_v¬ID
));

178 
	g¡©us
.
push_back
(
d©a
->
g‘
(
§m¶eID
, 
¡©us_v¬ID
));

180 
	g¡d
::
veùÜ
<> 
scÜes
 = 
log¿nkScÜes
(
time
, 
¡©us
);

184 
	g¡d
::
veùÜ
<> 
pv®ues
;

185 
	gpv®ues
.
»£rve
(
possibË_¥l™_v¬IDs
.
size
());

186 
	g¡d
::
veùÜ
<> 
v®ues
;

187 
	gv®ues
.
»£rve
(
possibË_¥l™_v¬IDs
.
size
());

188 
	g¡d
::
veùÜ
<> 
ÿndid©e_v¬IDs
;

189 
	gÿndid©e_v¬IDs
.
»£rve
(
possibË_¥l™_v¬IDs
.
size
());

192 auto& 
	gv¬ID
 : 
possibË_¥l™_v¬IDs
) {

195 
¡d
::
veùÜ
<> 
x
;

196 
	gx
.
»£rve
(
num_§m¶es_node
);

197 auto& 
	g§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

198 
x
.
push_back
(
d©a
->
g‘
(
§m¶eID
, 
v¬ID
));

202 
	g¡d
::
veùÜ
<
size_t
> 
šdiûs
 = 
Üd”
(
x
, 
çl£
);

206 
	gbe¡_max¡©
;

207 
	gbe¡_¥l™_v®ue
;

208 
max¡©
(
scÜes
, 
x
, 
šdiûs
, 
be¡_max¡©
, 
be¡_¥l™_v®ue
, 
mš´İ
, 1 - minprop);

211 ià(
	gbe¡_max¡©
 > -1) {

213 
	g¡d
::
veùÜ
<
size_t
> 
num_§m¶es_Ëá
 = 
numSam¶esLeáOfCuošt
(
x
, 
šdiûs
);

217 
	gpv®ue_Ïu92
 = 
max¡©PV®ueLau92
(
be¡_max¡©
, 
mš´İ
, 1 - minprop);

218 
	gpv®ue_Ïu94
 = 
max¡©PV®ueLau94
(
be¡_max¡©
, 
mš´İ
, 1 - mš´İ, 
num_§m¶es_node
, 
num_§m¶es_Ëá
);

221 
	gpv®ue
 = 
¡d
::
mš
(
pv®ue_Ïu92
, 
pv®ue_Ïu94
);

224 
	gpv®ues
.
push_back
(
pv®ue
);

225 
	gv®ues
.
push_back
(
be¡_¥l™_v®ue
);

226 
	gÿndid©e_v¬IDs
.
push_back
(
v¬ID
);

230 
	gadju¡ed_be¡_pv®ue
 = 
¡d
::
num”ic_lim™s
<>::
max
();

231 
size_t
 
	gbe¡_v¬ID
 = 0;

232 
	gbe¡_v®ue
 = 0;

234 ià(
	gpv®ues
.
size
() > 0) {

236 
	g¡d
::
veùÜ
<> 
adju¡ed_pv®ues
 = 
adju¡Pv®ues
(
pv®ues
);

238 
	gmš_pv®ue
 = 
¡d
::
num”ic_lim™s
<>::
max
();

239 
size_t
 
	gi
 = 0; i < 
	gpv®ues
.
size
(); ++i) {

240 ià(
	gpv®ues
[
i
] < 
	gmš_pv®ue
) {

241 
	gmš_pv®ue
 = 
pv®ues
[
i
];

242 
	gbe¡_v¬ID
 = 
ÿndid©e_v¬IDs
[
i
];

243 
	gbe¡_v®ue
 = 
v®ues
[
i
];

244 
	gadju¡ed_be¡_pv®ue
 = 
adju¡ed_pv®ues
[
i
];

250 ià(
	gadju¡ed_be¡_pv®ue
 > 
	g®pha
) {

251 
compu‹D—thCouÁs
(
nodeID
);

252 
compu‹Surviv®
(
nodeID
);

253  
	gŒue
;

256 
	g¥l™_v¬IDs
[
nodeID
] = 
be¡_v¬ID
;

257 
	g¥l™_v®ues
[
nodeID
] = 
be¡_v®ue
;

258  
	gçl£
;

262 
	gT»eSurviv®
::
	$compu‹D—thCouÁs
(
size_t
 
nodeID
) {

265 
size_t
 
i
 = 0; i < 
num_tim•ošts
; ++i) {

266 
num_d—ths
[
i
] = 0;

267 
num_§m¶es_©_risk
[
i
] = 0;

270 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

271 
surviv®_time
 = 
d©a
->
	`g‘
(
§m¶eID
, 
d•’d’t_v¬ID
);

273 
size_t
 
t
 = 0;

274 
t
 < 
num_tim•ošts
 && (*
unique_tim•ošts
)[t] < 
surviv®_time
) {

275 ++
num_§m¶es_©_risk
[
t
];

276 ++
t
;

280 ià(
t
 < 
num_tim•ošts
) {

281 ++
num_§m¶es_©_risk
[
t
];

282 ià(
d©a
->
	`g‘
(
§m¶eID
, 
¡©us_v¬ID
) == 1) {

283 ++
num_d—ths
[
t
];

287 
	}
}

289 
	gT»eSurviv®
::
compu‹ChdD—thCouÁs
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
¡d
::
veùÜ
<>& 
possibË_¥l™_v®ues
,

290 
size_t
* 
num_§m¶es_right_chd
, size_t* 
d–_§m¶es_©_risk_right_chd
, size_t* 
num_d—ths_right_chd
) {

291 
size_t
 
	gnum_¥l™s
 = 
possibË_¥l™_v®ues
.
size
();

294 auto& 
	g§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

295 
v®ue
 = 
d©a
->
g‘
(
§m¶eID
, 
v¬ID
);

296 
size_t
 
	gsurviv®_timeID
 = (*
»¥Ú£_tim•oštIDs
)[
§m¶eID
];

299 
size_t
 
	gi
 = 0; i < 
	gnum_¥l™s
; ++i) {

301 ià(
	gv®ue
 > 
	gpossibË_¥l™_v®ues
[
i
]) {

302 ++
	gnum_§m¶es_right_chd
[
i
];

303 ++
	gd–_§m¶es_©_risk_right_chd
[
i
 * 
num_tim•ošts
 + 
surviv®_timeID
];

304 ià(
	gd©a
->
g‘
(
§m¶eID
, 
¡©us_v¬ID
) == 1) {

305 ++
num_d—ths_right_chd
[
i
 * 
num_tim•ošts
 + 
surviv®_timeID
];

314 
	gT»eSurviv®
::
	$fšdBe¡S¶™V®ueLogRªk
(
size_t
 
nodeID
, size_ˆ
v¬ID
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
,

315 & 
be¡_log¿nk
) {

318 
¡d
::
veùÜ
<> 
possibË_¥l™_v®ues
;

319 
d©a
->
	`g‘AÎV®ues
(
possibË_¥l™_v®ues
, 
§m¶eIDs
[
nodeID
], 
v¬ID
);

322 ià(
possibË_¥l™_v®ues
.
	`size
() < 2) {

327 
possibË_¥l™_v®ues
.
	`pİ_back
();

329 
size_t
 
num_¥l™s
 = 
possibË_¥l™_v®ues
.
	`size
();

332 
size_t
* 
num_d—ths_right_chd
 = 
Ãw
 size_t[
num_¥l™s
 * 
num_tim•ošts
]();

333 
size_t
* 
d–_§m¶es_©_risk_right_chd
 = 
Ãw
 size_t[
num_¥l™s
 * 
num_tim•ošts
]();

334 
size_t
* 
num_§m¶es_right_chd
 = 
Ãw
 size_t[
num_¥l™s
]();

336 
	`compu‹ChdD—thCouÁs
(
nodeID
, 
v¬ID
, 
possibË_¥l™_v®ues
, 
num_§m¶es_right_chd
,

337 
d–_§m¶es_©_risk_right_chd
, 
num_d—ths_right_chd
);

340 
size_t
 
i
 = 0; i < 
num_¥l™s
; ++i) {

341 
num”©Ü
 = 0;

342 
d’omš©Ü_squ¬ed
 = 0;

345 
size_t
 
num_§m¶es_Ëá_chd
 = 
§m¶eIDs
[
nodeID
].
	`size
(è- 
num_§m¶es_right_chd
[
i
];

346 ià(
num_§m¶es_right_chd
[
i
] < 
mš_node_size
 || 
num_§m¶es_Ëá_chd
 < min_node_size) {

351 
size_t
 
num_§m¶es_©_risk_right_chd
 = 
num_§m¶es_right_chd
[
i
];

352 
size_t
 
t
 = 0; < 
num_tim•ošts
; ++t) {

353 ià(
num_§m¶es_©_risk
[
t
] < 2 || 
num_§m¶es_©_risk_right_chd
 < 1) {

357 ià(
num_d—ths
[
t
] > 0) {

359 
di
 = (è
num_d—ths
[
t
];

360 
di1
 = (è
num_d—ths_right_chd
[
i
 * 
num_tim•ošts
 + 
t
];

361 
Yi
 = (è
num_§m¶es_©_risk
[
t
];

362 
Yi1
 = (è
num_§m¶es_©_risk_right_chd
;

363 
num”©Ü
 +ğ
di1
 - 
Yi1
 * (
di
 / 
Yi
);

364 
d’omš©Ü_squ¬ed
 +ğ(
Yi1
 / 
Yi
è* (1.0 - Yi1 / Yiè* ((Y˜- 
di
) / (Yi - 1)) * di;

368 
num_§m¶es_©_risk_right_chd
 -ğ
d–_§m¶es_©_risk_right_chd
[
i
 * 
num_tim•ošts
 + 
t
];

371 
log¿nk
 = -1;

372 ià(
d’omš©Ü_squ¬ed
 != 0) {

373 
log¿nk
 = 
	`çbs
(
num”©Ü
 / 
	`sq¹
(
d’omš©Ü_squ¬ed
));

376 ià(
log¿nk
 > 
be¡_log¿nk
) {

377 
be¡_v®ue
 = 
possibË_¥l™_v®ues
[
i
];

378 
be¡_v¬ID
 = 
v¬ID
;

379 
be¡_log¿nk
 = 
log¿nk
;

383 
d–‘e
[] 
num_d—ths_right_chd
;

384 
d–‘e
[] 
d–_§m¶es_©_risk_right_chd
;

385 
d–‘e
[] 
num_§m¶es_right_chd
;

386 
	}
}

388 
	gT»eSurviv®
::
	$fšdBe¡S¶™V®ueLogRªkUnÜd”ed
(
size_t
 
nodeID
, size_ˆ
v¬ID
, & 
be¡_v®ue
,

389 
size_t
& 
be¡_v¬ID
, & 
be¡_log¿nk
) {

392 
¡d
::
veùÜ
<> 
çùÜ_Ëv–s
;

393 
d©a
->
	`g‘AÎV®ues
(
çùÜ_Ëv–s
, 
§m¶eIDs
[
nodeID
], 
v¬ID
);

396 ià(
çùÜ_Ëv–s
.
	`size
() < 2) {

401 
size_t
 
num_¥l™s
 = (1 << 
çùÜ_Ëv–s
.
	`size
());

406 
size_t
 
loÿl_¥l™ID
 = 1;†oÿl_¥l™ID < 
num_¥l™s
 / 2; ++local_splitID) {

409 
size_t
 
¥l™ID
 = 0;

410 
size_t
 
j
 = 0; j < 
çùÜ_Ëv–s
.
	`size
(); ++j) {

411 ià((
loÿl_¥l™ID
 & (1 << 
j
))) {

412 
Ëv–
 = 
çùÜ_Ëv–s
[
j
];

413 
size_t
 
çùÜID
 = 
	`æoÜ
(
Ëv–
) - 1;

414 
¥l™ID
 = s¶™ID | (1 << 
çùÜID
);

419 
size_t
* 
num_d—ths_right_chd
 = 
Ãw
 size_t[
num_tim•ošts
]();

420 
size_t
* 
d–_§m¶es_©_risk_right_chd
 = 
Ãw
 size_t[
num_tim•ošts
]();

421 
size_t
 
num_§m¶es_right_chd
 = 0;

422 
num”©Ü
 = 0;

423 
d’omš©Ü_squ¬ed
 = 0;

426 auto& 
§m¶eID
 : 
§m¶eIDs
[
nodeID
]) {

427 
size_t
 
surviv®_timeID
 = (*
»¥Ú£_tim•oštIDs
)[
§m¶eID
];

428 
v®ue
 = 
d©a
->
	`g‘
(
§m¶eID
, 
v¬ID
);

429 
size_t
 
çùÜID
 = 
	`æoÜ
(
v®ue
) - 1;

433 ià((
¥l™ID
 & (1 << 
çùÜID
))) {

434 ++
num_§m¶es_right_chd
;

435 ++
d–_§m¶es_©_risk_right_chd
[
surviv®_timeID
];

436 ià(
d©a
->
	`g‘
(
§m¶eID
, 
¡©us_v¬ID
) == 1) {

437 ++
num_d—ths_right_chd
[
surviv®_timeID
];

444 
size_t
 
num_§m¶es_Ëá_chd
 = 
§m¶eIDs
[
nodeID
].
	`size
(è- 
num_§m¶es_right_chd
;

445 ià(
num_§m¶es_right_chd
 < 
mš_node_size
 || 
num_§m¶es_Ëá_chd
 < min_node_size) {

446 
d–‘e
[] 
num_d—ths_right_chd
;

447 
d–‘e
[] 
d–_§m¶es_©_risk_right_chd
;

452 
size_t
 
num_§m¶es_©_risk_right_chd
 = 
num_§m¶es_right_chd
;

453 
size_t
 
t
 = 0; < 
num_tim•ošts
; ++t) {

454 ià(
num_§m¶es_©_risk
[
t
] < 2 || 
num_§m¶es_©_risk_right_chd
 < 1) {

458 ià(
num_d—ths
[
t
] > 0) {

460 
di
 = (è
num_d—ths
[
t
];

461 
di1
 = (è
num_d—ths_right_chd
[
t
];

462 
Yi
 = (è
num_§m¶es_©_risk
[
t
];

463 
Yi1
 = (è
num_§m¶es_©_risk_right_chd
;

464 
num”©Ü
 +ğ
di1
 - 
Yi1
 * (
di
 / 
Yi
);

465 
d’omš©Ü_squ¬ed
 +ğ(
Yi1
 / 
Yi
è* (1.0 - Yi1 / Yiè* ((Y˜- 
di
) / (Yi - 1)) * di;

469 
num_§m¶es_©_risk_right_chd
 -ğ
d–_§m¶es_©_risk_right_chd
[
t
];

471 
log¿nk
 = -1;

472 ià(
d’omš©Ü_squ¬ed
 != 0) {

473 
log¿nk
 = 
	`çbs
(
num”©Ü
 / 
	`sq¹
(
d’omš©Ü_squ¬ed
));

476 ià(
log¿nk
 > 
be¡_log¿nk
) {

477 
be¡_v®ue
 = 
¥l™ID
;

478 
be¡_v¬ID
 = 
v¬ID
;

479 
be¡_log¿nk
 = 
log¿nk
;

482 
d–‘e
[] 
num_d—ths_right_chd
;

483 
d–‘e
[] 
d–_§m¶es_©_risk_right_chd
;

486 
	}
}

488 
	gT»eSurviv®
::
	$fšdBe¡S¶™V®ueAUC
(
size_t
 
nodeID
, size_ˆ
v¬ID
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
,

489 & 
be¡_auc
) {

492 
¡d
::
veùÜ
<> 
possibË_¥l™_v®ues
;

493 
d©a
->
	`g‘AÎV®ues
(
possibË_¥l™_v®ues
, 
§m¶eIDs
[
nodeID
], 
v¬ID
);

496 ià(
possibË_¥l™_v®ues
.
	`size
() < 2) {

501 
possibË_¥l™_v®ues
.
	`pİ_back
();

503 
size_t
 
num_node_§m¶es
 = 
§m¶eIDs
[
nodeID
].
	`size
();

504 
size_t
 
num_¥l™s
 = 
possibË_¥l™_v®ues
.
	`size
();

505 
size_t
 
num_possibË_·œs
 = 
num_node_§m¶es
 * (num_node_samples - 1) / 2;

508 * 
num_couÁ
 = 
Ãw
 [
num_¥l™s
];

509 * 
num_tÙ®
 = 
Ãw
 [
num_¥l™s
];

510 
size_t
* 
num_§m¶es_Ëá_chd
 = 
Ãw
 size_t[
num_¥l™s
];

511 
size_t
 
i
 = 0; i < 
num_¥l™s
; ++i) {

512 
num_couÁ
[
i
] = 
num_possibË_·œs
;

513 
num_tÙ®
[
i
] = 
num_possibË_·œs
;

514 
num_§m¶es_Ëá_chd
[
i
] = 0;

518 
size_t
 
k
 = 0; k < 
num_node_§m¶es
; ++k) {

519 
size_t
 
§m¶e_k
 = 
§m¶eIDs
[
nodeID
][
k
];

520 
time_k
 = 
d©a
->
	`g‘
(
§m¶e_k
, 
d•’d’t_v¬ID
);

521 
¡©us_k
 = 
d©a
->
	`g‘
(
§m¶e_k
, 
¡©us_v¬ID
);

522 
v®ue_k
 = 
d©a
->
	`g‘
(
§m¶e_k
, 
v¬ID
);

525 
size_t
 
i
 = 0; i < 
num_¥l™s
; ++i) {

526 
¥l™_v®ue
 = 
possibË_¥l™_v®ues
[
i
];

527 ià(
v®ue_k
 <ğ
¥l™_v®ue
) {

528 ++
num_§m¶es_Ëá_chd
[
i
];

532 
size_t
 
l
 = 
k
 + 1;† < 
num_node_§m¶es
; ++l) {

533 
size_t
 
§m¶e_l
 = 
§m¶eIDs
[
nodeID
][
l
];

534 
time_l
 = 
d©a
->
	`g‘
(
§m¶e_l
, 
d•’d’t_v¬ID
);

535 
¡©us_l
 = 
d©a
->
	`g‘
(
§m¶e_l
, 
¡©us_v¬ID
);

536 
v®ue_l
 = 
d©a
->
	`g‘
(
§m¶e_l
, 
v¬ID
);

539 
	`compu‹AucS¶™
(
time_k
, 
time_l
, 
¡©us_k
, 
¡©us_l
, 
v®ue_k
, 
v®ue_l
, 
num_¥l™s
, 
possibË_¥l™_v®ues
,

540 
num_couÁ
, 
num_tÙ®
);

544 
size_t
 
i
 = 0; i < 
num_¥l™s
; ++i) {

546 
size_t
 
num_§m¶es_right_chd
 = 
num_node_§m¶es
 - 
num_§m¶es_Ëá_chd
[
i
];

547 ià(
num_§m¶es_Ëá_chd
[
i
] < 
mš_node_size
 || 
num_§m¶es_right_chd
 < min_node_size) {

550 
auc
 = 
	`çbs
((
num_couÁ
[
i
] / 2è/ 
num_tÙ®
[i] - 0.5);

551 ià(
auc
 > 
be¡_auc
) {

552 
be¡_v®ue
 = 
possibË_¥l™_v®ues
[
i
];

553 
be¡_v¬ID
 = 
v¬ID
;

554 
be¡_auc
 = 
auc
;

560 
d–‘e
[] 
num_couÁ
;

561 
d–‘e
[] 
num_tÙ®
;

562 
d–‘e
[] 
num_§m¶es_Ëá_chd
;

563 
	}
}

565 
	gT»eSurviv®
::
compu‹AucS¶™
(
time_k
, 
time_l
, 
¡©us_k
, 
¡©us_l
, 
v®ue_k
,

566 
v®ue_l
, 
size_t
 
num_¥l™s
, 
¡d
::
veùÜ
<>& 
possibË_¥l™_v®ues
, * 
num_couÁ
,

567 * 
num_tÙ®
) {

569 
boŞ
 
	gignÜe_·œ
 = 
çl£
;

570 
boŞ
 
	gdo_nÙhšg
 = 
çl£
;

572 
	gv®ue_sm®Ër
 = 0;

573 
	gv®ue_Ïrg”
 = 0;

574 
	g¡©us_sm®Ër
 = 0;

576 ià(
	gtime_k
 < 
	gtime_l
) {

577 
	gv®ue_sm®Ër
 = 
v®ue_k
;

578 
	gv®ue_Ïrg”
 = 
v®ue_l
;

579 
	g¡©us_sm®Ër
 = 
¡©us_k
;

580 } ià(
	gtime_l
 < 
	gtime_k
) {

581 
	gv®ue_sm®Ër
 = 
v®ue_l
;

582 
	gv®ue_Ïrg”
 = 
v®ue_k
;

583 
	g¡©us_sm®Ër
 = 
¡©us_l
;

586 ià(
	g¡©us_k
 =ğ0 || 
¡©us_l
 == 0) {

587 
ignÜe_·œ
 = 
Œue
;

589 ià(
	g¥l™ruË
 =ğ
AUC_IGNORE_TIES
) {

590 
ignÜe_·œ
 = 
Œue
;

592 ià(
	gv®ue_k
 =ğ
v®ue_l
) {

594 
ignÜe_·œ
 = 
Œue
;

597 
	gdo_nÙhšg
 = 
Œue
;

604 ià(
	g¡©us_sm®Ër
 == 0) {

605 
ignÜe_·œ
 = 
Œue
;

608 ià(
	gignÜe_·œ
) {

609 
size_t
 
	gi
 = 0; i < 
	gnum_¥l™s
; ++i) {

610 --
	gnum_couÁ
[
i
];

611 --
	gnum_tÙ®
[
i
];

613 } ià(
	gdo_nÙhšg
) {

616 
size_t
 
	gi
 = 0; i < 
	gnum_¥l™s
; ++i) {

617 
	g¥l™_v®ue
 = 
possibË_¥l™_v®ues
[
i
];

619 ià(
	gv®ue_sm®Ër
 <ğ
¥l™_v®ue
 && 
v®ue_Ïrg”
 > split_value) {

620 ++
num_couÁ
[
i
];

621 } ià(
	gv®ue_sm®Ër
 > 
	g¥l™_v®ue
 && 
	gv®ue_Ïrg”
 <ğ
¥l™_v®ue
) {

622 --
num_couÁ
[
i
];

623 } ià(
	gv®ue_sm®Ër
 <ğ
¥l™_v®ue
 && 
v®ue_Ïrg”
 <= split_value) {

	@Tree/TreeSurvival.h

29 #iâdeà
TREESURVIVAL_H_


30 
	#TREESURVIVAL_H_


	)

32 
	~"glob®s.h
"

33 
	~"T»e.h
"

35 şas 
	cT»eSurviv®
: 
public
 
T»e
 {

36 
public
:

37 
T»eSurviv®
(
¡d
::
veùÜ
<>* 
unique_tim•ošts
, 
size_t
 
¡©us_v¬ID
, std::veùÜ<size_t>* 
»¥Ú£_tim•oštIDs
);

40 
T»eSurviv®
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>& 
chd_nodeIDs
, std::veùÜ<size_t>& 
¥l™_v¬IDs
,

41 
¡d
::
veùÜ
<>& 
¥l™_v®ues
, std::veùÜ<¡d::veùÜ<>> 
chf
, std::veùÜ<>* 
unique_tim•ošts
,

42 
¡d
::
veùÜ
<
size_t
>* 
»¥Ú£_tim•oštIDs
, std::veùÜ<
boŞ
>* 
is_Üd”ed_v¬ŸbË
);

44 
	mvœtu®
 ~
T»eSurviv®
();

46 
š™IÁ”Çl
();

48 
­³ndToFeIÁ”Çl
(
¡d
::
of¡»am
& 
fe
);

49 
compu‹P”mutiÚImpÜnûIÁ”Çl
(
¡d
::
veùÜ
<¡d::veùÜ<
size_t
>>* 
³rmutiÚs
);

51 cÚ¡ 
	m¡d
::
veùÜ
<
¡d
::veùÜ<> >& 
	$g‘Chf
() const {

52  
chf
;

55 cÚ¡ 
¡d
::
veùÜ
<>& 
	$g‘P»diùiÚ
(
size_t
 
§m¶eID
) const {

56 
size_t
 
‹rmš®_nodeID
 = 
´ediùiÚ_‹rmš®_nodeIDs
[
§m¶eID
];

57  (
chf
[
‹rmš®_nodeID
]);

58 
	}
}

60 
	g´iv©e
:

62 
ü—‹Em±yNodeIÁ”Çl
();

63 
compu‹Surviv®
(
size_t
 
nodeID
);

64 
compu‹P»diùiÚAccu¿cyIÁ”Çl
();

66 
boŞ
 
¥l™NodeIÁ”Çl
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
);

68 
boŞ
 
fšdBe¡S¶™
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
);

69 
boŞ
 
fšdBe¡S¶™Max¡©
(
size_t
 
nodeID
, 
¡d
::
veùÜ
<size_t>& 
possibË_¥l™_v¬IDs
);

71 
fšdBe¡S¶™V®ueLogRªk
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
¡d
::
veùÜ
<>& 
possibË_¥l™_v®ues
,

72 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_log¿nk
);

73 
fšdBe¡S¶™V®ueLogRªkUnÜd”ed
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
¡d
::
veùÜ
<>& 
çùÜ_Ëv–s
,

74 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_log¿nk
);

75 
fšdBe¡S¶™V®ueAUC
(
size_t
 
nodeID
, size_ˆ
v¬ID
,

76 & 
be¡_v®ue
, 
size_t
& 
be¡_v¬ID
, & 
be¡_auc
);

78 
compu‹D—thCouÁs
(
size_t
 
nodeID
);

79 
compu‹ChdD—thCouÁs
(
size_t
 
nodeID
, size_ˆ
v¬ID
, 
¡d
::
veùÜ
<>& 
possibË_¥l™_v®ues
,

80 
size_t
* 
num_§m¶es_right_chd
, size_t* 
num_§m¶es_©_risk_right_chd
, size_t* 
num_d—ths_right_chd
);

82 
compu‹AucS¶™
(
time_k
, 
time_l
, 
¡©us_k
, 
¡©us_l
, 
v®ue_k
, 
v®ue_l
,

83 
size_t
 
num_¥l™s
, 
¡d
::
veùÜ
<>& 
possibË_¥l™_v®ues
, * 
num_couÁ
, * 
num_tÙ®
);

85 
fšdBe¡S¶™V®ueLogRªk
(
size_t
 
nodeID
, size_ˆ
v¬ID
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
,

86 & 
be¡_log¿nk
);

87 
fšdBe¡S¶™V®ueLogRªkUnÜd”ed
(
size_t
 
nodeID
, size_ˆ
v¬ID
, & 
be¡_v®ue
, size_t& 
be¡_v¬ID
,

88 & 
be¡_log¿nk
);

90 
	$ş—nUpIÁ”Çl
() {

91 
d–‘e
[] 
num_d—ths
;

92 
d–‘e
[] 
num_§m¶es_©_risk
;

93 
	}
}

95 
size_t
 
	g¡©us_v¬ID
;

98 
	g¡d
::
veùÜ
<>* 
unique_tim•ošts
;

99 
size_t
 
	gnum_tim•ošts
;

100 
	g¡d
::
veùÜ
<
size_t
>* 
»¥Ú£_tim•oštIDs
;

103 
	g¡d
::
veùÜ
<
¡d
::veùÜ<>> 
chf
;

106 
size_t
* 
	gnum_d—ths
;

107 
size_t
* 
	gnum_§m¶es_©_risk
;

109 
DISALLOW_COPY_AND_ASSIGN
(
T»eSurviv®
);

	@globals.h

29 #iâdeà
GLOBALS_H_


30 
	#GLOBALS_H_


	)

32 
	#DISALLOW_COPY_AND_ASSIGN
(
Ty³Name
) \

33 
	`Ty³Name
(cÚ¡ 
Ty³Name
&); \

34 
İ”©Ü
=(cÚ¡ 
Ty³Name
&)

	)

37 #iâdeà
M_PI


38 
	#M_PI
 3.14159265358979323846

	)

42 #ifdeà
WIN_R_BUILD


43 #ià
__ılu¥lus
 < 201103L

44 
	#OLD_WIN_R_BUILD


	)

46 
	#NEW_WIN_R_BUILD


	)

50 
	tušt
;

53 
	eT»eTy³
 {

54 
	mTREE_CLASSIFICATION
 = 1,

55 
	mTREE_REGRESSION
 = 3,

56 
	mTREE_SURVIVAL
 = 5,

57 
	mTREE_PROBABILITY
 = 9

61 
	eMemÜyMode
 {

62 
	mMEM_DOUBLE
 = 0,

63 
	mMEM_FLOAT
 = 1,

64 
	mMEM_CHAR
 = 2

66 cÚ¡ 
ušt
 
	gMAX_MEM_MODE
 = 2;

69 cÚ¡ 
	gmask
[4] = {192,48,12,3};

70 cÚ¡ 
	goff£t
[4] = {6,4,2,0};

73 
	eImpÜnûMode
 {

74 
	mIMP_NONE
 = 0,

75 
	mIMP_GINI
 = 1,

76 
	mIMP_PERM_BREIMAN
 = 2,

77 
	mIMP_PERM_LIAW
 = 4,

78 
	mIMP_PERM_RAW
 = 3

80 cÚ¡ 
ušt
 
	gMAX_IMP_MODE
 = 4;

83 
	eS¶™RuË
 {

84 
	mLOGRANK
 = 1,

85 
	mAUC
 = 2,

86 
	mAUC_IGNORE_TIES
 = 3,

87 
	mMAXSTAT
 = 4

91 cÚ¡ 
ušt
 
	gDEFAULT_NUM_TREE
 = 500;

92 cÚ¡ 
ušt
 
	gDEFAULT_NUM_THREADS
 = 0;

93 cÚ¡ 
ImpÜnûMode
 
	gDEFAULT_IMPORTANCE_MODE
 = 
IMP_NONE
;

95 cÚ¡ 
ušt
 
	gDEFAULT_MIN_NODE_SIZE_CLASSIFICATION
 = 1;

96 cÚ¡ 
ušt
 
	gDEFAULT_MIN_NODE_SIZE_REGRESSION
 = 5;

97 cÚ¡ 
ušt
 
	gDEFAULT_MIN_NODE_SIZE_SURVIVAL
 = 3;

98 cÚ¡ 
ušt
 
	gDEFAULT_MIN_NODE_SIZE_PROBABILITY
 = 10;

100 cÚ¡ 
S¶™RuË
 
	gDEFAULT_SPLITRULE
 = 
LOGRANK
;

101 cÚ¡ 
	gDEFAULT_ALPHA
 = 0.5;

102 cÚ¡ 
	gDEFAULT_MINPROP
 = 0.1;

105 cÚ¡ 
	gSTATUS_INTERVAL
 = 30.0;

108 cÚ¡ 
	gQ_THRESHOLD
 = 0.02;

	@main.cpp

29 
	~<io¡»am
>

30 
	~<f¡»am
>

31 
	~<¡dexû±
>

32 
	~<¡ršg
>

34 
	~"glob®s.h
"

35 
	~"Argum’tHªdËr.h
"

36 
	~"FÜe¡CÏssifiÿtiÚ.h
"

37 
	~"FÜe¡Reg»ssiÚ.h
"

38 
	~"FÜe¡Surviv®.h
"

39 
	~"FÜe¡Probab™y.h
"

41 
	$maš
(
¬gc
, **
¬gv
) {

43 
Argum’tHªdËr
 
	`¬g_hªdËr
(
¬gc
, 
¬gv
);

44 
FÜe¡
* 
fÜe¡
 = 0;

45 
Œy
 {

48 ià(
¬g_hªdËr
.
	`´oûssArgum’ts
() != 0) {

51 
¬g_hªdËr
.
	`checkArgum’ts
();

54 
¬g_hªdËr
.
Œ“ty³
) {

55 
TREE_CLASSIFICATION
:

56 ià(
¬g_hªdËr
.
´obab™y
) {

57 
fÜe¡
 = 
Ãw
 
FÜe¡Probab™y
;

59 
fÜe¡
 = 
Ãw
 
FÜe¡CÏssifiÿtiÚ
;

62 
TREE_REGRESSION
:

63 
fÜe¡
 = 
Ãw
 
FÜe¡Reg»ssiÚ
;

65 
TREE_SURVIVAL
:

66 
fÜe¡
 = 
Ãw
 
FÜe¡Surviv®
;

68 
TREE_PROBABILITY
:

69 
fÜe¡
 = 
Ãw
 
FÜe¡Probab™y
;

74 
¡d
::
o¡»am
* 
v”bo£_out
;

75 ià(
¬g_hªdËr
.
v”bo£
) {

76 
v”bo£_out
 = &
¡d
::
cout
;

78 
¡d
::
of¡»am
* 
logfe
 = 
Ãw
 std::
	`of¡»am
();

79 
logfe
->
	`İ’
(
¬g_hªdËr
.
ou»fix
 + ".log");

80 ià(!
logfe
->
	`good
()) {

81 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚ot writeo†ogfile.");

83 
v”bo£_out
 = 
logfe
;

87 *
v”bo£_out
 << "S¹šg Rªg”." << 
¡d
::
’dl
;

88 
fÜe¡
->
	`š™Cµ
(
¬g_hªdËr
.
d•v¬Çme
,‡rg_hªdËr.
memmode
,‡rg_hªdËr.
fe
,‡rg_hªdËr.
mŒy
,

89 
¬g_hªdËr
.
ou»fix
,‡rg_hªdËr.
Á»e
, 
v”bo£_out
,‡rg_hªdËr.
£ed
,‡rg_hªdËr.
Áh»ads
,

90 
¬g_hªdËr
.
´ediù
,‡rg_hªdËr.
impm—su»
,‡rg_hªdËr.
rg‘·¹™iÚsize
,‡rg_hªdËr.
¥l™weights
,

91 
¬g_hªdËr
.
®ways¥l™v¬s
,‡rg_hªdËr.
¡©usv¬Çme
,‡rg_hªdËr.
»¶aû
,‡rg_hªdËr.
ÿtv¬s
,

92 
¬g_hªdËr
.
§vemem
,‡rg_hªdËr.
¥l™ruË
,‡rg_hªdËr.
ÿ£weights
,‡rg_hªdËr.
´ed®l
,‡rg_hªdËr.
äaùiÚ
,

93 
¬g_hªdËr
.
®pha
,‡rg_hªdËr.
mš´İ
,‡rg_hªdËr.
hŞdout
);

95 
fÜe¡
->
	`run
(
Œue
);

96 ià(
¬g_hªdËr
.
wr™e
) {

97 
fÜe¡
->
	`§veToFe
();

99 
fÜe¡
->
	`wr™eOuut
();

100 *
v”bo£_out
 << "Fšished Rªg”." << 
¡d
::
’dl
;

102 
d–‘e
 
fÜe¡
;

103 } 
	`ÿtch
 (
¡d
::
exû±iÚ
& 
e
) {

104 
¡d
::
û¼
 << "E¼Ü: " << 
e
.
	`wh©
(è<< " Rªg” wÈEXIT‚ow." << std::
’dl
;

105 
d–‘e
 
fÜe¡
;

110 
	}
}

	@utility/ArgumentHandler.cpp

29 
	~<f¡»am
>

30 
	~<io¡»am
>

31 
	~<¡dexû±
>

33 
	~"Argum’tHªdËr.h
"

34 
	~"v”siÚ.h
"

35 
	~"ut™y.h
"

37 
	gArgum’tHªdËr
::
	$Argum’tHªdËr
(
¬gc
, **
¬gv
) :

38 
	`ÿ£weights
(""), 
	`d•v¬Çme
(""), 
	`äaùiÚ
(1), 
	`hŞdout
(
çl£
), 
	`memmode
(
MEM_DOUBLE
), 
	`§vemem
(çl£), 
	`´ediù
(""), 
	`¥l™weights
(

39 ""), 
	`Áh»ads
(
DEFAULT_NUM_THREADS
), 
	`´ed®l
(
çl£
), 
	`®pha
(
DEFAULT_ALPHA
), 
	`mš´İ
(
DEFAULT_MINPROP
), 
	`fe
(""), 
	`impm—su»
(

40 
DEFAULT_IMPORTANCE_MODE
), 
	`rg‘·¹™iÚsize
(0), 
	`mŒy
(0), 
	`ou»fix
("¿ng”_out"), 
	`´obab™y
(
çl£
), 
	`¥l™ruË
(

41 
DEFAULT_SPLITRULE
), 
	`¡©usv¬Çme
(""), 
	`Á»e
(
DEFAULT_NUM_TREE
), 
	`»¶aû
(
Œue
), 
	`v”bo£
(
çl£
), 
	`wr™e
(çl£), 
	`Œ“ty³
(

42 
TREE_CLASSIFICATION
), 
	$£ed
(0) {

43 
this
->
¬gc
 =‡rgc;

44 
this
->
¬gv
 =‡rgv;

45 
	}
}

47 
	gArgum’tHªdËr
::~
	$Argum’tHªdËr
() {

48 
	}
}

50 
Argum’tHªdËr
::
	$´oûssArgum’ts
() {

53 cÚ¡ *
shÜt_İtiÚs
 = "A:C:D:F:HM:NP:S:U:XZa:b:c:f:hil::m:o:pr:s:t:uvwy:z:";

56 cÚ¡ 
İtiÚ
 
lÚg_İtiÚs
[] = {

58 { "®ways¥l™v¬s", 
»quœed_¬gum’t
, 0, 'A'},

59 { "ÿ£weights", 
»quœed_¬gum’t
, 0, 'C'},

60 { "d•v¬Çme", 
»quœed_¬gum’t
, 0, 'D'},

61 { "äaùiÚ", 
»quœed_¬gum’t
, 0, 'F'},

62 { "hŞdout", 
no_¬gum’t
, 0, 'H'},

63 { "memmode", 
»quœed_¬gum’t
, 0, 'M'},

64 { "§vemem", 
no_¬gum’t
, 0, 'N'},

65 { "´ediù", 
»quœed_¬gum’t
, 0, 'P'},

66 { "¥l™weights", 
»quœed_¬gum’t
, 0, 'S'},

67 { "Áh»ads", 
»quœed_¬gum’t
, 0, 'U'},

68 { "´ed®l", 
no_¬gum’t
, 0, 'X'},

69 { "v”siÚ", 
no_¬gum’t
, 0, 'Z'},

71 { "®pha", 
»quœed_¬gum’t
, 0, 'a'},

72 { "mš´İ", 
»quœed_¬gum’t
, 0, 'b'},

73 { "ÿtv¬s", 
»quœed_¬gum’t
, 0, 'c'},

74 { "fe", 
»quœed_¬gum’t
, 0, 'f'},

75 { "h–p", 
no_¬gum’t
, 0, 'h'},

76 { "impm—su»", 
»quœed_¬gum’t
, 0, 'i'},

77 { "rg‘·¹™iÚsize", 
»quœed_¬gum’t
, 0, 'l'},

78 { "mŒy", 
»quœed_¬gum’t
, 0, 'm'},

79 { "ou»fix", 
»quœed_¬gum’t
, 0, 'o'},

80 { "´obab™y", 
no_¬gum’t
, 0, 'p'},

81 { "¥l™ruË", 
»quœed_¬gum’t
, 0, 'r'},

82 { "¡©usv¬Çme", 
»quœed_¬gum’t
, 0, 's'},

83 { "Á»e", 
»quœed_¬gum’t
, 0, 't'},

84 { "nÜ•Ïû", 
no_¬gum’t
, 0, 'u'},

85 { "v”bo£", 
no_¬gum’t
, 0, 'v'},

86 { "wr™e", 
no_¬gum’t
, 0, 'w'},

87 { "Œ“ty³", 
»quœed_¬gum’t
, 0, 'y'},

88 { "£ed", 
»quœed_¬gum’t
, 0, 'z'},

94 
İtiÚ_šdex
 = 0;

95 
c
 = 
	`g‘İt_lÚg
(
¬gc
, 
¬gv
, 
shÜt_İtiÚs
, 
lÚg_İtiÚs
, &
İtiÚ_šdex
);

98 ià(
c
 == -1) {

102 
c
) {

106 
	`¥l™SŒšg
(
®ways¥l™v¬s
, 
İrg
, ',');

110 
ÿ£weights
 = 
İrg
;

114 
d•v¬Çme
 = 
İrg
;

118 
Œy
 {

119 
äaùiÚ
 = 
¡d
::
	`¡od
(
İrg
);

120 ià(
äaùiÚ
 > 1 || fraction <= 0) {

121 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

123 } 
	`ÿtch
 (...) {

124 
throw
 
¡d
::
	`ruÁime_”rÜ
(

130 
hŞdout
 = 
Œue
;

134 
Œy
 {

135 
memmode
 = (
MemÜyMode
è
¡d
::
	`¡oi
(
İrg
);

136 ià(
memmode
 > 
MAX_MEM_MODE
) {

137 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

139 } 
	`ÿtch
 (...) {

140 
throw
 
¡d
::
	`ruÁime_”rÜ
(

146 
§vemem
 = 
Œue
;

150 
´ediù
 = 
İrg
;

154 
¥l™weights
 = 
İrg
;

158 
Œy
 {

159 
‹mp
 = 
¡d
::
	`¡oi
(
İrg
);

160 ià(
‹mp
 < 1) {

161 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

163 
Áh»ads
 = 
‹mp
;

165 } 
	`ÿtch
 (...) {

166 
throw
 
¡d
::
	`ruÁime_”rÜ
(

172 
´ed®l
 = 
Œue
;

176 
	`di¥ÏyV”siÚ
();

182 
Œy
 {

183 
‹mp
 = 
¡d
::
	`¡od
(
İrg
);

184 ià(
‹mp
 < 0 ||emp > 1) {

185 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

187 
®pha
 = 
‹mp
;

189 } 
	`ÿtch
 (...) {

190 
throw
 
¡d
::
	`ruÁime_”rÜ
(

196 
Œy
 {

197 
‹mp
 = 
¡d
::
	`¡od
(
İrg
);

198 ià(
‹mp
 < 0 ||emp > 0.5) {

199 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

201 
mš´İ
 = 
‹mp
;

203 } 
	`ÿtch
 (...) {

204 
throw
 
¡d
::
	`ruÁime_”rÜ
(

210 
	`¥l™SŒšg
(
ÿtv¬s
, 
İrg
, ',');

214 
fe
 = 
İrg
;

218 
	`di¥ÏyH–p
();

223 
Œy
 {

224 
impm—su»
 = (
ImpÜnûMode
è
¡d
::
	`¡oi
(
İrg
);

225 ià(
impm—su»
 > 
MAX_IMP_MODE
) {

226 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

228 } 
	`ÿtch
 (...) {

229 
throw
 
¡d
::
	`ruÁime_”rÜ
(

235 
Œy
 {

236 
‹mp
 = 
¡d
::
	`¡oi
(
İrg
);

237 ià(
‹mp
 < 1) {

238 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

240 
rg‘·¹™iÚsize
 = 
‹mp
;

242 } 
	`ÿtch
 (...) {

243 
throw
 
¡d
::
	`ruÁime_”rÜ
(

249 
Œy
 {

250 
‹mp
 = 
¡d
::
	`¡oi
(
İrg
);

251 ià(
‹mp
 < 1) {

252 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

254 
mŒy
 = 
‹mp
;

256 } 
	`ÿtch
 (...) {

257 
throw
 
¡d
::
	`ruÁime_”rÜ
(

263 
ou»fix
 = 
İrg
;

267 
´obab™y
 = 
Œue
;

271 
Œy
 {

272 
¡d
::
	`¡oi
(
İrg
)) {

274 
¥l™ruË
 = 
LOGRANK
;

277 
¥l™ruË
 = 
AUC
;

280 
¥l™ruË
 = 
AUC_IGNORE_TIES
;

283 
¥l™ruË
 = 
MAXSTAT
;

286 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

289 } 
	`ÿtch
 (...) {

290 
throw
 
¡d
::
	`ruÁime_”rÜ
("Illegal splitrule selected. See '--help' for details.");

295 
¡©usv¬Çme
 = 
İrg
;

299 
Œy
 {

300 
‹mp
 = 
¡d
::
	`¡oi
(
İrg
);

301 ià(
‹mp
 < 1) {

302 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

304 
Á»e
 = 
‹mp
;

306 } 
	`ÿtch
 (...) {

307 
throw
 
¡d
::
	`ruÁime_”rÜ
(

313 
»¶aû
 = 
çl£
;

317 
v”bo£
 = 
Œue
;

321 
wr™e
 = 
Œue
;

325 
Œy
 {

326 
¡d
::
	`¡oi
(
İrg
)) {

328 
Œ“ty³
 = 
TREE_CLASSIFICATION
;

331 
Œ“ty³
 = 
TREE_REGRESSION
;

334 
Œ“ty³
 = 
TREE_SURVIVAL
;

337 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

340 } 
	`ÿtch
 (...) {

341 
throw
 
¡d
::
	`ruÁime_”rÜ
(

347 
Œy
 {

348 
‹mp
 = 
¡d
::
	`¡oi
(
İrg
);

349 ià(
‹mp
 < 0) {

350 
throw
 
¡d
::
	`ruÁime_”rÜ
("");

352 
£ed
 = 
‹mp
;

354 } 
	`ÿtch
 (...) {

355 
throw
 
¡d
::
	`ruÁime_”rÜ
(

367 
İtšd
 < 
¬gc
) {

368 
¡d
::
cout
 << "Oth”…¬am‘”,‚Ù…roûs£d: " << 
¬gv
[
İtšd
++] << std::
’dl
;

372 
	}
}

374 
	gArgum’tHªdËr
::
	$checkArgum’ts
() {

377 ià(
fe
.
	`em±y
()) {

378 
throw
 
¡d
::
	`ruÁime_”rÜ
("Please specify‡n input filename with '--file'. See '--help' for details.");

380 ià(
´ediù
.
	`em±y
(è&& 
d•v¬Çme
.empty()) {

381 
throw
 
¡d
::
	`ruÁime_”rÜ
("Please specify‡ dependent variable‚ame with '--depvarname'. See '--help' for details.");

384 ià(
Œ“ty³
 =ğ
TREE_SURVIVAL
 && 
¡©usv¬Çme
.
	`em±y
()) {

385 
throw
 
¡d
::
	`ruÁime_”rÜ
("Please specify‡ status variable‚ame with '--statusvarname'. See '--help' for details.");

387 ià(
Œ“ty³
 !ğ
TREE_SURVIVAL
 && !
¡©usv¬Çme
.
	`em±y
()) {

388 
throw
 
¡d
::
	`ruÁime_”rÜ
("Option '--statusvarname' only‡pplicable for survival forest. See '--help' for details.");

391 ià(
Œ“ty³
 =ğ
TREE_SURVIVAL
 && 
impm—su»
 =ğ
IMP_GINI
) {

392 
throw
 
¡d
::
	`ruÁime_”rÜ
(

396 ià(
Œ“ty³
 !ğ
TREE_CLASSIFICATION
 && 
´obab™y
) {

397 
throw
 
¡d
::
	`ruÁime_”rÜ
("Probabilityƒstimation is only‡pplicableo classification forests.");

401 ià(!
´ediù
.
	`em±y
()) {

402 
¡d
::
if¡»am
 
šfe
;

403 
šfe
.
	`İ’
(
´ediù
, 
¡d
::
ios
::
bš¬y
);

404 ià(!
šfe
.
	`good
()) {

405 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚Ù„—d from iÅuˆfe: " + 
´ediù
 + ".");

409 
šfe
.
	`£ekg
(2 * (
size_t
));

410 
size_t
 
Ëngth
;

411 
šfe
.
	`»ad
((*è&
Ëngth
, (length));

412 
šfe
.
	`£ekg
(4 * (
size_t
è+ 
Ëngth
 * (
boŞ
));

415 
šfe
.
	`»ad
((*è&
Œ“ty³
, (treetype));

416 
šfe
.
	`şo£
();

420 ià(
´ed®l
 && 
Œ“ty³
 !ğ
TREE_CLASSIFICATION
 &&»‘y³ !ğ
TREE_REGRESSION
) {

421 
throw
 
¡d
::
	`ruÁime_”rÜ
("Option '--predall' only‡vailable for classification‡nd„egression.");

424 ià(
´ediù
.
	`em±y
(è&& 
´ed®l
) {

425 
throw
 
¡d
::
	`ruÁime_”rÜ
("Option '--predall' only‡vailable in…rediction mode.");

428 ià(!
®ways¥l™v¬s
.
	`em±y
(è&& !
¥l™weights
.empty()) {

429 
throw
 
¡d
::
	`ruÁime_”rÜ
("Please use only one option of splitweights‡nd‡lwayssplitvars.");

433 ià(((
¥l™ruË
 =ğ
AUC
 || s¶™ruË =ğ
AUC_IGNORE_TIES
è&& 
Œ“ty³
 !ğ
TREE_SURVIVAL
)

434 || (
¥l™ruË
 =ğ
MAXSTAT
 && (
Œ“ty³
 !ğ
TREE_SURVIVAL
 &&»‘y³ !ğ
TREE_REGRESSION
))) {

435 
throw
 
¡d
::
	`ruÁime_”rÜ
("Illegal splitrule selected. See '--help' for details.");

439 ià(
hŞdout
 && 
ÿ£weights
.
	`em±y
()) {

440 
throw
 
¡d
::
	`ruÁime_”rÜ
("Case weights„equiredo use holdout mode.");

444 ià(
Œ“ty³
 =ğ
TREE_SURVIVAL
 && !
ÿtv¬s
.
	`em±y
(è&& 
¥l™ruË
 !ğ
LOGRANK
) {

445 
throw
 
¡d
::
	`ruÁime_”rÜ
("Unordered splitting in survivalrees only‡vailable for LOGRANK splitrule.");

447 
	}
}

449 
	gArgum’tHªdËr
::
	$di¥ÏyH–p
() {

450 
¡d
::
cout
 << "U§ge: " << std::
’dl
;

451 
¡d
::
cout
 << " " << 
¬gv
[0] << " [İtiÚs]" << std::
’dl
;

452 
¡d
::
cout
 << std::
’dl
;

454 
¡d
::
cout
 << "O±iÚs:" << std::
’dl
;

455 
¡d
::
cout
 << " " << "--h–° Pršˆthi h–p." << std::
’dl
;

456 
¡d
::
cout
 << " " << "--v”siÚ Pršˆv”siÚ‡nd c™©iÚ infÜm©iÚ." << std::
’dl
;

457 
¡d
::
cout
 << " " << "--v”bo£ Tuº oÀv”bo£ mode." << std::
’dl
;

458 
¡d
::
cout
 << " " << "--fFILE F’amoàšpuˆd©a. OÆy‚um”iÿÈv®ue ¬suµÜ‹d." << std::
’dl
;

459 
¡d
::
cout
 << " " << "--Œ“ty³ TYPE S‘»ty³o:" << std::
’dl
;

460 
¡d
::
cout
 << " " << " TYPE = 1: CÏssifiÿtiÚ." << std::
’dl
;

461 
¡d
::
cout
 << " " << " TYPE = 3: Reg»ssiÚ." << std::
’dl
;

462 
¡d
::
cout
 << " " << " TYPE = 5: Surviv®." << std::
’dl
;

463 
¡d
::
cout
 << " " << " (DeçuÉ: 1)" << std::
’dl
;

464 
¡d
::
cout
 << " " << "--´obab™y Grow‡ CÏssifiÿtiÚ fÜe¡ w™h…robab™yƒ¡im©iÚ fÜhşas£s." << std::
’dl
;

465 
¡d
::
cout
 << " " << " U£ iÀcombš©iÚ w™h --Œ“ty³ 1." << std::
’dl
;

466 
¡d
::
cout
 << " " << "--d•v¬ÇmNAME Namoàd•’d’ˆv¬ŸbË. FÜ surviv®»e thi i thtimv¬ŸbË." << std::
’dl
;

467 
¡d
::
cout
 << " " << "--¡©usv¬ÇmNAME Namoà¡©u v¬ŸbË, oÆy‡µliÿbË fÜ surviv®»es." << std::
’dl
;

468 
¡d
::
cout
 << " " << " Codšg i 1 fÜƒv’ˆªd 0 fÜ c’sÜed." << std::
’dl
;

469 
¡d
::
cout
 << " " << "--Á»N S‘‚umb” oàŒ“ tØN." << std::
’dl
;

470 
¡d
::
cout
 << " " << " (DeçuÉ: 500)" << std::
’dl
;

471 
¡d
::
cout
 << " " << "--mŒy N Numb” oàv¬ŸbË tØpossibly s¶™‡ˆšƒach‚ode." << std::
’dl
;

472 
¡d
::
cout
 << " " << " (DeçuÉ: sq¹ÕèfÜ CÏssifiÿtiÚ‡nd Surviv®,…/3 fÜ Reg»ssiÚ. " << std::
’dl
;

473 
¡d
::
cout
 << " " << "… =‚umb” oàšd•’d’ˆv¬ŸbËs)" << std::
’dl
;

474 
¡d
::
cout
 << " " << "--rg‘·¹™iÚsizN S‘ mšim®‚odsiztØN." << std::
’dl
;

475 
¡d
::
cout
 << " " << " FÜ CÏssifiÿtiÚ‡nd Reg»ssiÚ growšg i ¡İ³d ià¨nod»ache ¨sizsm®Ë¸thª N." << std::
’dl
;

476 
¡d
::
cout
 << " " << " FÜ Surviv® growšg i ¡İ³d iàÚchd would„—ch‡ sizsm®Ë¸thª N." << std::
’dl
;

477 
¡d
::
cout
 << " " << " Thi m—n node w™h sizsm®Ë¸N cª occu¸fÜ CÏssifiÿtiÚ‡nd Reg»ssiÚ." << std::
’dl
;

478 
¡d
::
cout
 << " " << " (DeçuÉ: 1 fÜ CÏssifiÿtiÚ, 5 fÜ Reg»ssiÚ,‡nd 3 fÜ Surviv®)" << std::
’dl
;

479 
¡d
::
cout
 << " " << "--ÿtv¬ V1,V2,.. Comm¨£·¿‹d†i¡ oàÇme oà(unÜd”edèÿ‹gÜiÿÈv¬ŸbËs. " << std::
’dl
;

480 
¡d
::
cout
 << " " << " C©egÜiÿÈv¬ŸbË mu¡ cÚš oÆy…os™ivš‹g” v®ues." << std::
’dl
;

481 
¡d
::
cout
 << " " << "--wr™ SavfÜe¡Øf<ou»fix>.fÜe¡." << std::
’dl
;

482 
¡d
::
cout
 << " " << "--´ediù FILE Lßd fÜe¡ from FILE‡nd…»diù w™h‚ew d©a." << std::
’dl
;

483 
¡d
::
cout
 << " " << "--´ed®È R‘uº‡ m©rix w™h individu®…»diùiÚ fÜƒach»š¡—d oàagg»g©ed " << std::
’dl
;

484 
¡d
::
cout
 << " " << "…»diùiÚ fÜ‡Î»e (şassifiÿtiÚ‡nd„eg»ssiÚ oÆy)." << std::
’dl
;

485 
¡d
::
cout
 << " " << "--impm—su» TYPE S‘ impÜnû modto:" << std::
’dl
;

486 
¡d
::
cout
 << " " << " TYPE = 0:‚Úe." << std::
’dl
;

487 
¡d
::
cout
 << " " << " TYPE = 1: Nodimpur™y: Gš˜fÜ CÏssifiÿtiÚ, v¬Ÿnû fÜ Reg»ssiÚ." << std::
’dl
;

488 
¡d
::
cout
 << " " << " TYPE = 2: P”mutiÚ impÜnû, sÿËd by snd¬dƒ¼Üs." << std::
’dl
;

489 
¡d
::
cout
 << " " << " TYPE = 3: P”mutiÚ impÜnû,‚Øsÿlšg." << std::
’dl
;

490 
¡d
::
cout
 << " " << " (DeçuÉ: 0)" << std::
’dl
;

491 
¡d
::
cout
 << " " << "--nÜ•Ïû Sam¶w™houˆ»¶aûm’t." << std::
’dl
;

492 
¡d
::
cout
 << " " << "--äaùiÚ X F¿ùiÚ oàob£rv©iÚ tØ§m¶e. DeçuÉ i 1 fÜ sam¶šg w™h„•Ïûm’ˆ" << std::
’dl
;

493 
¡d
::
cout
 << " " << "‡nd 0.632 fÜ sam¶šg w™houˆ»¶aûm’t." << std::
’dl
;

494 
¡d
::
cout
 << " " << "--¥l™ruË RULE S¶™tšg„uË:" << std::
’dl
;

495 
¡d
::
cout
 << " " << " RULE = 1: Gš˜fÜ CÏssifiÿtiÚ, v¬Ÿnû fÜ Reg»ssiÚ,†og¿nk fÜ Surviv®." << std::
’dl
;

496 
¡d
::
cout
 << " " << " RULE = 2: AUC fÜ Surviv®,‚Ù‡vaabË fÜ CÏssifiÿtiÚ‡nd Reg»ssiÚ." << std::
’dl
;

497 
¡d
::
cout
 << " " << " RULE = 3: AUC (ignÜt›sèfÜ Surviv®,‚Ù‡vaabË fÜ CÏssifiÿtiÚ‡nd Reg»ssiÚ." << std::
’dl
;

498 
¡d
::
cout
 << " " << " RULE = 4: MAXSTAT fÜ Surviv®‡nd Reg»ssiÚ,‚Ù‡vaabË fÜ CÏssifiÿtiÚ." << std::
’dl
;

499 
¡d
::
cout
 << " " << " (DeçuÉ: 1)" << std::
’dl
;

500 
¡d
::
cout
 << " " << "--®ph¨VAL Signifiÿnûh»shŞdØ®low s¶™tšg (MAXSTAT s¶™ruË oÆy)." << std::
’dl
;

501 
¡d
::
cout
 << " " << "--mš´İ VAL Low” quªtoàcov¬Ÿ‹ di¡ribtuiÚØbcÚsid”ed fÜ s¶™tšg (MAXSTAT s¶™ruË oÆy)." << std::
’dl
;

502 
¡d
::
cout
 << " " << "--ÿ£weight FILE F’amoàÿ£ weight fe." << std::
’dl
;

503 
¡d
::
cout
 << " " << "--hŞdouˆ HŞd-ouˆmode. HŞd-ouˆ®È§m¶e w™h ca£ weighˆ0‡nd u£he£ fÜ v¬ŸbË " << std::
’dl
;

504 
¡d
::
cout
 << " " << " impÜnû‡nd…»diùiÚƒ¼Ü." << std::
’dl
;

505 
¡d
::
cout
 << " " << "--¥l™weight FILE F’amoà¥l™ s–eù weight fe." << std::
’dl
;

506 
¡d
::
cout
 << " " << "--®ways¥l™v¬ V1,V2,.. Comm¨£·¿‹d†i¡ oàv¬ŸbË‚ame tØb®way cÚsid”ed fÜ s¶™tšg." << std::
’dl
;

507 
¡d
::
cout
 << " " << "--Áh»ad N S‘‚umb” oà·¿Î–h»ad tØN." << std::
’dl
;

508 
¡d
::
cout
 << " " << " (DeçuÉ: Numb” oàCPU avaabË)" << std::
’dl
;

509 
¡d
::
cout
 << " " << "--£ed SEED S‘„ªdom s“dØSEED." << std::
’dl
;

510 
¡d
::
cout
 << " " << " (DeçuÉ: NØ£ed)" << std::
’dl
;

511 
¡d
::
cout
 << " " << "--ou»fix PREFIX P»fix fÜ ouuˆfes." << std::
’dl
;

512 
¡d
::
cout
 << " " << "--memmodMODE S‘ memÜy modto:" << std::
’dl
;

513 
¡d
::
cout
 << " " << " MODE = 0: doubË." << std::
’dl
;

514 
¡d
::
cout
 << " " << " MODE = 1: flßt." << std::
’dl
;

515 
¡d
::
cout
 << " " << " MODE = 2: ch¬." << std::
’dl
;

516 
¡d
::
cout
 << " " << " (DeçuÉ: 0)" << std::
’dl
;

517 
¡d
::
cout
 << " " << "--§vemem U£ memÜy savšg (buˆ¦ow”è¥l™tšg mode." << std::
’dl
;

518 
¡d
::
cout
 << std::
’dl
;

520 
¡d
::
cout
 << "S“ README ffÜ d‘a ªdƒxam¶es." << std::
’dl
;

521 
	}
}

524 
	gArgum’tHªdËr
::
	$di¥ÏyV”siÚ
() {

525 
¡d
::
cout
 << "Rªg” v”siÚ: " << 
RANGER_VERSION
 << std::
’dl
;

526 
¡d
::
cout
 << std::
’dl
;

527 
¡d
::
cout
 << "PËa£ c™Rªg”: " << std::
’dl
;

528 
¡d
::
cout
 << "Wright, M. N. & Z›gËr, A. (2016).„ªg”: A Fa¡ Im¶em’tiÚ oàRªdom FÜe¡ fÜ High Dim’siÚ® D©¨š C++‡nd R. Jouº® oàSti¡iÿÈSoáw¬e, iÀ´ess." << std::
’dl
;

529 
¡d
::
cout
 << std::
’dl
;

530 
¡d
::
cout
 << "BibTeX:" << std::
’dl
;

531 
¡d
::
cout
 << "@A¹işe{," << std::
’dl
;

532 
¡d
::
cout
 << "™Ë = {¿ng”: {{A}} fa¡ im¶em’tiÚ oà¿ndom fÜe¡ fÜ high dim’siÚ® d©¨š {{C}}++‡nd {{R}}}," << std::
’dl
;

533 
¡d
::
cout
 << "‡uthÜ = {Wright, M¬vš N.‡nd Z›gËr, And»as}," << std::
’dl
;

534 
¡d
::
cout
 << " jouº® = {Jouº® oàSti¡iÿÈSoáw¬e}," << std::
’dl
;

535 
¡d
::
cout
 << " y—¸ğ{2016}," << std::
’dl
;

536 
¡d
::
cout
 << "}" << std::
’dl
;

537 
	}
}

	@utility/ArgumentHandler.h

29 #iâdeà
ARGUMENTHANDLER_H_


30 
	#ARGUMENTHANDLER_H_


	)

32 
	~<g‘İt.h
>

33 
	~<¡ršg
>

34 
	~<veùÜ
>

36 
	~"glob®s.h
"

51 şas 
	cArgum’tHªdËr
 {

52 
	mpublic
:

53 
Argum’tHªdËr
(
¬gc
, **
¬gv
);

54 
	mvœtu®
 ~
Argum’tHªdËr
();

57 
´oûssArgum’ts
();

60 
checkArgum’ts
();

63 
	m¡d
::
veùÜ
<
¡d
::
¡ršg
> 
®ways¥l™v¬s
;

64 
	m¡d
::
¡ršg
 
ÿ£weights
;

65 
	m¡d
::
¡ršg
 
d•v¬Çme
;

66 
	mäaùiÚ
;

67 
boŞ
 
	mhŞdout
;

68 
MemÜyMode
 
	mmemmode
;

69 
boŞ
 
	m§vemem
;

70 
	m¡d
::
¡ršg
 
´ediù
;

71 
	m¡d
::
¡ršg
 
¥l™weights
;

72 
ušt
 
	mÁh»ads
;

73 
boŞ
 
	m´ed®l
;

76 
	m®pha
;

77 
	mmš´İ
;

78 
	m¡d
::
veùÜ
<
¡d
::
¡ršg
> 
ÿtv¬s
;

79 
	m¡d
::
¡ršg
 
fe
;

80 
ImpÜnûMode
 
	mimpm—su»
;

81 
ušt
 
	mrg‘·¹™iÚsize
;

82 
ušt
 
	mmŒy
;

83 
	m¡d
::
¡ršg
 
ou»fix
;

84 
boŞ
 
	m´obab™y
;

85 
S¶™RuË
 
	m¥l™ruË
;

86 
	m¡d
::
¡ršg
 
¡©usv¬Çme
;

87 
ušt
 
	mÁ»e
;

88 
boŞ
 
	m»¶aû
;

89 
boŞ
 
	mv”bo£
;

90 
boŞ
 
	mwr™e
;

91 
T»eTy³
 
	mŒ“ty³
;

92 
ušt
 
	m£ed
;

94 
	m´iv©e
:

96 
di¥ÏyH–p
();

97 
di¥ÏyV”siÚ
();

99 
	m¬gc
;

100 ** 
	m¬gv
;

102 
DISALLOW_COPY_AND_ASSIGN
(
Argum’tHªdËr
);

	@utility/Data.cpp

29 
	~<f¡»am
>

30 
	~<s¡»am
>

31 
	~<¡dexû±
>

32 
	~<®gÜ™hm
>

33 
	~<™”©Ü
>

35 
	~"D©a.h
"

36 
	~"ut™y.h
"

38 
	gD©a
::
	$D©a
() :

39 
	`num_rows
(0), 
	`num_rows_rounded
(0), 
	`num_cŞs
(0), 
	`¥¬£_d©a
(0), 
	`num_cŞs_no_¥¬£
(0), 
	`ex‹º®D©a
(
Œue
), 
	`šdex_d©a
(

40 0), 
	$max_num_unique_v®ues
(0) {

41 
	}
}

43 
	gD©a
::~
	$D©a
() {

44 ià(
šdex_d©a
 != 0) {

45 
d–‘e
[] 
šdex_d©a
;

47 
	}
}

49 
size_t
 
	gD©a
::
	$g‘V¬ŸbËID
(
¡d
::
¡ršg
 
v¬ŸbË_Çme
) {

50 
¡d
::
veùÜ
<¡d::
¡ršg
>::
™”©Ü
 
™
 = std::
	`fšd
(
v¬ŸbË_Çmes
.
	`begš
(), v¬ŸbË_Çmes.
	`’d
(), 
v¬ŸbË_Çme
);

51 ià(
™
 =ğ
v¬ŸbË_Çmes
.
	`’d
()) {

52 
throw
 
¡d
::
	`ruÁime_”rÜ
("V¬ŸbË " + 
v¬ŸbË_Çme
 + "‚ot found.");

54  (
¡d
::
	`di¡ªû
(
v¬ŸbË_Çmes
.
	`begš
(), 
™
));

55 
	}
}

57 
	gD©a
::
	$addS·r£D©a
(* 
¥¬£_d©a
, 
size_t
 
num_cŞs_¥¬£
) {

58 
num_cŞs
 = 
num_cŞs_no_¥¬£
 + 
num_cŞs_¥¬£
;

59 
num_rows_rounded
 = 
	`roundToNextMuÉË
(
num_rows
, 4);

60 
this
->
¥¬£_d©a
 = sparse_data;

61 
	}
}

63 
boŞ
 
	gD©a
::
	$lßdFromFe
(
¡d
::
¡ršg
 
f’ame
) {

65 
boŞ
 
»suÉ
;

68 
¡d
::
if¡»am
 
šput_fe
;

69 
šput_fe
.
	`İ’
(
f’ame
);

70 ià(!
šput_fe
.
	`good
()) {

71 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚ot open input file.");

75 
size_t
 
lše_couÁ
 = 0;

76 
¡d
::
¡ršg
 
lše
;

77 
	`g‘lše
(
šput_fe
, 
lše
)) {

78 ++
lše_couÁ
;

80 
num_rows
 = 
lše_couÁ
 - 1;

81 
šput_fe
.
	`şo£
();

82 
šput_fe
.
	`İ’
(
f’ame
);

85 
¡d
::
¡ršg
 
h—d”_lše
;

86 
	`g‘lše
(
šput_fe
, 
h—d”_lše
);

89 ià(
h—d”_lše
.
	`fšd
(","è!ğ
¡d
::
¡ršg
::
Åos
) {

90 
»suÉ
 = 
	`lßdFromFeOth”
(
šput_fe
, 
h—d”_lše
, ',');

91 } ià(
h—d”_lše
.
	`fšd
(";"è!ğ
¡d
::
¡ršg
::
Åos
) {

92 
»suÉ
 = 
	`lßdFromFeOth”
(
šput_fe
, 
h—d”_lše
, ';');

94 
»suÉ
 = 
	`lßdFromFeWh™e¥aû
(
šput_fe
, 
h—d”_lše
);

97 
ex‹º®D©a
 = 
çl£
;

98 
šput_fe
.
	`şo£
();

99  
»suÉ
;

100 
	}
}

102 
boŞ
 
	gD©a
::
	$lßdFromFeWh™e¥aû
(
¡d
::
if¡»am
& 
šput_fe
, std::
¡ršg
 
h—d”_lše
) {

105 
¡d
::
¡ršg
 
h—d”_tok’
;

106 
¡d
::
¡ršg¡»am
 
	`h—d”_lše_¡»am
(
h—d”_lše
);

107 
h—d”_lše_¡»am
 >> 
h—d”_tok’
) {

108 
v¬ŸbË_Çmes
.
	`push_back
(
h—d”_tok’
);

110 
num_cŞs
 = 
v¬ŸbË_Çmes
.
	`size
();

111 
num_cŞs_no_¥¬£
 = 
num_cŞs
;

114 
	`»£rveMemÜy
();

115 
boŞ
 
”rÜ
 = 
çl£
;

116 
¡d
::
¡ršg
 
lše
;

117 
size_t
 
row
 = 0;

118 
	`g‘lše
(
šput_fe
, 
lše
)) {

119 
tok’
;

120 
¡d
::
¡ršg¡»am
 
	`lše_¡»am
(
lše
);

121 
size_t
 
cŞumn
 = 0;

122 
lše_¡»am
 >> 
tok’
) {

123 
	`£t
(
cŞumn
, 
row
, 
tok’
, 
”rÜ
);

124 ++
cŞumn
;

126 ià(
cŞumn
 > 
num_cŞs
) {

127 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚ot open input file. Too many columns in‡„ow.");

128 } ià(
cŞumn
 < 
num_cŞs
) {

129 
throw
 
¡d
::
	`ruÁime_”rÜ
("Could‚ot open input file. Too few columns in‡„ow. Are‡ll values‚umeric?");

131 ++
row
;

133 
num_rows
 = 
row
;

134  
”rÜ
;

135 
	}
}

137 
boŞ
 
	gD©a
::
	$lßdFromFeOth”
(
¡d
::
if¡»am
& 
šput_fe
, std::
¡ršg
 
h—d”_lše
, 
£³¿tÜ
) {

140 
¡d
::
¡ršg
 
h—d”_tok’
;

141 
¡d
::
¡ršg¡»am
 
	`h—d”_lše_¡»am
(
h—d”_lše
);

142 
	`g‘lše
(
h—d”_lše_¡»am
, 
h—d”_tok’
, 
£³¿tÜ
)) {

143 
v¬ŸbË_Çmes
.
	`push_back
(
h—d”_tok’
);

145 
num_cŞs
 = 
v¬ŸbË_Çmes
.
	`size
();

146 
num_cŞs_no_¥¬£
 = 
num_cŞs
;

149 
	`»£rveMemÜy
();

150 
boŞ
 
”rÜ
 = 
çl£
;

151 
¡d
::
¡ršg
 
lše
;

152 
size_t
 
row
 = 0;

153 
	`g‘lše
(
šput_fe
, 
lše
)) {

154 
¡d
::
¡ršg
 
tok’_¡ršg
;

155 
tok’
;

156 
¡d
::
¡ršg¡»am
 
	`lše_¡»am
(
lše
);

157 
size_t
 
cŞumn
 = 0;

158 
	`g‘lše
(
lše_¡»am
, 
tok’_¡ršg
, 
£³¿tÜ
)) {

159 
¡d
::
¡ršg¡»am
 
	`tok’_¡»am
(
tok’_¡ršg
);

160 
tok’_¡»am
 >> 
tok’
;

161 
	`£t
(
cŞumn
, 
row
, 
tok’
, 
”rÜ
);

162 ++
cŞumn
;

164 ++
row
;

166 
num_rows
 = 
row
;

167  
”rÜ
;

168 
	}
}

170 
	gD©a
::
g‘AÎV®ues
(
¡d
::
veùÜ
<>& 
®l_v®ues
, std::veùÜ<
size_t
>& 
§m¶eIDs
, size_ˆ
v¬ID
) {

173 ià(
	gv¬ID
 < 
	gnum_cŞs_no_¥¬£
) {

175 
	g®l_v®ues
.
»£rve
(
§m¶eIDs
.
size
());

176 
size_t
 
	gi
 = 0; i < 
	g§m¶eIDs
.
size
(); ++i) {

177 
	g®l_v®ues
.
push_back
(
g‘
(
§m¶eIDs
[
i
], 
v¬ID
));

179 
	g¡d
::
sÜt
(
®l_v®ues
.
begš
(),‡Î_v®ues.
’d
());

180 
	g®l_v®ues
.
”a£
(
unique
(
®l_v®ues
.
begš
(),‡Î_v®ues.
’d
()),‡ll_values.end());

183 
	g®l_v®ues
 = 
¡d
::
veùÜ
<>( { 0, 1, 2 });

188 
	gD©a
::
	$sÜt
() {

191 
šdex_d©a
 = 
Ãw
 
size_t
[
num_cŞs_no_¥¬£
 * 
num_rows
];

194 
size_t
 
cŞ
 = 0; cŞ < 
num_cŞs_no_¥¬£
; ++col) {

197 
¡d
::
veùÜ
<> 
	`unique_v®ues
(
num_rows
);

198 
size_t
 
row
 = 0;„ow < 
num_rows
; ++row) {

199 
unique_v®ues
[
row
] = 
	`g‘
Ôow, 
cŞ
);

201 
¡d
::
	`sÜt
(
unique_v®ues
.
	`begš
(), unique_v®ues.
	`’d
());

202 
unique_v®ues
.
	`”a£
(
	`unique
(unique_v®ues.
	`begš
(), unique_v®ues.
	`’d
()), unique_values.end());

205 
size_t
 
row
 = 0;„ow < 
num_rows
; ++row) {

206 
size_t
 
idx
 = 
¡d
::
	`low”_bound
(
unique_v®ues
.
	`begš
(), unique_v®ues.
	`’d
(), 
	`g‘
(
row
, 
cŞ
)) - unique_values.begin();

207 
šdex_d©a
[
cŞ
 * 
num_rows
 + 
row
] = 
idx
;

211 
unique_d©a_v®ues
.
	`push_back
(
unique_v®ues
);

212 ià(
unique_v®ues
.
	`size
(è> 
max_num_unique_v®ues
) {

213 
max_num_unique_v®ues
 = 
unique_v®ues
.
	`size
();

216 
	}
}

	@utility/Data.h

29 #iâdeà
DATA_H_


30 
	#DATA_H_


	)

32 
	~<veùÜ
>

33 
	~<io¡»am
>

35 
	~"glob®s.h
"

37 şas 
	cD©a
 {

38 
	mpublic
:

39 
D©a
();

40 
	mvœtu®
 ~
D©a
();

42 
vœtu®
 
	$g‘
(
size_t
 
row
, size_ˆ
cŞ
) const = 0;

44 
size_t
 
	`g‘V¬ŸbËID
(
¡d
::
¡ršg
 
v¬ŸbË_Çme
);

46 
vœtu®
 
	`»£rveMemÜy
() = 0;

47 
vœtu®
 
	`£t
(
size_t
 
cŞ
, size_ˆ
row
, 
v®ue
, 
boŞ
& 
”rÜ
) = 0;

49 
	`addS·r£D©a
(* 
¥¬£_d©a
, 
size_t
 
num_cŞs_¥¬£
);

51 
boŞ
 
	`lßdFromFe
(
¡d
::
¡ršg
 
f’ame
);

52 
boŞ
 
	`lßdFromFeWh™e¥aû
(
¡d
::
if¡»am
& 
šput_fe
, std::
¡ršg
 
h—d”_lše
);

53 
boŞ
 
	`lßdFromFeOth”
(
¡d
::
if¡»am
& 
šput_fe
, std::
¡ršg
 
h—d”_lše
, 
£³¿tÜ
);

55 
	`g‘AÎV®ues
(
¡d
::
veùÜ
<>& 
®l_v®ues
, std::veùÜ<
size_t
>& 
§m¶eIDs
, size_ˆ
v¬ID
);

57 
size_t
 
	$g‘Index
(
size_t
 
row
, size_ˆ
cŞ
) const {

58 ià(
cŞ
 < 
num_cŞs_no_¥¬£
) {

59  
šdex_d©a
[
cŞ
 * 
num_rows
 + 
row
];

62 
size_t
 
idx
 = (
cŞ
 - 
num_cŞs_no_¥¬£
è* 
num_rows_rounded
 + 
row
;

63 
size_t
 
»suÉ
 = (((
¥¬£_d©a
[
idx
 / 4] & 
mask
[idx % 4]è>> 
off£t
[idx % 4]) - 1);

66 ià(
»suÉ
 > 2) {

69  
»suÉ
;

74 
	$g‘UniqueD©aV®ue
(
size_t
 
v¬ID
, size_ˆ
šdex
) const {

75 ià(
v¬ID
 < 
num_cŞs_no_¥¬£
) {

76  
unique_d©a_v®ues
[
v¬ID
][
šdex
];

79  (
šdex
);

81 
	}
}

83 
size_t
 
	$g‘NumUniqueD©aV®ues
(
size_t
 
v¬ID
) const {

84 ià(
v¬ID
 < 
num_cŞs_no_¥¬£
) {

85  
unique_d©a_v®ues
[
v¬ID
].
	`size
();

90 
	}
}

92 
sÜt
();

94 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>& 
	$g‘V¬ŸbËNames
() const {

95  
v¬ŸbË_Çmes
;

96 
	}
}

97 
size_t
 
	$g‘NumCŞs
() const {

98  
num_cŞs
;

99 
	}
}

100 
size_t
 
	$g‘NumRows
() const {

101  
num_rows
;

102 
	}
}

104 
size_t
 
	$g‘MaxNumUniqueV®ues
() const {

105 ià(
¥¬£_d©a
 =ğ0 || 
max_num_unique_v®ues
 > 3) {

107  
max_num_unique_v®ues
;

112 
	}
}

114 
	g´Ùeùed
:

115 
¡d
::
veùÜ
<¡d::
¡ršg
> 
v¬ŸbË_Çmes
;

116 
size_t
 
	gnum_rows
;

117 
size_t
 
	gnum_rows_rounded
;

118 
size_t
 
	gnum_cŞs
;

120 * 
	g¥¬£_d©a
;

121 
size_t
 
	gnum_cŞs_no_¥¬£
;

123 
boŞ
 
	gex‹º®D©a
;

125 
size_t
* 
	gšdex_d©a
;

126 
	g¡d
::
veùÜ
<
¡d
::veùÜ<>> 
unique_d©a_v®ues
;

127 
size_t
 
	gmax_num_unique_v®ues
;

129 
	g´iv©e
:

130 
DISALLOW_COPY_AND_ASSIGN
(
D©a
);

	@utility/DataChar.cpp

29 
	~<lim™s.h
>

30 
	~<m©h.h
>

31 
	~<io¡»am
>

32 
	~<veùÜ
>

34 
	~"D©aCh¬.h
"

36 
	gD©aCh¬
::
	$D©aCh¬
() :

37 
	$d©a
(0) {

38 
	}
}

40 
D©aCh¬
::D©aCh¬(* 
d©a_doubË
, 
¡d
::
veùÜ
<¡d::
¡ršg
> 
v¬ŸbË_Çmes
, 
size_t
 
num_rows
, size_ˆ
num_cŞs
,

41 
boŞ
& 
”rÜ
) {

42 
	gthis
->
	gv¬ŸbË_Çmes
 = 
v¬ŸbË_Çmes
;

43 
	gthis
->
	gnum_rows
 = 
num_rows
;

44 
	gthis
->
	gnum_cŞs
 = 
num_cŞs
;

45 
	gthis
->
	gnum_cŞs_no_¥¬£
 = 
num_cŞs
;

47 
»£rveMemÜy
();

50 
size_t
 
	gi
 = 0; i < 
	gnum_cŞs
; ++i) {

51 
size_t
 
	gj
 = 0; j < 
	gnum_rows
; ++j) {

52 
	gv®ue
 = 
d©a_doubË
[
i
 * 
num_rows
 + 
j
];

53 ià(
	gv®ue
 > 
	gCHAR_MAX
 || v®u< 
	gCHAR_MIN
) {

54 
	g”rÜ
 = 
Œue
;

56 ià(
æoÜ
(
v®ue
è!ğ
û
(value)) {

57 
”rÜ
 = 
Œue
;

59 
	gd©a
[
i
 * 
num_rows
 + 
j
] = (è
v®ue
;

64 
	gD©aCh¬
::~
	$D©aCh¬
() {

65 ià(!
ex‹º®D©a
) {

66 
d–‘e
[] 
d©a
;

68 
	}
}

	@utility/DataChar.h

29 #iâdeà
DATACHAR_H_


30 
	#DATACHAR_H_


	)

32 
	~<lim™s.h
>

34 
	~"glob®s.h
"

35 
	~"D©a.h
"

37 şas 
	cD©aCh¬
: 
public
 
D©a
 {

38 
public
:

39 
D©aCh¬
();

40 
D©aCh¬
(* 
d©a_doubË
, 
¡d
::
veùÜ
<¡d::
¡ršg
> 
v¬ŸbË_Çmes
, 
size_t
 
num_rows
, size_ˆ
num_cŞs
, 
boŞ
& 
”rÜ
);

41 
	mvœtu®
 ~
D©aCh¬
();

43 
	$g‘
(
size_t
 
row
, size_ˆ
cŞ
) const {

44 ià(
cŞ
 < 
num_cŞs_no_¥¬£
) {

45  
d©a
[
cŞ
 * 
num_rows
 + 
row
];

48 
size_t
 
idx
 = (
cŞ
 - 
num_cŞs_no_¥¬£
è* 
num_rows_rounded
 + 
row
;

49  (((
¥¬£_d©a
[
idx
 / 4] & 
mask
[idx % 4]è>> 
off£t
[idx % 4]) - 1);

53 
	$»£rveMemÜy
() {

54 
d©a
 = 
Ãw
 [
num_cŞs
 * 
num_rows
];

55 
	}
}

57 
	$£t
(
size_t
 
cŞ
, size_ˆ
row
, 
v®ue
, 
boŞ
& 
”rÜ
) {

58 ià(
v®ue
 > 
CHAR_MAX
 || v®u< 
CHAR_MIN
) {

59 
”rÜ
 = 
Œue
;

61 ià(
	`æoÜ
(
v®ue
è!ğ
	`û
(value)) {

62 
”rÜ
 = 
Œue
;

64 
d©a
[
cŞ
 * 
num_rows
 + 
row
] = (è
v®ue
;

65 
	}
}

67 
	g´iv©e
:

68 * 
d©a
;

70 
DISALLOW_COPY_AND_ASSIGN
(
D©aCh¬
);

	@utility/DataDouble.cpp

29 
	~"D©aDoubË.h
"

31 
	gD©aDoubË
::
	$D©aDoubË
() :

32 
	$d©a
(0) {

33 
	}
}

35 
D©aDoubË
::~
	$D©aDoubË
() {

36 ià(!
ex‹º®D©a
) {

37 
d–‘e
[] 
d©a
;

39 
	}
}

	@utility/DataDouble.h

29 #iâdeà
DATADOUBLE_H_


30 
	#DATADOUBLE_H_


	)

32 
	~"glob®s.h
"

33 
	~"ut™y.h
"

34 
	~"D©a.h
"

36 şas 
	cD©aDoubË
: 
public
 
D©a
 {

37 
public
:

38 
D©aDoubË
();

39 
D©aDoubË
(* 
d©a
, 
¡d
::
veùÜ
<¡d::
¡ršg
> 
v¬ŸbË_Çmes
, 
size_t
 
num_rows
, size_ˆ
num_cŞs
) :

40 
	$d©a
(
d©a
) {

41 
this
->
v¬ŸbË_Çmes
 = variable_names;

42 
this
->
num_rows
 =‚um_rows;

43 
this
->
num_cŞs
 =‚um_cols;

44 
this
->
num_cŞs_no_¥¬£
 = 
num_cŞs
;

46 
vœtu®
 ~
	`D©aDoubË
();

48 
	$g‘
(
size_t
 
row
, size_ˆ
cŞ
) const {

49 ià(
cŞ
 < 
num_cŞs_no_¥¬£
) {

50  
d©a
[
cŞ
 * 
num_rows
 + 
row
];

53 
size_t
 
idx
 = (
cŞ
 - 
num_cŞs_no_¥¬£
è* 
num_rows_rounded
 + 
row
;

54 
»suÉ
 = (((
¥¬£_d©a
[
idx
 / 4] & 
mask
[idx % 4]è>> 
off£t
[idx % 4]) - 1);

55  
»suÉ
;

57 
	}
}

59 
	$»£rveMemÜy
() {

60 
d©a
 = 
Ãw
 [
num_cŞs
 * 
num_rows
];

61 
	}
}

63 
	$£t
(
size_t
 
cŞ
, size_ˆ
row
, 
v®ue
, 
boŞ
& 
”rÜ
) {

64 
d©a
[
cŞ
 * 
num_rows
 + 
row
] = 
v®ue
;

65 
	}
}

67 
	g´iv©e
:

68 * 
d©a
;

70 
DISALLOW_COPY_AND_ASSIGN
(
D©aDoubË
);

	@utility/DataFloat.cpp

29 
	~<io¡»am
>

30 
	~<veùÜ
>

32 
	~"D©aFlßt.h
"

34 
	gD©aFlßt
::
	$D©aFlßt
() :

35 
	$d©a
(0) {

36 
	}
}

38 
D©aFlßt
::D©aFlßt(* 
d©a_doubË
, 
¡d
::
veùÜ
<¡d::
¡ršg
> 
v¬ŸbË_Çmes
, 
size_t
 
num_rows
, size_ˆ
num_cŞs
) {

39 
	gthis
->
	gv¬ŸbË_Çmes
 = 
v¬ŸbË_Çmes
;

40 
	gthis
->
	gnum_rows
 = 
num_rows
;

41 
	gthis
->
	gnum_cŞs
 = 
num_cŞs
;

42 
	gthis
->
	gnum_cŞs_no_¥¬£
 = 
num_cŞs
;

44 
»£rveMemÜy
();

45 
size_t
 
	gi
 = 0; i < 
	gnum_cŞs
; ++i) {

46 
size_t
 
	gj
 = 0; j < 
	gnum_rows
; ++j) {

47 
	gd©a
[
i
 * 
num_rows
 + 
j
] = (è
d©a_doubË
[i *‚um_rows + j];

52 
	gD©aFlßt
::~
	$D©aFlßt
() {

53 ià(!
ex‹º®D©a
) {

54 
d–‘e
[] 
d©a
;

56 
	}
}

	@utility/DataFloat.h

29 #iâdeà
DATAFLOAT_H_


30 
	#DATAFLOAT_H_


	)

32 
	~"glob®s.h
"

33 
	~"D©a.h
"

35 şas 
	cD©aFlßt
: 
public
 
D©a
 {

36 
public
:

37 
D©aFlßt
();

38 
D©aFlßt
(* 
d©a_doubË
, 
¡d
::
veùÜ
<¡d::
¡ršg
> 
v¬ŸbË_Çmes
, 
size_t
 
num_rows
, size_ˆ
num_cŞs
);

39 
	mvœtu®
 ~
D©aFlßt
();

41 
	$g‘
(
size_t
 
row
, size_ˆ
cŞ
) const {

42 ià(
cŞ
 < 
num_cŞs_no_¥¬£
) {

43  
d©a
[
cŞ
 * 
num_rows
 + 
row
];

46 
size_t
 
idx
 = (
cŞ
 - 
num_cŞs_no_¥¬£
è* 
num_rows_rounded
 + 
row
;

47  (((
¥¬£_d©a
[
idx
 / 4] & 
mask
[idx % 4]è>> 
off£t
[idx % 4]) - 1);

51 
	$»£rveMemÜy
() {

52 
d©a
 = 
Ãw
 [
num_cŞs
 * 
num_rows
];

53 
	}
}

55 
	$£t
(
size_t
 
cŞ
, size_ˆ
row
, 
v®ue
, 
boŞ
& 
”rÜ
) {

56 
d©a
[
cŞ
 * 
num_rows
 + 
row
] = (è
v®ue
;

57 
	}
}

59 
	g´iv©e
:

60 * 
d©a
;

62 
DISALLOW_COPY_AND_ASSIGN
(
D©aFlßt
);

	@utility/utility.cpp

29 
	~<m©h.h
>

30 
	~<io¡»am
>

31 
	~<s¡»am
>

32 
	~<unÜd”ed_£t
>

33 
	~<unÜd”ed_m­
>

34 
	~<®gÜ™hm
>

35 
	~<¿ndom
>

36 
	~<¡dexû±
>

37 
	~<¡ršg
>

38 
	~<ut™y
>

39 
	~<veùÜ
>

41 
	~"ut™y.h
"

42 
	~"glob®s.h
"

43 
	~"D©a.h
"

45 
equ®S¶™
(
¡d
::
veùÜ
<
ušt
>& 
»suÉ
, ušˆ
¡¬t
, ušˆ
’d
, ušˆ
num_·¹s
) {

47 
	g»suÉ
.
»£rve
(
num_·¹s
 + 1);

50 ià(
	gnum_·¹s
 == 1) {

51 
»suÉ
.
push_back
(
¡¬t
);

52 
	g»suÉ
.
push_back
(
’d
 + 1);

57 ià(
	gnum_·¹s
 > 
	g’d
 - 
	g¡¬t
 + 1) {

58 
ušt
 
	gi
 = 
¡¬t
; i <ğ
’d
 + 1; ++i) {

59 
	g»suÉ
.
push_back
(
i
);

64 
ušt
 
	gËngth
 = (
’d
 - 
¡¬t
 + 1);

65 
ušt
 
	g·¹_Ëngth_shÜt
 = 
Ëngth
 / 
num_·¹s
;

66 
ušt
 
	g·¹_Ëngth_lÚg
 = (uštè
û
(
Ëngth
 / ((è
num_·¹s
));

67 
ušt
 
	gcut_pos
 = 
Ëngth
 % 
num_·¹s
;

70 
ušt
 
	gi
 = 
¡¬t
; i < 
	g¡¬t
 + 
cut_pos
 * 
	g·¹_Ëngth_lÚg
; i = 
i
 + 
·¹_Ëngth_lÚg
) {

71 
»suÉ
.
push_back
(
i
);

75 
ušt
 
	gi
 = 
¡¬t
 + 
cut_pos
 * 
·¹_Ëngth_lÚg
; i <ğ
’d
 + 1; i = 
i
 + 
·¹_Ëngth_shÜt
) {

76 
»suÉ
.
push_back
(
i
);

80 
lßdDoubËVeùÜFromFe
(
¡d
::
veùÜ
<>& 
»suÉ
, std::
¡ršg
 
f’ame
) {

83 
¡d
::
if¡»am
 
šput_fe
;

84 
	gšput_fe
.
İ’
(
f’ame
);

85 ià(!
	gšput_fe
.
good
()) {

86 
throw
 
	g¡d
::
ruÁime_”rÜ
("Could‚Ù o³Àfe: " + 
f’ame
);

90 
	g¡d
::
¡ršg
 
lše
;

91 
g‘lše
(
šput_fe
, 
lše
);

92 
	g¡d
::
¡ršg¡»am
 
lše_¡»am
(
lše
);

93 
	gtok’
;

94 
	glše_¡»am
 >> 
	gtok’
) {

95 
	g»suÉ
.
push_back
(
tok’
);

99 
d¿wW™houtR•Ïûm’tSk
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
, std::
mt19937_64
& 
¿ndom_numb”_g’”©Ü
, size_ˆ
max
,

100 
¡d
::
veùÜ
<
size_t
>& 
sk
, size_ˆ
num_§m¶es
) {

101 ià(
	gnum_§m¶es
 < 
	gmax
 / 2) {

102 
d¿wW™houtR•Ïûm’tSim¶e
(
»suÉ
, 
¿ndom_numb”_g’”©Ü
, 
max
, 
sk
, 
num_§m¶es
);

104 
d¿wW™houtR•Ïûm’tKnuth
(
»suÉ
, 
¿ndom_numb”_g’”©Ü
, 
max
, 
sk
, 
num_§m¶es
);

108 
d¿wW™houtR•Ïûm’tSim¶e
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
, std::
mt19937_64
& 
¿ndom_numb”_g’”©Ü
, size_ˆ
max
,

109 
¡d
::
veùÜ
<
size_t
>& 
sk
, size_ˆ
num_§m¶es
) {

111 
	g»suÉ
.
»£rve
(
num_§m¶es
);

114 
	g¡d
::
veùÜ
<
boŞ
> 
‹mp
;

115 
	g‹mp
.
»size
(
max
, 
çl£
);

117 
	g¡d
::
unifÜm_št_di¡ributiÚ
<
size_t
> 
unif_di¡
(0, 
max
 - 1 - 
sk
.
size
());

118 
size_t
 
	gi
 = 0; i < 
	gnum_§m¶es
; ++i) {

119 
size_t
 
	gd¿w
;

121 
	gd¿w
 = 
unif_di¡
(
¿ndom_numb”_g’”©Ü
);

122 auto& 
	gsk_v®ue
 : 
sk
) {

123 ià(
d¿w
 >ğ
sk_v®ue
) {

124 ++
d¿w
;

127 } 
	g‹mp
[
d¿w
]);

128 
	g‹mp
[
d¿w
] = 
Œue
;

129 
	g»suÉ
.
push_back
(
d¿w
);

133 
d¿wW™houtR•Ïûm’tKnuth
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
, std::
mt19937_64
& 
¿ndom_numb”_g’”©Ü
, size_ˆ
max
,

134 
¡d
::
veùÜ
<
size_t
>& 
sk
, size_ˆ
num_§m¶es
) {

136 
size_t
 
	gsize_no_sk
 = 
max
 - 
sk
.
size
();

137 
	g»suÉ
.
»size
(
num_§m¶es
);

138 
	gu
;

139 
size_t
 
	gfš®_v®ue
;

141 
	g¡d
::
unifÜm_»®_di¡ributiÚ
<> 
di¡ributiÚ
(0.0, 1.0);

143 
size_t
 
	gi
 = 0;

144 
size_t
 
	gj
 = 0;

145 
	gi
 < 
	gnum_§m¶es
) {

146 
	gu
 = 
di¡ributiÚ
(
¿ndom_numb”_g’”©Ü
);

148 ià((
	gsize_no_sk
 - 
	gj
è* 
	gu
 >ğ
num_§m¶es
 - 
i
) {

149 
j
++;

151 
	gfš®_v®ue
 = 
j
;

152 auto& 
	gsk_v®ue
 : 
sk
) {

153 ià(
fš®_v®ue
 >ğ
sk_v®ue
) {

154 ++
fš®_v®ue
;

157 
	g»suÉ
[
i
] = 
fš®_v®ue
;

158 
	gj
++;

159 
	gi
++;

164 
d¿wW™houtR•Ïûm’tWeigh‹d
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
, std::
mt19937_64
& 
¿ndom_numb”_g’”©Ü
,

165 
¡d
::
veùÜ
<
size_t
>& 
šdiûs
, size_ˆ
num_§m¶es
, std::veùÜ<>& 
weights
) {

167 
»suÉ
.
»£rve
(
num_§m¶es
);

170 
	g¡d
::
veùÜ
<
boŞ
> 
‹mp
;

171 
	g‹mp
.
»size
(
šdiûs
.
size
(), 
çl£
);

173 
	g¡d
::
disü‘e_di¡ributiÚ
<> 
weigh‹d_di¡
(
weights
.
begš
(), weights.
’d
());

174 
size_t
 
	gi
 = 0; i < 
	gnum_§m¶es
; ++i) {

175 
size_t
 
	gd¿w
;

177 
	gd¿w
 = 
weigh‹d_di¡
(
¿ndom_numb”_g’”©Ü
);

178 } 
	g‹mp
[
d¿w
]);

179 
	g‹mp
[
d¿w
] = 
Œue
;

180 
	g»suÉ
.
push_back
(
šdiûs
[
d¿w
]);

184 
d¿wW™houtR•Ïûm’tWeigh‹d
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
, std::
mt19937_64
& 
¿ndom_numb”_g’”©Ü
,

185 
size_t
 
max_šdex
, size_ˆ
num_§m¶es
, 
¡d
::
veùÜ
<>& 
weights
) {

187 
»suÉ
.
»£rve
(
num_§m¶es
);

190 
	g¡d
::
veùÜ
<
boŞ
> 
‹mp
;

191 
	g‹mp
.
»size
(
max_šdex
 + 1, 
çl£
);

193 
	g¡d
::
disü‘e_di¡ributiÚ
<> 
weigh‹d_di¡
(
weights
.
begš
(), weights.
’d
());

194 
size_t
 
	gi
 = 0; i < 
	gnum_§m¶es
; ++i) {

195 
size_t
 
	gd¿w
;

197 
	gd¿w
 = 
weigh‹d_di¡
(
¿ndom_numb”_g’”©Ü
);

198 } 
	g‹mp
[
d¿w
]);

199 
	g‹mp
[
d¿w
] = 
Œue
;

200 
	g»suÉ
.
push_back
(
d¿w
);

204 
mo¡F»qu’tV®ue
(
¡d
::
unÜd”ed_m­
<, 
size_t
>& 
şass_couÁ
, std::
mt19937_64
 
¿ndom_numb”_g’”©Ü
) {

205 
¡d
::
veùÜ
<> 
majÜ_şas£s
;

208 
size_t
 
	gmax_couÁ
 = 0;

209 auto& 
	gşass_v®ue
 : 
şass_couÁ
) {

210 ià(
şass_v®ue
.
£cÚd
 > 
max_couÁ
) {

211 
max_couÁ
 = 
şass_v®ue
.
£cÚd
;

212 
	gmajÜ_şas£s
.
ş—r
();

213 
	gmajÜ_şas£s
.
push_back
(
şass_v®ue
.
fœ¡
);

214 } ià(
	gşass_v®ue
.
	g£cÚd
 =ğ
max_couÁ
) {

215 
majÜ_şas£s
.
push_back
(
şass_v®ue
.
fœ¡
);

219 ià(
	gmajÜ_şas£s
.
size
() == 1) {

220  
majÜ_şas£s
[0];

223 
	g¡d
::
unifÜm_št_di¡ributiÚ
<
size_t
> 
unif_di¡
(0, 
majÜ_şas£s
.
size
() - 1);

224  
	gmajÜ_şas£s
[
unif_di¡
(
¿ndom_numb”_g’”©Ü
)];

228 
compu‹CÚcÜdªûIndex
(
D©a
* 
d©a
, 
¡d
::
veùÜ
<>& 
sum_chf
, 
size_t
 
d•’d’t_v¬ID
, size_ˆ
¡©us_v¬ID
,

229 
¡d
::
veùÜ
<
size_t
>& 
§m¶e_IDs
) {

232 
cÚcÜdªû
 = 0;

233 
	g³rmissibË
 = 0;

234 
size_t
 
	gi
 = 0; i < 
	gsum_chf
.
size
(); ++i) {

235 
size_t
 
	g§m¶e_i
 = 
i
;

236 ià(!
	g§m¶e_IDs
.
em±y
()) {

237 
	g§m¶e_i
 = 
§m¶e_IDs
[
i
];

239 
	gtime_i
 = 
d©a
->
g‘
(
§m¶e_i
, 
d•’d’t_v¬ID
);

240 
	g¡©us_i
 = 
d©a
->
g‘
(
§m¶e_i
, 
¡©us_v¬ID
);

242 
size_t
 
	gj
 = 
i
 + 1; j < 
	gsum_chf
.
size
(); ++j) {

243 
size_t
 
	g§m¶e_j
 = 
j
;

244 ià(!
	g§m¶e_IDs
.
em±y
()) {

245 
	g§m¶e_j
 = 
§m¶e_IDs
[
j
];

247 
	gtime_j
 = 
d©a
->
g‘
(
§m¶e_j
, 
d•’d’t_v¬ID
);

248 
	g¡©us_j
 = 
d©a
->
g‘
(
§m¶e_j
, 
¡©us_v¬ID
);

250 ià(
	gtime_i
 < 
	gtime_j
 && 
	g¡©us_i
 == 0) {

253 ià(
	gtime_j
 < 
	gtime_i
 && 
	g¡©us_j
 == 0) {

256 ià(
	gtime_i
 =ğ
time_j
 && 
¡©us_i
 =ğ
¡©us_j
) {

260 
	g³rmissibË
 += 1;

262 ià(
	gtime_i
 < 
	gtime_j
 && 
	gsum_chf
[
i
] > sum_chf[
j
]) {

263 
	gcÚcÜdªû
 += 1;

264 } ià(
	gtime_j
 < 
	gtime_i
 && 
	gsum_chf
[
j
] > sum_chf[
i
]) {

265 
	gcÚcÜdªû
 += 1;

266 } ià(
	gsum_chf
[
i
] =ğ
sum_chf
[
j
]) {

267 
cÚcÜdªû
 += 0.5;

273  (
	gcÚcÜdªû
 / 
	g³rmissibË
);

277 
	g¡d
::
¡ršg
 
	$uštToSŒšg
(
ušt
 
numb”
) {

278 #ià
WIN_R_BUILD
 == 1

279 
¡d
::
¡ršg¡»am
 
‹mp
;

280 
‹mp
 << 
numb”
;

281  
‹mp
.
	`¡r
();

283  
¡d
::
	`to_¡ršg
(
numb”
);

285 
	}
}

287 
	g¡d
::
¡ršg
 
	$b—utifyTime
(
ušt
 
£cÚds
) {

288 
¡d
::
¡ršg
 
»suÉ
;

291 
ušt
 
out_£cÚds
 = (uštè
£cÚds
 % 60;

292 
»suÉ
 = 
	`uštToSŒšg
(
out_£cÚds
) + " seconds";

293 
ušt
 
out_mšu‹s
 = (
£cÚds
 / 60) % 60;

294 ià(
£cÚds
 / 60 == 0) {

295  
»suÉ
;

296 } ià(
out_mšu‹s
 == 1) {

297 
»suÉ
 = "1 minute, " +„esult;

299 
»suÉ
 = 
	`uštToSŒšg
(
out_mšu‹s
) + " minutes, " +„esult;

301 
ušt
 
out_hours
 = (
£cÚds
 / 3600) % 24;

302 ià(
£cÚds
 / 3600 == 0) {

303  
»suÉ
;

304 } ià(
out_hours
 == 1) {

305 
»suÉ
 = "1 hour, " +„esult;

307 
»suÉ
 = 
	`uštToSŒšg
(
out_hours
) + " hours, " +„esult;

309 
ušt
 
out_days
 = (
£cÚds
 / 86400);

310 ià(
out_days
 == 0) {

311  
»suÉ
;

312 } ià(
out_days
 == 1) {

313 
»suÉ
 = "1 day, " +„esult;

315 
»suÉ
 = 
	`uštToSŒšg
(
out_days
) + " days, " +„esult;

317  
»suÉ
;

318 
	}
}

320 
size_t
 
	$roundToNextMuÉË
(
size_t
 
v®ue
, 
ušt
 
muÉË
) {

322 ià(
muÉË
 == 0) {

323  
v®ue
;

326 
»mašd”
 = 
v®ue
 % 
muÉË
;

327 ià(
»mašd”
 == 0) {

328  
v®ue
;

331  
v®ue
 + 
muÉË
 - 
»mašd”
;

332 
	}
}

334 
¥l™SŒšg
(
¡d
::
veùÜ
<¡d::
¡ršg
>& 
»suÉ
, std::¡ršg 
šput
, 
¥l™_ch¬
) {

336 
	g¡d
::
i¡ršg¡»am
 
ss
(
šput
);

337 
	g¡d
::
¡ršg
 
tok’
;

339 
	g¡d
::
g‘lše
(
ss
, 
tok’
, 
¥l™_ch¬
)) {

340 
	g»suÉ
.
push_back
(
tok’
);

344 
shufæeAndS¶™
(
¡d
::
veùÜ
<
size_t
>& 
fœ¡_·¹
, std::veùÜ<size_t>& 
£cÚd_·¹
, size_ˆ
n_®l
, size_ˆ
n_fœ¡
,

345 
¡d
::
mt19937_64
 
¿ndom_numb”_g’”©Ü
) {

348 
fœ¡_·¹
.
»size
(
n_®l
);

351 
	g¡d
::
iÙa
(
fœ¡_·¹
.
begš
(), fœ¡_·¹.
’d
(), 0);

352 
	g¡d
::
shufæe
(
fœ¡_·¹
.
begš
(), fœ¡_·¹.
’d
(), 
¿ndom_numb”_g’”©Ü
);

355 
	g£cÚd_·¹
.
»size
(
n_®l
 - 
n_fœ¡
);

356 
	g¡d
::
cİy
(
fœ¡_·¹
.
begš
(è+ 
n_fœ¡
, fœ¡_·¹.
’d
(), 
£cÚd_·¹
.begin());

359 
	gfœ¡_·¹
.
»size
(
n_fœ¡
);

362 
	g¡d
::
¡ršg
 
checkUnÜd”edV¬ŸbËs
(
D©a
* 
d©a
, 
¡d
::
veùÜ
<¡d::¡ršg> 
unÜd”ed_v¬ŸbË_Çmes
) {

363 
size_t
 
num_rows
 = 
d©a
->
g‘NumRows
();

364 
	g¡d
::
veùÜ
<
size_t
> 
§m¶eIDs
(
num_rows
);

365 
	g¡d
::
iÙa
(
§m¶eIDs
.
begš
(), sam¶eIDs.
’d
(), 0);

368 auto& 
	gv¬ŸbË_Çme
 : 
unÜd”ed_v¬ŸbË_Çmes
) {

369 
size_t
 
v¬ID
 = 
d©a
->
g‘V¬ŸbËID
(
v¬ŸbË_Çme
);

370 
	g¡d
::
veùÜ
<> 
®l_v®ues
;

371 
	gd©a
->
g‘AÎV®ues
(
®l_v®ues
, 
§m¶eIDs
, 
v¬ID
);

374 
size_t
 
	gmax_Ëv–_couÁ
 = 8 * (size_t) - 1;

375 ià(
	g®l_v®ues
.
size
(è> 
	gmax_Ëv–_couÁ
) {

376  "ToØmªy†ev– š unÜd”ed c©egÜiÿÈv¬ŸbË " + 
	gv¬ŸbË_Çme
 + ". Only "

377 + 
uštToSŒšg
(
max_Ëv–_couÁ
) + "†evels‡llowed onhis system.";

381 ià(!
checkPos™iveIÁeg”s
(
®l_v®ues
)) {

382  "NÙ‡Î v®ue š unÜd”ed c©egÜiÿÈv¬ŸbË " + 
	gv¬ŸbË_Çme
 + "‡re…ositive integers.";

388 
boŞ
 
checkPos™iveIÁeg”s
(
¡d
::
veùÜ
<>& 
®l_v®ues
) {

389 auto& 
v®ue
 : 
®l_v®ues
) {

390 ià(
v®ue
 < 1 || !(
æoÜ
(value) == value)) {

391  
çl£
;

394  
	gŒue
;

397 
	$max¡©PV®ueLau92
(
b
, 
mš´İ
, 
max´İ
) {

399 ià(
b
 < 1) {

404 
log´İ
 = 
	`log
((
max´İ
 * (1 - 
mš´İ
)) / ((1 - maxprop) * minprop));

406 
db
 = 
	`d¡dnÜm
(
b
);

407 
p
 = 4 * 
db
 / 
b
 + db * (b - 1 / bè* 
log´İ
;

409 ià(
p
 > 0) {

410  
p
;

414 
	}
}

416 
max¡©PV®ueLau94
(
b
, 
mš´İ
, 
max´İ
, 
size_t
 
N
, 
¡d
::
veùÜ
<size_t>& 
m
) {

418 
D
 = 0;

419 
size_t
 
	gi
 = 0; i < 
	gm
.
size
() - 1; ++i) {

420 
	gm1
 = 
m
[
i
];

421 
	gm2
 = 
m
[
i
 + 1];

423 
	gt
 = 
sq¹
(1.0 - 
m1
 * (
N
 - 
m2
) / ((N - m1) * m2));

424 
	gD
 +ğ1 / 
M_PI
 * 
exp
(-
b
 * b / 2è* (
t
 - (b * b / 4 - 1) * (t * *) / 6);

427  2 * (1 - 
p¡dnÜm
(
b
)è+ 
	gD
;

430 
	$d¡dnÜm
(
x
) {

431  
	`exp
(-0.5 * 
x
 * xè/ 
	`sq¹
(2 * 
M_PI
);

432 
	}
}

434 
	$p¡dnÜm
(
x
) {

435  0.5 * (1 + 
	`”f
(
x
 / 
	`sq¹
(2.0)));

436 
	}
}

438 
	g¡d
::
veùÜ
<> 
adju¡Pv®ues
(
¡d
::veùÜ<>& 
uÇdju¡ed_pv®ues
) {

439 
size_t
 
num_pv®ues
 = 
uÇdju¡ed_pv®ues
.
size
();

440 
	g¡d
::
veùÜ
<> 
adju¡ed_pv®ues
(
num_pv®ues
, 0);

443 
	g¡d
::
veùÜ
<
size_t
> 
šdiûs
 = 
Üd”
(
uÇdju¡ed_pv®ues
, 
Œue
);

446 
	gadju¡ed_pv®ues
[
šdiûs
[0]] = 
uÇdju¡ed_pv®ues
[indices[0]];

447 
size_t
 
	gi
 = 1; i < 
	gšdiûs
.
size
(); ++i) {

448 
size_t
 
	gidx
 = 
šdiûs
[
i
];

449 
size_t
 
	gidx_Ï¡
 = 
šdiûs
[
i
 - 1];

451 
	gadju¡ed_pv®ues
[
idx
] = 
¡d
::
mš
(
adju¡ed_pv®ues
[
idx_Ï¡
],

452 (è
num_pv®ues
 / (èÒum_pv®ue - 
i
è* 
uÇdju¡ed_pv®ues
[
idx
]);

454  
	gadju¡ed_pv®ues
;

457 
	g¡d
::
veùÜ
<
size_t
> 
Üd”InD©a
(
D©a
* 
d©a
, 
¡d
::veùÜ<size_t>& 
§m¶eIDs
, size_ˆ
v¬ID
, 
boŞ
 
deü—sšg
) {

459 
	g¡d
::
veùÜ
<
size_t
> 
šdiûs
(
§m¶eIDs
.
size
());

460 
	g¡d
::
iÙa
(
šdiûs
.
begš
(), indiûs.
’d
(), 0);

463 ià(
	gdeü—sšg
) {

464 
	g¡d
::
sÜt
(
¡d
::
begš
(
šdiûs
), std::
’d
(indices),

465 [&](
size_t
 
i1
, size_ˆ
i2
è{ 
d©a
->
g‘
(
§m¶eIDs
[i1], 
v¬ID
) > data->get(sampleIDs[i2], varID);});

467 
	g¡d
::
sÜt
(
¡d
::
begš
(
šdiûs
), std::
’d
(indices),

468 [&](
size_t
 
i1
, size_ˆ
i2
è{ 
d©a
->
g‘
(
§m¶eIDs
[i1], 
v¬ID
) < data->get(sampleIDs[i2], varID);});

470  
	gšdiûs
;

473 
	g¡d
::
veùÜ
<> 
log¿nkScÜes
(
¡d
::veùÜ<>& 
time
, std::veùÜ<>& 
¡©us
) {

474 
size_t
 
n
 = 
time
.
size
();

475 
	g¡d
::
veùÜ
<> 
scÜes
(
n
);

478 
	g¡d
::
veùÜ
<
size_t
> 
šdiûs
 = 
Üd”
(
time
, 
çl£
);

481 
	gcumsum
 = 0;

482 
size_t
 
	gÏ¡_unique
 = -1;

483 
size_t
 
	gi
 = 0; i < 
	gn
; ++i) {

486 ià(
	gi
 < 
	gn
 - 1 && 
	gtime
[
šdiûs
[
i
]] =ğ
time
[indices[i + 1]]) {

491 
size_t
 
	gj
 = 
Ï¡_unique
 + 1; j <ğ
i
; ++j) {

492 
	gcumsum
 +ğ
¡©us
[
šdiûs
[
j
]] / (
n
 - 
i
);

494 
size_t
 
	gj
 = 
Ï¡_unique
 + 1; j <ğ
i
; ++j) {

495 
	gscÜes
[
šdiûs
[
j
]] = 
¡©us
[šdiûs[j]] - 
cumsum
;

499 
	gÏ¡_unique
 = 
i
;

502  
	gscÜes
;

505 
	g¡d
::
veùÜ
<> 
log¿nkScÜesD©a
(
D©a
* 
d©a
, 
size_t
 
time_v¬ID
, size_ˆ
¡©us_v¬ID
,

506 
¡d
::
veùÜ
<
size_t
> 
§m¶eIDs
) {

508 
size_t
 
n
 = 
§m¶eIDs
.
size
();

509 
	g¡d
::
veùÜ
<> 
scÜes
(
n
);

512 
	g¡d
::
veùÜ
<
size_t
> 
šdiûs
(
n
);

513 
	g¡d
::
iÙa
(
šdiûs
.
begš
(), indiûs.
’d
(), 0);

514 
	g¡d
::
sÜt
(
¡d
::
begš
(
šdiûs
), std::
’d
(indices),

515 [&](
size_t
 
i1
, size_ˆ
i2
è{ 
d©a
->
g‘
(
§m¶eIDs
[i1], 
time_v¬ID
) < data->get(sampleIDs[i2],ime_varID);});

518 
	gcumsum
 = 0;

519 
size_t
 
	gÏ¡_unique
 = -1;

520 
size_t
 
	gi
 = 0; i < 
	gn
; ++i) {

523 ià(
	gi
 < 
	gn
 - 1 && 
	gd©a
->
g‘
(
§m¶eIDs
[
šdiûs
[
i
]], 
time_v¬ID
è=ğ
d©a
->get(sampleIDs[indices[i + 1]],ime_varID)) {

528 
size_t
 
	gj
 = 
Ï¡_unique
 + 1; j <ğ
i
; ++j) {

529 
	gcumsum
 +ğ
d©a
->
g‘
(
§m¶eIDs
[
šdiûs
[
j
]], 
¡©us_v¬ID
è/ (
	gn
 - 
	gi
);

531 
size_t
 
	gj
 = 
Ï¡_unique
 + 1; j <ğ
i
; ++j) {

532 
	gscÜes
[
šdiûs
[
j
]] = 
d©a
->
g‘
(
§m¶eIDs
[šdiûs[j]], 
¡©us_v¬ID
è- 
	gcumsum
;

536 
	gÏ¡_unique
 = 
i
;

539  
	gscÜes
;

542 
max¡©
(
¡d
::
veùÜ
<>& 
scÜes
, std::veùÜ<>& 
x
, std::veùÜ<
size_t
>& 
šdiûs
, & 
be¡_max¡©
,

543 & 
be¡_¥l™_v®ue
, 
mš´İ
, 
max´İ
) {

544 
size_t
 
	gn
 = 
x
.
size
();

546 
	gsum_®l_scÜes
 = 0;

547 
size_t
 
	gi
 = 0; i < 
	gn
; ++i) {

548 
	gsum_®l_scÜes
 +ğ
scÜes
[
šdiûs
[
i
]];

552 
	gm—n_scÜes
 = 
sum_®l_scÜes
 / 
n
;

553 
	gsum_m—n_diff
 = 0;

554 
size_t
 
	gi
 = 0; i < 
	gn
; ++i) {

555 
	gsum_m—n_diff
 +ğ(
scÜes
[
i
] - 
m—n_scÜes
) * (scores[i] - mean_scores);

559 
size_t
 
	gmš¥l™
 = 0;

560 ià(
n
 * 
	gmš´İ
 > 1) {

561 
	gmš¥l™
 = 
n
 * 
mš´İ
 - 1;

563 
size_t
 
	gmax¥l™
 = 
n
 * 
max´İ
 - 1;

566 
	gbe¡_max¡©
 = -1;

567 
	gbe¡_¥l™_v®ue
 = -1;

568 
	gsum_scÜes
 = 0;

569 
size_t
 
	gn_Ëá
 = 0;

570 
size_t
 
	gi
 = 0; i <ğ
max¥l™
; ++i) {

572 
	gsum_scÜes
 +ğ
scÜes
[
šdiûs
[
i
]];

573 
	gn_Ëá
++;

576 ià(
	gi
 < 
	gmš¥l™
) {

581 ià(
	gi
 < 
	gn
 - 1 && 
	gx
[
šdiûs
[
i
]] =ğ
x
[indices[i + 1]]) {

586 ià(
	gx
[
šdiûs
[
i
]] =ğ
x
[šdiûs[
n
 - 1]]) {

590 
	gS
 = 
sum_scÜes
;

591 
	gE
 = (è
n_Ëá
 / (è
n
 * 
sum_®l_scÜes
;

592 
	gV
 = (è
n_Ëá
 * (è(
n
 -‚_Ëáè/ (èÒ * (À- 1)è* 
sum_m—n_diff
;

593 
	gT
 = 
çbs
((
S
 - 
E
è/ 
sq¹
(
V
));

595 ià(
	gT
 > 
	gbe¡_max¡©
) {

596 
	gbe¡_max¡©
 = 
T
;

597 
	gbe¡_¥l™_v®ue
 = 
x
[
šdiûs
[
i
]];

602 
max¡©InD©a
(
¡d
::
veùÜ
<>& 
scÜes
, 
D©a
* 
d©a
, std::veùÜ<
size_t
>& 
§m¶eIDs
, size_ˆ
v¬ID
,

603 
¡d
::
veùÜ
<
size_t
>& 
šdiûs
, & 
be¡_max¡©
, & 
be¡_¥l™_v®ue
, 
mš´İ
, 
max´İ
) {

604 
size_t
 
	gn
 = 
§m¶eIDs
.
size
();

606 
	gsum_®l_scÜes
 = 0;

607 
size_t
 
	gi
 = 0; i < 
	gn
; ++i) {

608 
	gsum_®l_scÜes
 +ğ
scÜes
[
šdiûs
[
i
]];

612 
	gm—n_scÜes
 = 
sum_®l_scÜes
 / 
n
;

613 
	gsum_m—n_diff
 = 0;

614 
size_t
 
	gi
 = 0; i < 
	gn
; ++i) {

615 
	gsum_m—n_diff
 +ğ(
scÜes
[
i
] - 
m—n_scÜes
) * (scores[i] - mean_scores);

619 
size_t
 
	gmš¥l™
 = 0;

620 ià(
n
 * 
	gmš´İ
 > 1) {

621 
	gmš¥l™
 = 
n
 * 
mš´İ
 - 1;

623 
size_t
 
	gmax¥l™
 = 
n
 * 
max´İ
 - 1;

626 
	gbe¡_max¡©
 = -1;

627 
	gbe¡_¥l™_v®ue
 = -1;

628 
	gsum_scÜes
 = 0;

629 
size_t
 
	gn_Ëá
 = 0;

630 
size_t
 
	gi
 = 0; i <ğ
max¥l™
; ++i) {

632 
	gsum_scÜes
 +ğ
scÜes
[
šdiûs
[
i
]];

633 
	gn_Ëá
++;

636 ià(
	gi
 < 
	gmš¥l™
) {

641 
	gxi
 = 
d©a
->
g‘
(
§m¶eIDs
[
šdiûs
[
i
]], 
v¬ID
);

642 ià(
	gi
 < 
	gn
 - 1 && 
	gxi
 =ğ
d©a
->
g‘
(
§m¶eIDs
[
šdiûs
[
i
 + 1]], 
v¬ID
)) {

647 ià(
	gxi
 =ğ
d©a
->
g‘
(
§m¶eIDs
[
šdiûs
[
n
 - 1]], 
v¬ID
)) {

651 
	gS
 = 
sum_scÜes
;

652 
	gE
 = (è
n_Ëá
 / (è
n
 * 
sum_®l_scÜes
;

653 
	gV
 = (è
n_Ëá
 * (è(
n
 -‚_Ëáè/ (èÒ * (À- 1)è* 
sum_m—n_diff
;

654 
	gT
 = 
çbs
((
S
 - 
E
è/ 
sq¹
(
V
));

656 ià(
	gT
 > 
	gbe¡_max¡©
) {

657 
	gbe¡_max¡©
 = 
T
;

658 
	gbe¡_¥l™_v®ue
 = 
xi
;

663 
	g¡d
::
veùÜ
<
size_t
> 
numSam¶esLeáOfCuošt
(
¡d
::veùÜ<>& 
x
, std::veùÜ<size_t>& 
šdiûs
) {

664 
¡d
::
veùÜ
<
size_t
> 
num_§m¶es_Ëá
;

665 
	gnum_§m¶es_Ëá
.
»£rve
(
x
.
size
());

667 
size_t
 
	gi
 = 0; i < 
	gx
.
size
(); ++i) {

668 ià(
	gi
 == 0) {

669 
num_§m¶es_Ëá
.
push_back
(1);

670 } ià(
	gx
[
šdiûs
[
i
]] =ğ
x
[indices[i - 1]]) {

671 ++
num_§m¶es_Ëá
[num_§m¶es_Ëá.
size
() - 1];

673 
	gnum_§m¶es_Ëá
.
push_back
(
num_§m¶es_Ëá
[num_§m¶es_Ëá.
size
() - 1] + 1);

677  
	gnum_§m¶es_Ëá
;

680 
	g¡d
::
veùÜ
<
size_t
> 
numSam¶esLeáOfCuoštInD©a
(
D©a
* 
d©a
, 
¡d
::veùÜ<size_t>& 
§m¶eIDs
, size_ˆ
v¬ID
,

681 
¡d
::
veùÜ
<
size_t
>& 
šdiûs
) {

682 
size_t
 
n
 = 
šdiûs
.
size
();

684 
	g¡d
::
veùÜ
<
size_t
> 
num_§m¶es_Ëá
;

685 
	gnum_§m¶es_Ëá
.
»£rve
(
n
);

687 
size_t
 
	gi
 = 0; i < 
	gn
; ++i) {

688 ià(
	gi
 == 0) {

689 
num_§m¶es_Ëá
.
push_back
(1);

690 } ià(
	gd©a
->
g‘
(
§m¶eIDs
[
šdiûs
[
i
]], 
v¬ID
è=ğ
d©a
->get(sampleIDs[indices[i - 1]], varID)) {

691 ++
	gnum_§m¶es_Ëá
[
num_§m¶es_Ëá
.
size
() - 1];

693 
	gnum_§m¶es_Ëá
.
push_back
(
num_§m¶es_Ëá
[num_§m¶es_Ëá.
size
() - 1] + 1);

697  
	gnum_§m¶es_Ëá
;

	@utility/utility.h

29 #iâdeà
UTILITY_H_


30 
	#UTILITY_H_


	)

32 
	~<veùÜ
>

33 
	~<io¡»am
>

34 
	~<f¡»am
>

35 
	~<®gÜ™hm
>

36 
	~<¿ndom
>

37 
	~<unÜd”ed_£t
>

38 
	~<unÜd”ed_m­
>

40 #ifdeà
R_BUILD


41 
	~<Rš‹º®s.h
>

44 
	~"glob®s.h
"

45 
	~"D©a.h
"

54 
equ®S¶™
(
¡d
::
veùÜ
<
ušt
>& 
»suÉ
, ušˆ
¡¬t
, ušˆ
’d
, ušˆ
num_·¹s
);

67 
	g‹m¶©e
<
ty³Çme
 
	gT
>

68 
šlše
 
§veVeùÜ1D
(
¡d
::
veùÜ
<
T
>& veùÜ, std::
of¡»am
& 
fe
) {

70 
size_t
 
Ëngth
 = 
veùÜ
.
size
();

71 
	gfe
.
wr™e
((*è&
Ëngth
, (length));

72 
	gfe
.
wr™e
((*è
veùÜ
.
d©a
(), 
Ëngth
 * (
T
));

75 
	g‹m¶©e
<>

76 
šlše
 
§veVeùÜ1D
(
¡d
::
veùÜ
<
boŞ
>& veùÜ, std::
of¡»am
& 
fe
) {

78 
size_t
 
Ëngth
 = 
veùÜ
.
size
();

79 
	gfe
.
wr™e
((*è&
Ëngth
, (length));

82 
size_t
 
	gi
 = 0; i < 
	gveùÜ
.
size
(); ++i) {

83 
boŞ
 
	gv
 = 
veùÜ
[
i
];

84 
	gfe
.
wr™e
((*è&
v
, (v));

93 
	g‹m¶©e
<
ty³Çme
 
	gT
>

94 
šlše
 
»adVeùÜ1D
(
¡d
::
veùÜ
<
T
>& 
»suÉ
, std::
if¡»am
& 
fe
) {

96 
size_t
 
Ëngth
;

97 
	gfe
.
»ad
((*è&
Ëngth
, (length));

98 
	g»suÉ
.
»size
(
Ëngth
);

99 
	gfe
.
»ad
((*è
»suÉ
.
d©a
(), 
Ëngth
 * (
T
));

102 
	g‹m¶©e
<>

103 
šlše
 
»adVeùÜ1D
(
¡d
::
veùÜ
<
boŞ
>& 
»suÉ
, std::
if¡»am
& 
fe
) {

105 
size_t
 
Ëngth
;

106 
	gfe
.
»ad
((*è&
Ëngth
, (length));

109 
size_t
 
	gi
 = 0; i < 
	gËngth
; ++i) {

110 
boŞ
 
	g‹mp
;

111 
	gfe
.
»ad
((*è&
‹mp
, (temp));

112 
	g»suÉ
.
push_back
(
‹mp
);

121 
	g‹m¶©e
<
ty³Çme
 
	gT
>

122 
šlše
 
§veVeùÜ2D
(
¡d
::
veùÜ
<¡d::veùÜ<
T
>>& veùÜ, std::
of¡»am
& 
fe
) {

124 
size_t
 
Ëngth
 = 
veùÜ
.
size
();

125 
	gfe
.
wr™e
((*è&
Ëngth
, (length));

128 auto& 
	gšÃr_veùÜ
 : 
veùÜ
) {

130 
§veVeùÜ1D
(
šÃr_veùÜ
, 
fe
);

139 
	g‹m¶©e
<
ty³Çme
 
	gT
>

140 
šlše
 
»adVeùÜ2D
(
¡d
::
veùÜ
<¡d::veùÜ<
T
>>& 
»suÉ
, std::
if¡»am
& 
fe
) {

142 
size_t
 
Ëngth
;

143 
	gfe
.
»ad
((*è&
Ëngth
, (length));

144 
	g»suÉ
.
»size
(
Ëngth
);

147 
size_t
 
	gi
 = 0; i < 
	gËngth
; ++i) {

149 
»adVeùÜ1D
(
»suÉ
[
i
], 
fe
);

158 
lßdDoubËVeùÜFromFe
(
¡d
::
veùÜ
<>& 
»suÉ
, std::
¡ršg
 
f’ame
);

168 
d¿wW™houtR•Ïûm’tSk
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
, std::
mt19937_64
& 
¿ndom_numb”_g’”©Ü
,

169 
size_t
 
¿nge_Ëngth
, 
¡d
::
veùÜ
<size_t>& 
sk
, size_ˆ
num_§m¶es
);

179 
d¿wW™houtR•Ïûm’tSim¶e
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
, std::
mt19937_64
& 
¿ndom_numb”_g’”©Ü
, size_ˆ
max
,

180 
¡d
::
veùÜ
<
size_t
>& 
sk
, size_ˆ
num_§m¶es
);

191 
d¿wW™houtR•Ïûm’tKnuth
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
, std::
mt19937_64
& 
¿ndom_numb”_g’”©Ü
, size_ˆ
max
,

192 
¡d
::
veùÜ
<
size_t
>& 
sk
, size_ˆ
num_§m¶es
);

202 
d¿wW™houtR•Ïûm’tWeigh‹d
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
, std::
mt19937_64
& 
¿ndom_numb”_g’”©Ü
,

203 
¡d
::
veùÜ
<
size_t
>& 
šdiûs
, size_ˆ
num_§m¶es
, std::veùÜ<>& 
weights
);

213 
d¿wW™houtR•Ïûm’tWeigh‹d
(
¡d
::
veùÜ
<
size_t
>& 
»suÉ
, std::
mt19937_64
& 
¿ndom_numb”_g’”©Ü
,

214 
size_t
 
max_šdex
, size_ˆ
num_§m¶es
, 
¡d
::
veùÜ
<>& 
weights
);

222 
	g‹m¶©e
<
ty³Çme
 
	gT
>

223 
size_t
 
mo¡F»qu’tCÏss
(
¡d
::
veùÜ
<
T
>& 
şass_couÁ
, std::
mt19937_64
 
¿ndom_numb”_g’”©Ü
) {

224 
¡d
::
veùÜ
<
size_t
> 
majÜ_şas£s
;

227 
T
 
	gmax_couÁ
 = 0;

228 
size_t
 
	gi
 = 0; i < 
	gşass_couÁ
.
size
(); ++i) {

229 
T
 
	gcouÁ
 = 
şass_couÁ
[
i
];

230 ià(
	gcouÁ
 > 
	gmax_couÁ
) {

231 
	gmax_couÁ
 = 
couÁ
;

232 
	gmajÜ_şas£s
.
ş—r
();

233 
	gmajÜ_şas£s
.
push_back
(
i
);

234 } ià(
	gcouÁ
 =ğ
max_couÁ
) {

235 
majÜ_şas£s
.
push_back
(
i
);

239 ià(
	gmax_couÁ
 == 0) {

240  
şass_couÁ
.
size
();

241 } ià(
	gmajÜ_şas£s
.
size
() == 1) {

242  
majÜ_şas£s
[0];

245 
	g¡d
::
unifÜm_št_di¡ributiÚ
<
size_t
> 
unif_di¡
(0, 
majÜ_şas£s
.
size
() - 1);

246  
	gmajÜ_şas£s
[
unif_di¡
(
¿ndom_numb”_g’”©Ü
)];

256 
mo¡F»qu’tV®ue
(
¡d
::
unÜd”ed_m­
<, 
size_t
>& 
şass_couÁ
, std::
mt19937_64
 
¿ndom_numb”_g’”©Ü
);

267 
compu‹CÚcÜdªûIndex
(
D©a
* 
d©a
, 
¡d
::
veùÜ
<>& 
sum_chf
, 
size_t
 
d•’d’t_v¬ID
, size_ˆ
¡©us_v¬ID
,

268 
¡d
::
veùÜ
<
size_t
>& 
§m¶e_IDs
);

275 
	g¡d
::
¡ršg
 
uštToSŒšg
(
ušt
 
numb”
);

282 
	g¡d
::
¡ršg
 
b—utifyTime
(
ušt
 
£cÚds
);

290 
size_t
 
roundToNextMuÉË
(size_ˆ
v®ue
, 
ušt
 
muÉË
);

298 
¥l™SŒšg
(
¡d
::
veùÜ
<¡d::
¡ršg
>& 
»suÉ
, std::¡ršg 
šput
, 
¥l™_ch¬
);

308 
shufæeAndS¶™
(
¡d
::
veùÜ
<
size_t
>& 
fœ¡_·¹
, std::veùÜ<size_t>& 
£cÚd_·¹
, size_ˆ
n_®l
, size_ˆ
n_fœ¡
,

309 
¡d
::
mt19937_64
 
¿ndom_numb”_g’”©Ü
);

317 
	g¡d
::
¡ršg
 
checkUnÜd”edV¬ŸbËs
(
D©a
* 
d©a
, 
¡d
::
veùÜ
<¡d::¡ršg> 
unÜd”ed_v¬ŸbË_Çmes
);

324 
boŞ
 
checkPos™iveIÁeg”s
(
¡d
::
veùÜ
<>& 
®l_v®ues
);

334 
max¡©PV®ueLau92
(
b
, 
mš´İ
, 
max´İ
);

346 
max¡©PV®ueLau94
(
b
, 
mš´İ
, 
max´İ
, 
size_t
 
N
, 
¡d
::
veùÜ
<size_t>& 
m
);

353 
d¡dnÜm
(
x
);

360 
p¡dnÜm
(
x
);

367 
	g¡d
::
veùÜ
<> 
adju¡Pv®ues
(
¡d
::veùÜ<>& 
uÇdju¡ed_pv®ues
);

375 
	g‹m¶©e
<
ty³Çme
 
	gT
>

376 
	g¡d
::
veùÜ
<
size_t
> 
Üd”
(
¡d
::veùÜ<
T
>& 
v®ues
, 
boŞ
 
deü—sšg
) {

378 
	g¡d
::
veùÜ
<
size_t
> 
šdiûs
(
v®ues
.
size
());

379 
	g¡d
::
iÙa
(
šdiûs
.
begš
(), indiûs.
’d
(), 0);

382 ià(
	gdeü—sšg
) {

383 
	g¡d
::
sÜt
(
¡d
::
begš
(
šdiûs
), std::
’d
(šdiûs), [&](
size_t
 
i1
, size_ˆ
i2
è{ 
v®ues
[i1] > values[i2];});

385 
	g¡d
::
sÜt
(
¡d
::
begš
(
šdiûs
), std::
’d
(šdiûs), [&](
size_t
 
i1
, size_ˆ
i2
è{ 
v®ues
[i1] < values[i2];});

387  
	gšdiûs
;

398 
	g¡d
::
veùÜ
<
size_t
> 
Üd”InD©a
(
D©a
* 
d©a
, 
¡d
::veùÜ<size_t>& 
§m¶eIDs
, size_ˆ
v¬ID
, 
boŞ
 
deü—sšg
);

405 
	g‹m¶©e
<
ty³Çme
 
	gT
>

406 
	g¡d
::
veùÜ
<> 
¿nk
(
¡d
::veùÜ<
T
>& 
v®ues
) {

407 
size_t
 
num_v®ues
 = 
v®ues
.
size
();

410 
	g¡d
::
veùÜ
<
size_t
> 
šdiûs
 = 
Üd”
(
v®ues
, 
çl£
);

413 
	g¡d
::
veùÜ
<> 
¿nks
(
num_v®ues
);

414 
size_t
 
	g»ps
 = 1;

415 
size_t
 
	gi
 = 0; i < 
	gnum_v®ues
; i +ğ
»ps
) {

418 
»ps
 = 1;

419 
	gi
 + 
	g»ps
 < 
	gnum_v®ues
 && 
	gv®ues
[
šdiûs
[
i
]] =ğ
v®ues
[šdiûs[˜+ 
»ps
]]) {

420 ++
»ps
;

424 
size_t
 
	gj
 = 0; j < 
	g»ps
; ++j)

425 
	g¿nks
[
šdiûs
[
i
 + 
j
]] = (2 * (è˜+ (è
»ps
 - 1) / 2 + 1;

428  
	g¿nks
;

437 
	g¡d
::
veùÜ
<> 
log¿nkScÜes
(
¡d
::veùÜ<>& 
time
, std::veùÜ<>& 
¡©us
);

447 
	g¡d
::
veùÜ
<> 
log¿nkScÜesD©a
(
D©a
* 
d©a
, 
size_t
 
time_v¬ID
, size_ˆ
¡©us_v¬ID
,

448 
¡d
::
veùÜ
<
size_t
> 
§m¶eIDs
);

460 
max¡©
(
¡d
::
veùÜ
<>& 
scÜes
, std::veùÜ<>& 
x
, std::veùÜ<
size_t
>& 
šdiûs
, & 
be¡_max¡©
,

461 & 
be¡_¥l™_v®ue
, 
mš´İ
, 
max´İ
);

475 
max¡©InD©a
(
¡d
::
veùÜ
<>& 
scÜes
, 
D©a
* 
d©a
, std::veùÜ<
size_t
>& 
§m¶eIDs
, size_ˆ
v¬ID
,

476 
¡d
::
veùÜ
<
size_t
>& 
šdiûs
, & 
be¡_max¡©
, & 
be¡_¥l™_v®ue
, 
mš´İ
, 
max´İ
);

484 
	g¡d
::
veùÜ
<
size_t
> 
numSam¶esLeáOfCuošt
(
¡d
::veùÜ<>& 
x
, std::veùÜ<size_t>& 
šdiûs
);

494 
	g¡d
::
veùÜ
<
size_t
> 
numSam¶esLeáOfCuoštInD©a
(
D©a
* 
d©a
, 
¡d
::veùÜ<size_t>& 
§m¶eIDs
, size_ˆ
v¬ID
,

495 
¡d
::
veùÜ
<
size_t
>& 
šdiûs
);

498 #ifdeà
R_BUILD


499 
	$chkIÁFn
(*
dummy
) {

500 
	`R_CheckU£rIÁ”ru±
();

501 
	}
}

503 
šlše
 
boŞ
 
	$checkIÁ”ru±
() {

504  (
	`R_TİËv–Exec
(
chkIÁFn
, 
NULL
è=ğ
FALSE
);

505 
	}
}

	@version.h

1 #iâdeà
RANGER_VERSION


2 
	#RANGER_VERSION
 "0.5.0"

	)

	@
1
.
0
35
751
Forest/Forest.cpp
Forest/Forest.h
Forest/ForestClassification.cpp
Forest/ForestClassification.h
Forest/ForestProbability.cpp
Forest/ForestProbability.h
Forest/ForestRegression.cpp
Forest/ForestRegression.h
Forest/ForestSurvival.cpp
Forest/ForestSurvival.h
Tree/Tree.cpp
Tree/Tree.h
Tree/TreeClassification.cpp
Tree/TreeClassification.h
Tree/TreeProbability.cpp
Tree/TreeProbability.h
Tree/TreeRegression.cpp
Tree/TreeRegression.h
Tree/TreeSurvival.cpp
Tree/TreeSurvival.h
globals.h
main.cpp
utility/ArgumentHandler.cpp
utility/ArgumentHandler.h
utility/Data.cpp
utility/Data.h
utility/DataChar.cpp
utility/DataChar.h
utility/DataDouble.cpp
utility/DataDouble.h
utility/DataFloat.cpp
utility/DataFloat.h
utility/utility.cpp
utility/utility.h
version.h
